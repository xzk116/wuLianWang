import{d as e,aj as l,r as a,S as t,c as o,aF as r,o as s,bl as i,g as d,f as n,m as u,w as p,i as m,C as c,$ as f,a0 as g,W as _,e as b,h as j,F as v,an as y,P as h,Q as V,dK as w,aU as x,aC as k}from"./index.C4XHQ947.js";import{v as U}from"./loading.BmtaAxB7.js";import{E as C}from"./drawer.t0C227Nj.js";import"./overlay.BSrIvsx2.js";import{E as I}from"./switch.DVDOM0jV.js";import{_ as E}from"./index.vue_vue_type_script_setup_true_lang.BwKeDN0O.js";/* empty css            */import{E as z,a as R}from"./select.BjtaYayC.js";import"./scrollbar.BohePXPP.js";import"./popper.DyOsyU0d.js";import"./tree.Ck8ykSKU.js";import"./checkbox.CmADlFKQ.js";import{E as T}from"./tree-select.xP3lKzbL.js";import{a as S,E as F}from"./col.CSSkpjhc.js";import{E as O}from"./card.BiRPT1LQ.js";import{_ as P}from"./index.DFbtX2SK.js";import{a as q,E as A}from"./table-column.diEZPI-c.js";/* empty css                */import{_ as B}from"./DictLabel.vue_vue_type_script_setup_true_lang.DCNeEIpf.js";import{a as D,E as L}from"./form-item.ClXYt8Tp.js";import{E as N}from"./button.D2DEk6fY.js";import{E as Y}from"./date-picker.C3eAOTjW.js";import{E as Z}from"./input.acwFxw-O.js";import{D as K}from"./dept.api.FpFnROI-.js";import{R as M}from"./role.api.bFjtu5JX.js";import{_ as Q}from"./DeptTree.vue_vue_type_script_setup_true_lang.BUeoYYBZ.js";import{_ as W}from"./UserImport.vue_vue_type_script_setup_true_lang.CWdX87Ri.js";import{E as $}from"./message-box.daPbjmmn.js";import{E as G}from"./index.Dws5OK1z.js";import"./index.BZB15hwD.js";import"./index.DLtoAZtP.js";import"./vnode.DMlOg4yB.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.Tblv70v8.js";import"./use-form-common-props.g5CCADeT.js";import"./isUndefined.DgmxjSXK.js";import"./index.LcwZUvgm.js";import"./_arrayPush.81Ix0M9y.js";import"./radio-group.D-1lM7a4.js";/* empty css              */import"./token.DWNpOE8r.js";import"./strings.DfZTWvp0.js";import"./castArray.BlrEgLSE.js";import"./isEqual.DRNAkb0Y.js";import"./_Uint8Array.DWUdcecF.js";import"./index.BtA1p4fI.js";import"./debounce.B-wgC4Nx.js";import"./_baseIteratee.DBVoi9B7.js";import"./index.CpXLvEZo.js";import"./index.CRcPiJM1.js";import"./pagination.Cd-kf_Q4.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.DCnv6bQV.js";import"./dayjs.min.DSjR6_Gu.js";import"./index.CPgzIetu.js";import"./index.BbvO-npD.js";import"./alert.CVA5oTmI.js";import"./dialog.CtZ3QWD-.js";import"./refs.B6GNUP0k.js";import"./progress.Dur-EOd2.js";import"./link.DEE5p-Ah.js";const H={class:"app-container"},J={class:"search-bar"},X={class:"flex-x-between mb-10px"},ee={class:"dialog-footer"},le=e({name:"User",inheritAttrs:!1,__name:"index",setup(e){const le=l(),ae=a(),te=a(),oe=t({pageNum:1,pageSize:10}),re=a(),se=a(0),ie=a(!1),de=t({visible:!1,title:"新增用户"}),ne=o((()=>le.device===r.DESKTOP?"600px":"90%")),ue=t({status:1}),pe=t({username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}],email:[{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),me=a([]),ce=a(),fe=a(),ge=a(!1);async function _e(){ie.value=!0,x.getPage(oe).then((e=>{re.value=e.list,se.value=e.total})).finally((()=>{ie.value=!1}))}function be(){ae.value.resetFields(),oe.pageNum=1,oe.deptId=void 0,oe.createTime=void 0,_e()}function je(e){me.value=e.map((e=>e.id))}async function ve(e){de.visible=!0,fe.value=await M.getOptions(),ce.value=await K.getOptions(),e?(de.title="修改用户",x.getFormData(e).then((e=>{Object.assign(ue,{...e})}))):de.title="新增用户"}function ye(){de.visible=!1,te.value.resetFields(),te.value.clearValidate(),ue.id=void 0,ue.status=1}const he=w((()=>{te.value.validate((e=>{if(e){const e=ue.id;ie.value=!0,e?x.update(e,ue).then((()=>{k.success("修改用户成功"),ye(),be()})).finally((()=>ie.value=!1)):x.create(ue).then((()=>{k.success("新增用户成功"),ye(),be()})).finally((()=>ie.value=!1))}}))}),1e3);function Ve(e){const l=[e||me.value].join(",");l?$.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ie.value=!0,x.deleteByIds(l).then((()=>{k.success("删除成功"),be()})).finally((()=>ie.value=!1))}),(function(){k.info("已取消删除")})):k.warning("请勾选删除项")}function we(){ge.value=!0}function xe(){x.export(oe).then((e=>{const l=e.data,a=decodeURI(e.headers["content-disposition"].split(";")[1].split("=")[1]),t=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),o=window.URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}))}return s((()=>{_e()})),(e,l)=>{const a=S,t=Z,o=L,r=R,s=z,w=Y,K=N,M=D,le=A,ke=B,Ue=G,Ce=q,Ie=P,Ee=O,ze=F,Re=T,Te=E,Se=I,Fe=C,Oe=i("hasPerm"),Pe=U;return n(),d("div",H,[u(ze,{gutter:20},{default:p((()=>[u(a,{lg:4,xs:24,class:"mb-[12px]"},{default:p((()=>[u(Q,{modelValue:m(oe).deptId,"onUpdate:modelValue":l[0]||(l[0]=e=>m(oe).deptId=e),onNodeClick:_e},null,8,["modelValue"])])),_:1}),u(a,{lg:20,xs:24},{default:p((()=>[c("div",J,[u(M,{ref_key:"queryFormRef",ref:ae,model:m(oe),inline:!0},{default:p((()=>[u(o,{label:"关键字",prop:"keywords"},{default:p((()=>[u(t,{modelValue:m(oe).keywords,"onUpdate:modelValue":l[1]||(l[1]=e=>m(oe).keywords=e),placeholder:"用户名/昵称/手机号",clearable:"",style:{width:"200px"},onKeyup:f(_e,["enter"])},null,8,["modelValue"])])),_:1}),u(o,{label:"状态",prop:"status"},{default:p((()=>[u(s,{modelValue:m(oe).status,"onUpdate:modelValue":l[2]||(l[2]=e=>m(oe).status=e),placeholder:"全部",clearable:"",class:"!w-[100px]"},{default:p((()=>[u(r,{label:"正常",value:1}),u(r,{label:"禁用",value:0})])),_:1},8,["modelValue"])])),_:1}),u(o,{label:"创建时间"},{default:p((()=>[u(w,{modelValue:m(oe).createTime,"onUpdate:modelValue":l[3]||(l[3]=e=>m(oe).createTime=e),editable:!1,class:"!w-[240px]",type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"截止时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),u(o,null,{default:p((()=>[u(K,{type:"primary",icon:"search",onClick:_e},{default:p((()=>l[20]||(l[20]=[g("搜索")]))),_:1}),u(K,{icon:"refresh",onClick:be},{default:p((()=>l[21]||(l[21]=[g("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),u(Ee,{shadow:"never"},{default:p((()=>[c("div",X,[c("div",null,[_((n(),b(K,{type:"success",icon:"plus",onClick:l[4]||(l[4]=e=>ve())},{default:p((()=>l[22]||(l[22]=[g(" 新增 ")]))),_:1})),[[Oe,["sys:user:add"]]]),_((n(),b(K,{type:"danger",icon:"delete",disabled:0===m(me).length,onClick:l[5]||(l[5]=e=>Ve())},{default:p((()=>l[23]||(l[23]=[g(" 删除 ")]))),_:1},8,["disabled"])),[[Oe,"sys:user:delete"]])]),c("div",null,[_((n(),b(K,{icon:"upload",onClick:we},{default:p((()=>l[24]||(l[24]=[g(" 导入 ")]))),_:1})),[[Oe,"sys:user:import"]]),_((n(),b(K,{icon:"download",onClick:xe},{default:p((()=>l[25]||(l[25]=[g(" 导出 ")]))),_:1})),[[Oe,"sys:user:export"]])])]),_((n(),b(Ce,{data:m(re),onSelectionChange:je},{default:p((()=>[u(le,{type:"selection",width:"50",align:"center"}),u(le,{label:"用户名",prop:"username"}),u(le,{label:"昵称",width:"150",align:"center",prop:"nickname"}),u(le,{label:"性别",width:"100",align:"center"},{default:p((e=>[u(ke,{modelValue:e.row.gender,"onUpdate:modelValue":l=>e.row.gender=l,code:"gender"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),u(le,{label:"部门",width:"120",align:"center",prop:"deptName"}),u(le,{label:"手机号码",align:"center",prop:"mobile",width:"120"}),u(le,{label:"邮箱",align:"center",prop:"email",width:"160"}),u(le,{label:"状态",align:"center",prop:"status",width:"80"},{default:p((e=>[u(Ue,{type:1==e.row.status?"success":"info"},{default:p((()=>[g(v(1==e.row.status?"正常":"禁用"),1)])),_:2},1032,["type"])])),_:1}),u(le,{label:"创建时间",align:"center",prop:"createTime",width:"150"}),u(le,{label:"操作",fixed:"right",width:"220"},{default:p((e=>[_((n(),b(K,{type:"primary",icon:"RefreshLeft",size:"small",link:"",onClick:l=>{return a=e.row,void $.prompt("请输入用户【"+a.username+"】的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:e})=>{if(!e||e.length<6)return k.warning("密码至少需要6位字符，请重新输入"),!1;x.resetPassword(a.id,e).then((()=>{k.success("密码重置成功，新密码是："+e)}))}),(()=>{k.info("已取消重置密码")}));var a}},{default:p((()=>l[26]||(l[26]=[g(" 重置密码 ")]))),_:2},1032,["onClick"])),[[Oe,"sys:user:password:reset"]]),_((n(),b(K,{type:"primary",icon:"edit",link:"",size:"small",onClick:l=>ve(e.row.id)},{default:p((()=>l[27]||(l[27]=[g(" 编辑 ")]))),_:2},1032,["onClick"])),[[Oe,"sys:user:edit"]]),_((n(),b(K,{type:"danger",icon:"delete",link:"",size:"small",onClick:l=>Ve(e.row.id)},{default:p((()=>l[28]||(l[28]=[g(" 删除 ")]))),_:2},1032,["onClick"])),[[Oe,"sys:user:delete"]])])),_:1})])),_:1},8,["data"])),[[Pe,m(ie)]]),m(se)>0?(n(),b(Ie,{key:0,total:m(se),"onUpdate:total":l[6]||(l[6]=e=>y(se)?se.value=e:null),page:m(oe).pageNum,"onUpdate:page":l[7]||(l[7]=e=>m(oe).pageNum=e),limit:m(oe).pageSize,"onUpdate:limit":l[8]||(l[8]=e=>m(oe).pageSize=e),onPagination:_e},null,8,["total","page","limit"])):j("",!0)])),_:1})])),_:1})])),_:1}),u(Fe,{modelValue:m(de).visible,"onUpdate:modelValue":l[17]||(l[17]=e=>m(de).visible=e),title:m(de).title,"append-to-body":"",size:m(ne),onClose:ye},{footer:p((()=>[c("div",ee,[u(K,{type:"primary",onClick:m(he)},{default:p((()=>l[29]||(l[29]=[g("确 定")]))),_:1},8,["onClick"]),u(K,{onClick:ye},{default:p((()=>l[30]||(l[30]=[g("取 消")]))),_:1})])])),default:p((()=>[u(M,{ref_key:"userFormRef",ref:te,model:m(ue),rules:m(pe),"label-width":"80px"},{default:p((()=>[u(o,{label:"用户名",prop:"username"},{default:p((()=>[u(t,{modelValue:m(ue).username,"onUpdate:modelValue":l[9]||(l[9]=e=>m(ue).username=e),readonly:!!m(ue).id,placeholder:"请输入用户名"},null,8,["modelValue","readonly"])])),_:1}),u(o,{label:"用户昵称",prop:"nickname"},{default:p((()=>[u(t,{modelValue:m(ue).nickname,"onUpdate:modelValue":l[10]||(l[10]=e=>m(ue).nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])])),_:1}),u(o,{label:"所属部门",prop:"deptId"},{default:p((()=>[u(Re,{modelValue:m(ue).deptId,"onUpdate:modelValue":l[11]||(l[11]=e=>m(ue).deptId=e),placeholder:"请选择所属部门",data:m(ce),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])])),_:1}),u(o,{label:"性别",prop:"gender"},{default:p((()=>[u(Te,{modelValue:m(ue).gender,"onUpdate:modelValue":l[12]||(l[12]=e=>m(ue).gender=e),code:"gender"},null,8,["modelValue"])])),_:1}),u(o,{label:"角色",prop:"roleIds"},{default:p((()=>[u(s,{modelValue:m(ue).roleIds,"onUpdate:modelValue":l[13]||(l[13]=e=>m(ue).roleIds=e),multiple:"",placeholder:"请选择"},{default:p((()=>[(n(!0),d(h,null,V(m(fe),(e=>(n(),b(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(o,{label:"手机号码",prop:"mobile"},{default:p((()=>[u(t,{modelValue:m(ue).mobile,"onUpdate:modelValue":l[14]||(l[14]=e=>m(ue).mobile=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])])),_:1}),u(o,{label:"邮箱",prop:"email"},{default:p((()=>[u(t,{modelValue:m(ue).email,"onUpdate:modelValue":l[15]||(l[15]=e=>m(ue).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])])),_:1}),u(o,{label:"状态",prop:"status"},{default:p((()=>[u(Se,{modelValue:m(ue).status,"onUpdate:modelValue":l[16]||(l[16]=e=>m(ue).status=e),"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","size"]),u(W,{modelValue:m(ge),"onUpdate:modelValue":l[18]||(l[18]=e=>y(ge)?ge.value=e:null),onImportSuccess:l[19]||(l[19]=e=>_e())},null,8,["modelValue"])])}}});export{le as default};
