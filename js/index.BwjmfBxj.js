import{d as e,aj as a,r as l,S as t,c as o,aF as i,I as s,o as r,ap as n,g as d,f as u,C as m,m as p,w as c,$ as f,i as v,a0 as j,W as g,e as b,h as y,an as _,F as h,E as k,aC as x,a$ as V}from"./index.C4XHQ947.js";import{v as w}from"./loading.BmtaAxB7.js";import{E as C}from"./drawer.t0C227Nj.js";import"./overlay.BSrIvsx2.js";import{E}from"./tree.Ck8ykSKU.js";import{E as U}from"./checkbox.CmADlFKQ.js";/* empty css                */import{E as S}from"./popper.DyOsyU0d.js";import{E as R}from"./dialog.CtZ3QWD-.js";import{E as z}from"./input.acwFxw-O.js";import{E as F}from"./input-number.DE2d5zNI.js";import{E as q,a as N}from"./radio-group.D-1lM7a4.js";/* empty css              *//* empty css            */import{E as O,a as T}from"./select.BjtaYayC.js";import"./scrollbar.BohePXPP.js";import{E as I}from"./card.BiRPT1LQ.js";import{_ as P}from"./index.DFbtX2SK.js";import{a as B,E as M}from"./table-column.diEZPI-c.js";import{E as A,a as K}from"./form-item.ClXYt8Tp.js";import{E as Q}from"./button.D2DEk6fY.js";import{R as $}from"./role.api.bFjtu5JX.js";import{E as D}from"./message-box.daPbjmmn.js";import{E as W}from"./index.Dws5OK1z.js";import"./index.BZB15hwD.js";import"./index.DLtoAZtP.js";import"./vnode.DMlOg4yB.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.Tblv70v8.js";import"./use-form-common-props.g5CCADeT.js";import"./isUndefined.DgmxjSXK.js";import"./token.DWNpOE8r.js";import"./index.CRcPiJM1.js";import"./index.LcwZUvgm.js";import"./_arrayPush.81Ix0M9y.js";import"./isEqual.DRNAkb0Y.js";import"./_Uint8Array.DWUdcecF.js";import"./refs.B6GNUP0k.js";import"./index.BbvO-npD.js";import"./index.BtA1p4fI.js";import"./index.CPgzIetu.js";import"./strings.DfZTWvp0.js";import"./castArray.BlrEgLSE.js";import"./debounce.B-wgC4Nx.js";import"./_baseIteratee.DBVoi9B7.js";import"./index.CpXLvEZo.js";import"./pagination.Cd-kf_Q4.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.DCnv6bQV.js";const G={class:"app-container"},H={class:"search-bar"},J={class:"mb-10px"},L={class:"dialog-footer"},X={class:"flex-x-between"},Y={class:"flex-center ml-5"},Z={class:"dialog-footer"},ee=e({name:"Role",inheritAttrs:!1,__name:"index",setup(e){const ee=a(),ae=l(),le=l(),te=l(),oe=l(!1),ie=l([]),se=l(0),re=t({pageNum:1,pageSize:10}),ne=l(),de=l([]),ue=t({title:"",visible:!1}),me=o((()=>ee.device===i.DESKTOP?"600px":"90%")),pe=t({sort:1,status:1}),ce=t({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),fe=l({}),ve=l(!1),je=l(""),ge=l(!0),be=l(!0);function ye(){oe.value=!0,$.getPage(re).then((e=>{ne.value=e.list,se.value=e.total})).finally((()=>{oe.value=!1}))}function _e(){ae.value.resetFields(),re.pageNum=1,ye()}function he(e){ie.value=e.map((e=>e.id))}function ke(e){ue.visible=!0,e?(ue.title="修改角色",$.getFormData(e).then((e=>{Object.assign(pe,e)}))):ue.title="新增角色"}function xe(){le.value.validate((e=>{if(e){oe.value=!0;const e=pe.id;e?$.update(e,pe).then((()=>{x.success("修改成功"),Ve(),_e()})).finally((()=>oe.value=!1)):$.create(pe).then((()=>{x.success("新增成功"),Ve(),_e()})).finally((()=>oe.value=!1))}}))}function Ve(){ue.visible=!1,le.value.resetFields(),le.value.clearValidate(),pe.id=void 0,pe.sort=1,pe.status=1}function we(e){const a=[e||ie.value].join(",");a?D.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{oe.value=!0,$.deleteByIds(a).then((()=>{x.success("删除成功"),_e()})).finally((()=>oe.value=!1))}),(()=>{x.info("已取消删除")})):x.warning("请勾选删除项")}function Ce(){const e=fe.value.id;if(e){const a=te.value.getCheckedNodes(!1,!0).map((e=>e.value));oe.value=!0,$.updateRoleMenus(e,a).then((()=>{x.success("分配权限成功"),ve.value=!1,_e()})).finally((()=>{oe.value=!1}))}}function Ee(){ge.value=!ge.value,te.value&&Object.values(te.value.store.nodesMap).forEach((e=>{ge.value?e.expand():e.collapse()}))}function Ue(e,a){return!e||a.label.includes(e)}function Se(e){be.value=e}return s(je,(e=>{te.value.filter(e)})),r((()=>{ye()})),(e,a)=>{const l=z,t=A,o=Q,i=K,s=M,r=W,x=B,D=P,ee=I,Re=T,ze=O,Fe=N,qe=q,Ne=F,Oe=R,Te=n("Search"),Ie=n("Switch"),Pe=U,Be=n("QuestionFilled"),Me=k,Ae=S,Ke=E,Qe=C,$e=w;return u(),d("div",G,[m("div",H,[p(i,{ref_key:"queryFormRef",ref:ae,model:v(re),inline:!0},{default:c((()=>[p(t,{prop:"keywords",label:"关键字"},{default:c((()=>[p(l,{modelValue:v(re).keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>v(re).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:f(ye,["enter"])},null,8,["modelValue"])])),_:1}),p(t,null,{default:c((()=>[p(o,{type:"primary",icon:"search",onClick:ye},{default:c((()=>a[16]||(a[16]=[j("搜索")]))),_:1}),p(o,{icon:"refresh",onClick:_e},{default:c((()=>a[17]||(a[17]=[j("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),p(ee,{shadow:"never"},{default:c((()=>[m("div",J,[p(o,{type:"success",icon:"plus",onClick:a[1]||(a[1]=e=>ke())},{default:c((()=>a[18]||(a[18]=[j("新增")]))),_:1}),p(o,{type:"danger",disabled:0===v(ie).length,icon:"delete",onClick:a[2]||(a[2]=e=>we())},{default:c((()=>a[19]||(a[19]=[j(" 删除 ")]))),_:1},8,["disabled"])]),g((u(),b(x,{ref:"dataTableRef",data:v(ne),"highlight-current-row":"",border:"",onSelectionChange:he},{default:c((()=>[p(s,{type:"selection",width:"55",align:"center"}),p(s,{label:"角色名称",prop:"name","min-width":"100"}),p(s,{label:"角色编码",prop:"code",width:"150"}),p(s,{label:"状态",align:"center",width:"100"},{default:c((e=>[1===e.row.status?(u(),b(r,{key:0,type:"success"},{default:c((()=>a[20]||(a[20]=[j("正常")]))),_:1})):(u(),b(r,{key:1,type:"info"},{default:c((()=>a[21]||(a[21]=[j("禁用")]))),_:1}))])),_:1}),p(s,{label:"排序",align:"center",width:"80",prop:"sort"}),p(s,{fixed:"right",label:"操作",width:"220"},{default:c((e=>[p(o,{type:"primary",size:"small",link:"",icon:"position",onClick:a=>async function(e){const a=e.id;a&&(ve.value=!0,oe.value=!0,fe.value.id=a,fe.value.name=e.name,de.value=await V.getOptions(),$.getRoleMenuIds(a).then((e=>{e.forEach((e=>te.value.setChecked(e,!0,!1)))})).finally((()=>{oe.value=!1})))}(e.row)},{default:c((()=>a[22]||(a[22]=[j(" 分配权限 ")]))),_:2},1032,["onClick"]),p(o,{type:"primary",size:"small",link:"",icon:"edit",onClick:a=>ke(e.row.id)},{default:c((()=>a[23]||(a[23]=[j(" 编辑 ")]))),_:2},1032,["onClick"]),p(o,{type:"danger",size:"small",link:"",icon:"delete",onClick:a=>we(e.row.id)},{default:c((()=>a[24]||(a[24]=[j(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[$e,v(oe)]]),v(se)>0?(u(),b(D,{key:0,total:v(se),"onUpdate:total":a[3]||(a[3]=e=>_(se)?se.value=e:null),page:v(re).pageNum,"onUpdate:page":a[4]||(a[4]=e=>v(re).pageNum=e),limit:v(re).pageSize,"onUpdate:limit":a[5]||(a[5]=e=>v(re).pageSize=e),onPagination:ye},null,8,["total","page","limit"])):y("",!0)])),_:1}),p(Oe,{modelValue:v(ue).visible,"onUpdate:modelValue":a[11]||(a[11]=e=>v(ue).visible=e),title:v(ue).title,width:"500px",onClose:Ve},{footer:c((()=>[m("div",L,[p(o,{type:"primary",onClick:xe},{default:c((()=>a[27]||(a[27]=[j("确 定")]))),_:1}),p(o,{onClick:Ve},{default:c((()=>a[28]||(a[28]=[j("取 消")]))),_:1})])])),default:c((()=>[p(i,{ref_key:"roleFormRef",ref:le,model:v(pe),rules:v(ce),"label-width":"100px"},{default:c((()=>[p(t,{label:"角色名称",prop:"name"},{default:c((()=>[p(l,{modelValue:v(pe).name,"onUpdate:modelValue":a[6]||(a[6]=e=>v(pe).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),p(t,{label:"角色编码",prop:"code"},{default:c((()=>[p(l,{modelValue:v(pe).code,"onUpdate:modelValue":a[7]||(a[7]=e=>v(pe).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),p(t,{label:"数据权限",prop:"dataScope"},{default:c((()=>[p(ze,{modelValue:v(pe).dataScope,"onUpdate:modelValue":a[8]||(a[8]=e=>v(pe).dataScope=e)},{default:c((()=>[(u(),b(Re,{key:1,label:"全部数据",value:1})),(u(),b(Re,{key:2,label:"部门及子部门数据",value:2})),(u(),b(Re,{key:3,label:"本部门数据",value:3})),(u(),b(Re,{key:4,label:"本人数据",value:4}))])),_:1},8,["modelValue"])])),_:1}),p(t,{label:"状态",prop:"status"},{default:c((()=>[p(qe,{modelValue:v(pe).status,"onUpdate:modelValue":a[9]||(a[9]=e=>v(pe).status=e)},{default:c((()=>[p(Fe,{value:1},{default:c((()=>a[25]||(a[25]=[j("正常")]))),_:1}),p(Fe,{value:0},{default:c((()=>a[26]||(a[26]=[j("停用")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),p(t,{label:"排序",prop:"sort"},{default:c((()=>[p(Ne,{modelValue:v(pe).sort,"onUpdate:modelValue":a[10]||(a[10]=e=>v(pe).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),p(Qe,{modelValue:v(ve),"onUpdate:modelValue":a[15]||(a[15]=e=>_(ve)?ve.value=e:null),title:"【"+v(fe).name+"】权限分配",size:v(me)},{footer:c((()=>[m("div",Z,[p(o,{type:"primary",onClick:Ce},{default:c((()=>a[31]||(a[31]=[j("确 定")]))),_:1}),p(o,{onClick:a[14]||(a[14]=e=>ve.value=!1)},{default:c((()=>a[32]||(a[32]=[j("取 消")]))),_:1})])])),default:c((()=>[m("div",X,[p(l,{modelValue:v(je),"onUpdate:modelValue":a[12]||(a[12]=e=>_(je)?je.value=e:null),clearable:"",class:"w-[150px]",placeholder:"菜单权限名称"},{prefix:c((()=>[p(Te)])),_:1},8,["modelValue"]),m("div",Y,[p(o,{type:"primary",size:"small",plain:"",onClick:Ee},{icon:c((()=>[p(Ie)])),default:c((()=>[j(" "+h(v(ge)?"收缩":"展开"),1)])),_:1}),p(Pe,{modelValue:v(be),"onUpdate:modelValue":a[13]||(a[13]=e=>_(be)?be.value=e:null),class:"ml-5",onChange:Se},{default:c((()=>a[29]||(a[29]=[j(" 父子联动 ")]))),_:1},8,["modelValue"]),p(Ae,{placement:"bottom"},{content:c((()=>a[30]||(a[30]=[j(" 如果只需勾选菜单权限，不需要勾选子菜单或者按钮权限，请关闭父子联动 ")]))),default:c((()=>[p(Me,{class:"ml-1 color-[--el-color-primary] inline-block cursor-pointer"},{default:c((()=>[p(Be)])),_:1})])),_:1})])]),p(Ke,{ref_key:"permTreeRef",ref:te,"node-key":"value","show-checkbox":"",data:v(de),"filter-node-method":Ue,"default-expand-all":!0,"check-strictly":!v(be),class:"mt-5"},{default:c((({data:e})=>[j(h(e.label),1)])),_:1},8,["data","check-strictly"])])),_:1},8,["modelValue","title","size"])])}}});export{ee as default};
