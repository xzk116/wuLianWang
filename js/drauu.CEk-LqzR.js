import{r as t,s as e,I as s,d as n,dD as r,ap as i,e as o,f as a,i as h,an as l,w as u,C as d,g as c,P as p,Q as v,n as m,k as g,m as f,E as y,F as x,a0 as b,U as _}from"./index.Cr6LiOEA.js";import{E as w}from"./dialog.BH52fNWr.js";import"./overlay.DfyPIl-k.js";import{E as P}from"./button.DA5Tbsy5.js";import{_ as S}from"./scrubber.vue_vue_type_script_setup_true_lang.GtEnAD-f.js";import{u as E}from"./index.dRJDrlgA.js";import{b as M,c as k}from"./index.BOjm_ZH6.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./index.B8EKF3Rk.js";import"./refs.Ckgld_fj.js";import"./index.CQ7fRGMW.js";import"./vnode.BIXcJM2z.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.CcTW0uGs.js";import"./use-form-common-props.DIXoHrYE.js";import"./isUndefined.DgmxjSXK.js";var C=Object.defineProperty,I=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,N=(t,e,s)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,$=(t,e)=>{for(var s in e||(e={}))A.call(e,s)&&N(t,s,e[s]);if(I)for(var s of I(e))F.call(e,s)&&N(t,s,e[s]);return t},j=()=>({emit(t,...e){for(let s=this.events[t]||[],n=0,r=s.length;n<r;n++)s[n](...e)},events:{},on(t,e){var s;return((s=this.events)[t]||(s[t]=[])).push(e),()=>{var s;this.events[t]=null==(s=this.events[t])?void 0:s.filter((t=>e!==t))}}});function z(t,e){return t-e}function T(t){return t<0?-1:1}function V(t){return[Math.abs(t),T(t)]}function U(){const t=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`}function D(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg","defs"),n=document.createElementNS("http://www.w3.org/2000/svg","marker"),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("fill",e),n.setAttribute("id",t),n.setAttribute("viewBox","0 -5 10 10"),n.setAttribute("refX","5"),n.setAttribute("refY","0"),n.setAttribute("markerWidth","4"),n.setAttribute("markerHeight","4"),n.setAttribute("orient","auto"),r.setAttribute("d","M0,-5L10,0L0,5"),n.appendChild(r),s.appendChild(n),s}function R(t,e){const s=t.x-e.x,n=t.y-e.y;return s*s+n*n}function G(t,e,s){let n=e.x,r=e.y,i=s.x-n,o=s.y-r;if(0!==i||0!==o){const e=((t.x-n)*i+(t.y-r)*o)/(i*i+o*o);e>1?(n=s.x,r=s.y):e>0&&(n+=i*e,r+=o*e)}return i=t.x-n,o=t.y-r,i*i+o*o}function O(t,e,s,n,r){let i=n,o=0;for(let a=e+1;a<s;a++){const n=G(t[a],t[e],t[s]);n>i&&(o=a,i=n)}i>n&&(o-e>1&&O(t,e,o,n,r),r.push(t[o]),s-o>1&&O(t,o,s,n,r))}function B(t,e){const s=t.length-1,n=[t[0]];return O(t,0,s,e,n),n.push(t[s]),n}function K(t,e,s=!1){if(t.length<=2)return t;const n=e*e;return t=s?t:function(t,e){let s=t[0];const n=[s];let r;for(let i=1,o=t.length;i<o;i++)r=t[i],R(r,s)>e&&(n.push(r),s=r);return s!==r&&r&&n.push(r),n}(t,n),t=B(t,n)}var H=class{constructor(t){this.drauu=t,this.event=void 0,this.point=void 0,this.start=void 0,this.el=null}onSelected(t){}onUnselected(){}onStart(t){}onMove(t){return!1}onEnd(t){}get brush(){return this.drauu.brush}get shiftPressed(){return this.drauu.shiftPressed}get altPressed(){return this.drauu.altPressed}get svgElement(){return this.drauu.el}getMousePosition(t){var e,s,n,r;const i=this.drauu.el,o=null!=(e=this.drauu.options.cssZoom)?e:1,a=null!=(s=this.drauu.options.coordinateScale)?s:1,h=null!=(n=this.drauu.options.offset)?n:{x:0,y:0};if(!1===this.drauu.options.coordinateTransform){const e=this.drauu.el.getBoundingClientRect();return{x:(t.pageX/o-e.left+h.x)*a,y:(t.pageY/o-e.top+h.y)*a,pressure:t.pressure}}{const e=this.drauu.svgPoint;e.x=t.clientX/o+h.x,e.y=t.clientY/o+h.y;const s=e.matrixTransform(null==(r=i.getScreenCTM())?void 0:r.inverse());return{x:s.x*a,y:s.y*a,pressure:t.pressure}}}createElement(t,e){var s;const n=document.createElementNS("http://www.w3.org/2000/svg",t),r=e?$($({},this.brush),e):this.brush;return n.setAttribute("fill",null!=(s=r.fill)?s:"transparent"),n.setAttribute("stroke",r.color),n.setAttribute("stroke-width",r.size.toString()),n.setAttribute("stroke-linecap","round"),r.dasharray&&n.setAttribute("stroke-dasharray",r.dasharray),n}attr(t,e){this.el.setAttribute(t,"string"==typeof e?e:e.toFixed(2))}_setEvent(t){this.event=t,this.point=this.getMousePosition(t)}_eventDown(t){return this._setEvent(t),this.start=this.point,this.onStart(this.point)}_eventMove(t){return this._setEvent(t),this.onMove(this.point)}_eventUp(t){return this._setEvent(t),this.onEnd(this.point)}},X=class t extends H{constructor(){super(...arguments),this.points=[],this.count=0}onStart(t){if(this.el=this.createElement("path",{fill:"transparent"}),this.points=[t],this.brush.arrowEnd){this.arrowId=U();const t=D(this.arrowId,this.brush.color);this.el.appendChild(t)}return this.el}onMove(e){return this.el||this.onStart(e),this.points[this.points.length-1]!==e&&(this.points.push(e),this.count+=1),this.count>5&&(this.points=K(this.points,1,!0),this.count=0),this.attr("d",t.toSvgData(this.points)),!0}onEnd(){const e=this.el;if(this.el=null,!e)return!1;if(e.setAttribute("d",t.toSvgData(K(this.points,1,!0))),!e.getTotalLength()){const{x:t,y:s}=this.points[0],n=this.brush.size/2;e.setAttribute("d",`M ${t-n} ${s} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 ${2*-n},0`),e.setAttribute("fill",this.brush.color),e.setAttribute("stroke-width","0")}return!0}static line(t,e){const s=e.x-t.x,n=e.y-t.y;return{length:Math.sqrt(s**2+n**2),angle:Math.atan2(n,s)}}static controlPoint(e,s,n,r){const i=s||e,o=n||e,a=t.line(i,o),h=a.angle+(r?Math.PI:0),l=.2*a.length;return{x:e.x+Math.cos(h)*l,y:e.y+Math.sin(h)*l}}static bezierCommand(e,s,n){const r=t.controlPoint(n[s-1],n[s-2],e),i=t.controlPoint(e,n[s-1],n[s+1],!0);return`C ${r.x.toFixed(2)},${r.y.toFixed(2)} ${i.x.toFixed(2)},${i.y.toFixed(2)} ${e.x.toFixed(2)},${e.y.toFixed(2)}`}static toSvgData(e){return e.reduce(((e,s,n,r)=>0===n?`M ${s.x.toFixed(2)},${s.y.toFixed(2)}`:`${e} ${t.bezierCommand(s,n,r)}`),"")}},Y=class extends H{onStart(t){return this.el=this.createElement("ellipse"),this.attr("cx",t.x),this.attr("cy",t.y),this.el}onMove(t){if(!this.el||!this.start)return!1;let[e,s]=V(t.x-this.start.x),[n,r]=V(t.y-this.start.y);if(this.shiftPressed){const t=Math.min(e,n);e=t,n=t}if(this.altPressed)this.attr("cx",this.start.x),this.attr("cy",this.start.y),this.attr("rx",e),this.attr("ry",n);else{const[t,i]=[this.start.x,this.start.x+e*s].sort(z),[o,a]=[this.start.y,this.start.y+n*r].sort(z);this.attr("cx",(t+i)/2),this.attr("cy",(o+a)/2),this.attr("rx",(i-t)/2),this.attr("ry",(a-o)/2)}return!0}onEnd(){const t=this.el;if(this.el=null,!t)return!1;try{if(!t.getTotalLength())return!1}catch(e){return!1}return!0}},q=class extends H{constructor(){super(...arguments),this.pathSubFactor=20,this.pathFragments=[],this._erased=[]}onSelected(t){const e=(t,s)=>{if(t&&t.length)for(let n=0;n<t.length;n++){const r=t[n];if(r.getTotalLength){const t=r.getTotalLength();for(let e=0;e<this.pathSubFactor;e++){const n=r.getPointAtLength(t*e/this.pathSubFactor),i=r.getPointAtLength(t*(e+1)/this.pathSubFactor);this.pathFragments.push({x1:n.x,x2:i.x,y1:n.y,y2:i.y,segment:e,element:s||r})}}else r.children&&e(r.children,r)}};t&&e(t.children)}onUnselected(){this.pathFragments=[]}onStart(t){this.svgPointPrevious=this.svgElement.createSVGPoint(),this.svgPointPrevious.x=t.x,this.svgPointPrevious.y=t.y}onMove(t){this.svgPointCurrent=this.svgElement.createSVGPoint(),this.svgPointCurrent.x=t.x,this.svgPointCurrent.y=t.y;const e=this.checkAndEraseElement();return this.svgPointPrevious=this.svgPointCurrent,e}onEnd(){this.svgPointPrevious=void 0,this.svgPointCurrent=void 0;const t=this._erased;return this._erased=[],{undo:()=>t.forEach((t=>this.drauu._restoreNode(t))),redo:()=>t.forEach((t=>this.drauu._removeNode(t)))}}checkAndEraseElement(){if(this.pathFragments.length)for(let t=0;t<this.pathFragments.length;t++){const e=this.pathFragments[t];if(this.svgPointPrevious&&this.svgPointCurrent){const t={x1:this.svgPointPrevious.x,x2:this.svgPointCurrent.x,y1:this.svgPointPrevious.y,y2:this.svgPointCurrent.y};this.lineLineIntersect(e,t)&&(this.drauu._removeNode(e.element),this._erased.push(e.element))}}return this._erased.length&&(this.pathFragments=this.pathFragments.filter((t=>!this._erased.includes(t.element)))),this._erased.length>0}lineLineIntersect(t,e){const s=t.x1,n=t.x2,r=e.x1,i=e.x2,o=t.y1,a=t.y2,h=e.y1,l=e.y2,u=(s-n)*(h-l)-(o-a)*(r-i),d=(t,e,s)=>t>=e&&t<=s||t>=s&&t<=e;if(0===u)return!1;{const t={x:((s*a-o*n)*(r-i)-(s-n)*(r*l-h*i))/u,y:((s*a-o*n)*(h-l)-(o-a)*(r*l-h*i))/u};return d(t.x,s,n)&&d(t.y,o,a)&&d(t.x,r,i)&&d(t.y,h,l)}}},Q=class extends H{onStart(t){if(this.el=this.createElement("line",{fill:"transparent"}),this.attr("x1",t.x),this.attr("y1",t.y),this.attr("x2",t.x),this.attr("y2",t.y),this.brush.arrowEnd){const t=U(),e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.append(D(t,this.brush.color)),e.append(this.el),this.attr("marker-end",`url(#${t})`),e}return this.el}onMove(t){if(!this.el)return!1;let{x:e,y:s}=t;if(this.shiftPressed){const n=t.x-this.start.x,r=t.y-this.start.y;if(0!==r){let t=n/r;t=Math.round(t),Math.abs(t)<=1?(e=this.start.x+r*t,s=this.start.y+r):(e=this.start.x+n,s=this.start.y)}}return this.altPressed?(this.attr("x1",2*this.start.x-e),this.attr("y1",2*this.start.y-s),this.attr("x2",e),this.attr("y2",s)):(this.attr("x1",this.start.x),this.attr("y1",this.start.y),this.attr("x2",e),this.attr("y2",s)),!0}onEnd(){const t=this.el;if(this.el=null,!t)return!1;try{if(t.getTotalLength()<5)return!1}catch(e){return!1}return!0}},W=class extends H{onStart(t){return this.el=this.createElement("rect"),this.brush.cornerRadius&&(this.attr("rx",this.brush.cornerRadius),this.attr("ry",this.brush.cornerRadius)),this.attr("x",t.x),this.attr("y",t.y),this.el}onMove(t){if(!this.el||!this.start)return!1;let[e,s]=V(t.x-this.start.x),[n,r]=V(t.y-this.start.y);if(this.shiftPressed){const t=Math.min(e,n);e=t,n=t}if(this.altPressed)this.attr("x",this.start.x-e),this.attr("y",this.start.y-n),this.attr("width",2*e),this.attr("height",2*n);else{const[t,i]=[this.start.x,this.start.x+e*s].sort(z),[o,a]=[this.start.y,this.start.y+n*r].sort(z);this.attr("x",t),this.attr("y",o),this.attr("width",i-t),this.attr("height",a-o)}return!0}onEnd(){const t=this.el;if(this.el=null,!t)return!1;try{if(!t.getTotalLength())return!1}catch(e){return!1}return!0}};function Z(t,e,s,n=t=>t){return t*n(.5-e*(.5-s))}function J(t,e){return[t[0]+e[0],t[1]+e[1]]}function tt(t,e){return[t[0]-e[0],t[1]-e[1]]}function et(t,e){return[t[0]*e,t[1]*e]}function st(t){return[t[1],-t[0]]}function nt(t,e){return t[0]*e[0]+t[1]*e[1]}function rt(t,e){return t[0]===e[0]&&t[1]===e[1]}function it(t,e){return function(t){return t[0]*t[0]+t[1]*t[1]}(tt(t,e))}function ot(t){return function(t,e){return[t[0]/e,t[1]/e]}(t,function(t){return Math.hypot(t[0],t[1])}(t))}function at(t,e){return Math.hypot(t[1]-e[1],t[0]-e[0])}function ht(t,e,s){let n=Math.sin(s),r=Math.cos(s),i=t[0]-e[0],o=t[1]-e[1],a=i*n+o*r;return[i*r-o*n+e[0],a+e[1]]}function lt(t,e,s){return J(t,et(tt(e,t),s))}function ut(t,e,s){return J(t,et(e,s))}var{min:dt,PI:ct}=Math,pt=ct+1e-4;function vt(t,e={}){return function(t,e={}){let{size:s=16,smoothing:n=.5,thinning:r=.5,simulatePressure:i=!0,easing:o=t=>t,start:a={},end:h={},last:l=!1}=e,{cap:u=!0,easing:d=t=>t*(2-t)}=a,{cap:c=!0,easing:p=t=>--t*t*t+1}=h;if(0===t.length||s<=0)return[];let v,m=t[t.length-1].runningLength,g=!1===a.taper?0:!0===a.taper?Math.max(s,m):a.taper,f=!1===h.taper?0:!0===h.taper?Math.max(s,m):h.taper,y=Math.pow(s*n,2),x=[],b=[],_=t.slice(0,10).reduce(((t,e)=>{let n=e.pressure;if(i){let r=dt(1,e.distance/s),i=dt(1,1-r);n=dt(1,t+.275*r*(i-t))}return(t+n)/2}),t[0].pressure),w=Z(s,r,t[t.length-1].pressure,o),P=t[0].vector,S=t[0].point,E=S,M=S,k=E,L=!1;for(let N=0;N<t.length;N++){let{pressure:e}=t[N],{point:n,vector:a,distance:h,runningLength:l}=t[N];if(N<t.length-1&&m-l<3)continue;if(r){if(i){let t=dt(1,h/s),n=dt(1,1-t);e=dt(1,_+.275*t*(n-_))}w=Z(s,r,e,o)}else w=s/2;void 0===v&&(v=w);let u=l<g?d(l/g):1,c=m-l<f?p((m-l)/f):1;w=Math.max(.01,w*Math.min(u,c));let C=(N<t.length-1?t[N+1]:t[N]).vector,I=N<t.length-1?nt(a,C):1,A=null!==I&&I<0;if(nt(a,P)<0&&!L||A){let t=et(st(P),w);for(let e=1/13,s=0;s<=1;s+=e)M=ht(tt(n,t),n,pt*s),x.push(M),k=ht(J(n,t),n,pt*-s),b.push(k);S=M,E=k,A&&(L=!0);continue}if(L=!1,N===t.length-1){let t=et(st(a),w);x.push(tt(n,t)),b.push(J(n,t));continue}let F=et(st(lt(C,a,I)),w);M=tt(n,F),(N<=1||it(S,M)>y)&&(x.push(M),S=M),k=J(n,F),(N<=1||it(E,k)>y)&&(b.push(k),E=k),_=e,P=a}let C=t[0].point.slice(0,2),I=t.length>1?t[t.length-1].point.slice(0,2):J(t[0].point,[1,1]),A=[],F=[];if(1===t.length){if(!g&&!f||l){let t=ut(C,ot(st(tt(C,I))),-(v||w)),e=[];for(let s=1/13,n=s;n<=1;n+=s)e.push(ht(t,C,2*pt*n));return e}}else{if(!(g||f&&1===t.length))if(u)for(let t=1/13,s=t;s<=1;s+=t){let t=ht(b[0],C,pt*s);A.push(t)}else{let t=tt(x[0],b[0]),e=et(t,.5),s=et(t,.51);A.push(tt(C,e),tt(C,s),J(C,s),J(C,e))}let e=st(function(t){return[-t[0],-t[1]]}(t[t.length-1].vector));if(f||g&&1===t.length)F.push(I);else if(c){let t=ut(I,e,w);for(let e=1/29,s=e;s<1;s+=e)F.push(ht(t,I,3*pt*s))}else F.push(J(I,et(e,w)),J(I,et(e,.99*w)),tt(I,et(e,.99*w)),tt(I,et(e,w)))}return x.concat(F,b.reverse(),A)}(function(t,e={}){var s;let{streamline:n=.5,size:r=16,last:i=!1}=e;if(0===t.length)return[];let o=.15+.85*(1-n),a=Array.isArray(t[0])?t:t.map((({x:t,y:e,pressure:s=.5})=>[t,e,s]));if(2===a.length){let t=a[1];a=a.slice(0,-1);for(let e=1;e<5;e++)a.push(lt(a[0],t,e/4))}1===a.length&&(a=[...a,[...J(a[0],[1,1]),...a[0].slice(2)]]);let h=[{point:[a[0][0],a[0][1]],pressure:a[0][2]>=0?a[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],l=!1,u=0,d=h[0],c=a.length-1;for(let p=1;p<a.length;p++){let t=i&&p===c?a[p].slice(0,2):lt(d.point,a[p],o);if(rt(d.point,t))continue;let e=at(t,d.point);if(u+=e,p<c&&!l){if(u<r)continue;l=!0}d={point:t,pressure:a[p][2]>=0?a[p][2]:.5,vector:ot(tt(d.point,t)),distance:e,runningLength:u},h.push(d)}return h[0].vector=(null==(s=h[1])?void 0:s.vector)||[0,0],h}(t,e),e)}var mt=class t extends H{constructor(){super(...arguments),this.points=[]}onStart(t){return this.el=document.createElementNS("http://www.w3.org/2000/svg","path"),this.points=[t],this.attr("fill",this.brush.color),this.attr("d",this.getSvgData(this.points)),this.el}onMove(t){return this.el||this.onStart(t),this.points[this.points.length-1]!==t&&this.points.push(t),this.attr("d",this.getSvgData(this.points)),!0}onEnd(){const t=this.el;return this.el=null,!!t}getSvgData(e){return t.getSvgData(e,this.brush)}static getSvgData(t,e){const s=vt(t,$({size:e.size,thinning:.9,simulatePressure:!1,start:{taper:5},end:{taper:5}},e.stylusOptions));if(!s.length)return"";const n=s.reduce(((t,[e,s],n,r)=>{const[i,o]=r[(n+1)%r.length];return t.push(e,s,(e+i)/2,(s+o)/2),t}),["M",...s[0],"Q"]);return n.push("Z"),n.map((t=>"number"==typeof t?t.toFixed(2):t)).join(" ")}};var gt=class{constructor(t={}){var e;this.options=t,this.el=null,this.svgPoint=null,this.eventEl=null,this.shiftPressed=!1,this.altPressed=!1,this.drawing=!1,this._emitter=j(),this._originalPointerId=null,this._models={draw:new X(e=this),stylus:new mt(e),line:new Q(e),rectangle:new W(e),ellipse:new Y(e),eraseLine:new q(e)},this._opStack=[],this._opIndex=0,this._disposables=[],this._elements=[],this.options.brush||(this.options.brush={color:"black",size:3,mode:"stylus"}),t.el&&this.mount(t.el,t.eventTarget,t.window)}get model(){return this._models[this.mode]}get mounted(){return!!this.el}get mode(){return this.options.brush.mode||"stylus"}set mode(t){this._models[this.mode].onUnselected(),this.options.brush.mode=t,this.model.onSelected(this.el)}get brush(){return this.options.brush}set brush(t){this.options.brush=t}resolveSelector(t){return"string"==typeof t?document.querySelector(t):t||null}mount(t,e,s=window){if(this.el)throw new Error("[drauu] already mounted, unmount previous target first");if(this.el=this.resolveSelector(t),!this.el)throw new Error("[drauu] target element not found");if("svg"!==this.el.tagName.toLocaleLowerCase())throw new Error("[drauu] can only mount to a SVG element");if(!this.el.createSVGPoint)throw new Error("[drauu] SVG element must be create by document.createElementNS('http://www.w3.org/2000/svg', 'svg')");this.svgPoint=this.el.createSVGPoint();const n=this.resolveSelector(e)||this.el,r=this.eventStart.bind(this),i=this.eventMove.bind(this),o=this.eventEnd.bind(this),a=this.eventKeyboard.bind(this);n.addEventListener("pointerdown",r,{passive:!1}),s.addEventListener("pointermove",i,{passive:!1}),s.addEventListener("pointerup",o,{passive:!1}),s.addEventListener("pointercancel",o,{passive:!1}),s.addEventListener("keydown",a,!1),s.addEventListener("keyup",a,!1),this._disposables.push((()=>{n.removeEventListener("pointerdown",r),s.removeEventListener("pointermove",i),s.removeEventListener("pointerup",o),s.removeEventListener("pointercancel",o),s.removeEventListener("keydown",a,!1),s.removeEventListener("keyup",a,!1)})),this._emitter.emit("mounted")}unmount(){this._disposables.forEach((t=>t())),this._disposables.length=0,this._elements.length=0,this.el=null,this._emitter.emit("unmounted")}on(t,e){return this._emitter.on(t,e)}undo(){return!(!this.canUndo()||this.drawing)&&(this._opStack[--this._opIndex].undo(),this._emitter.emit("changed"),!0)}redo(){return!(!this.canRedo()||this.drawing)&&(this._opStack[this._opIndex++].redo(),this._emitter.emit("changed"),!0)}canRedo(){return this._opIndex<this._opStack.length}canUndo(){return this._opIndex>0}eventMove(t){this.acceptsInput(t)&&this.drawing&&this.model._eventMove(t)&&(t.stopPropagation(),t.preventDefault(),this._emitter.emit("changed"))}eventStart(t){this.acceptsInput(t)&&(t.stopPropagation(),t.preventDefault(),this._currentNode&&this.cancel(),this.drawing=!0,this._originalPointerId=t.pointerId,this._emitter.emit("start"),this._currentNode=this.model._eventDown(t),this._currentNode&&"eraseLine"!==this.mode&&this.el.appendChild(this._currentNode),this._emitter.emit("changed"))}eventEnd(t){if(!this.acceptsInput(t)||!this.drawing)return;const e=this.model._eventUp(t);if(e)if(!0===e){const t=this._currentNode;t&&(this._appendNode(t),this.commit({undo:()=>this._removeNode(t),redo:()=>this._restoreNode(t)}))}else this.commit(e);else this.cancel();this.drawing=!1,this._emitter.emit("end"),this._emitter.emit("changed"),this._originalPointerId=null}acceptsInput(t){return(!this.options.acceptsInputTypes||this.options.acceptsInputTypes.includes(t.pointerType))&&!(this._originalPointerId&&this._originalPointerId!==t.pointerId)}eventKeyboard(t){this.shiftPressed===t.shiftKey&&this.altPressed===t.altKey||(this.shiftPressed=t.shiftKey,this.altPressed=t.altKey,this.model.point&&this.model.onMove(this.model.point)&&this._emitter.emit("changed"))}commit(t){this._opStack.length=this._opIndex,this._opStack.push(t),this._opIndex++;const e=this._currentNode;this._currentNode=void 0,this._emitter.emit("committed",e)}clear(){this._opStack.length=0,this._opIndex=0,this._elements=[],this.cancel(),this.el.innerHTML="",this._emitter.emit("changed")}cancel(){this._currentNode&&(this.el.removeChild(this._currentNode),this._currentNode=void 0,this._emitter.emit("canceled"))}dump(){return this.el.innerHTML}load(t){this.clear(),this.el.innerHTML=t}_appendNode(t){const e=this._elements.at(-1);e?e.after(t):this.el.append(t);const s=this._elements.push(t)-1;t.dataset.drauu_index=s.toString()}_removeNode(t){t.remove(),this._elements[+t.dataset.drauu_index]=null}_restoreNode(t){const e=+t.dataset.drauu_index;this._elements[e]=t;for(let s=e-1;s>=0;s--){const e=this._elements[s];if(e)return void e.after(t)}this.el.prepend(t)}};function ft(n,r){const i=t();let o=[];const a=k(),h=k(),l=k(),u=k(),d=k(),c=e(!1),p=e(!1),v=e(!1),m=e(!1),g=t({color:"black",size:3,arrowEnd:!1,cornerRadius:0,dasharray:void 0,fill:"transparent",mode:"draw",...null==r?void 0:r.brush});s(g,(()=>{const t=i.value;t&&(t.brush=g.value,t.mode=g.value.mode)}),{deep:!0});const f=()=>{var t;o.forEach((t=>t())),null==(t=i.value)||t.unmount()},y=()=>{i.value&&(c.value=i.value.canUndo(),p.value=i.value.canRedo(),v.value=i.value.altPressed,m.value=i.value.shiftPressed)};return s((()=>E(n)),(t=>{t&&"undefined"!=typeof SVGSVGElement&&t instanceof SVGSVGElement&&(i.value&&f(),i.value=function(t){return new gt(t)}({el:t,...r}),y(),o=[i.value.on("canceled",(()=>h.trigger())),i.value.on("committed",(t=>l.trigger(t))),i.value.on("start",(()=>u.trigger())),i.value.on("end",(()=>d.trigger())),i.value.on("changed",(()=>{y(),a.trigger()}))])}),{flush:"post"}),M((()=>f())),{drauuInstance:i,load:t=>{var e;return null==(e=i.value)?void 0:e.load(t)},dump:()=>{var t;return null==(t=i.value)?void 0:t.dump()},clear:()=>{var t;return null==(t=i.value)?void 0:t.clear()},cancel:()=>{var t;return null==(t=i.value)?void 0:t.cancel()},undo:()=>{var t;return null==(t=i.value)?void 0:t.undo()},redo:()=>{var t;return null==(t=i.value)?void 0:t.redo()},canUndo:c,canRedo:p,brush:g,onChanged:a.on,onCommitted:l.on,onStart:u.on,onEnd:d.on,onCanceled:h.on}}const yt={class:"drauu-container"},xt={class:"drauu-tools"},bt=["onClick"],_t={class:"scrubber-box"},wt={class:"size-box"},Pt={class:"tool-right"},St=["disabled"],Et=["disabled"],Mt={class:"drauu-canvas"},kt={class:"canvas-left"},Lt={class:"dialog-footer"},Ct=L(n({__name:"drauu",emits:["srcFun"],setup(e,{expose:s,emit:n}){const E=t(!1),M=n,k=t(["black","#ef4444","#22c55e","#3b82f6"]),L=t(),{undo:C,redo:I,canUndo:A,canRedo:F,clear:N,brush:$}=ft(L,{brush:{color:"black",size:3}}),{mode:j,color:z,size:T}=r($),V=()=>{E.value=!1;const t=document.getElementById("svgRef");if(t){const e=t.clientWidth,s=t.clientHeight;t.setAttribute("width",e.toString()),t.setAttribute("height",s.toString());const n=(new XMLSerializer).serializeToString(t),r=`${window.btoa(n)}`;M("srcFun",r)}},U=t=>{E.value=!1};return s({init:()=>{E.value=!0,_((()=>{}))}}),(t,e)=>{const s=i("BrushFilled"),n=y,r=i("Back"),_=i("Right"),M=i("Brush"),D=i("EditPen"),R=i("SemiSelect"),G=P,O=w;return a(),o(O,{modelValue:h(E),"onUpdate:modelValue":e[9]||(e[9]=t=>l(E)?E.value=t:null),title:"画板案例",width:"800","before-close":U},{footer:u((()=>[d("div",Lt,[f(G,{onClick:e[8]||(e[8]=t=>E.value=!1)},{default:u((()=>e[12]||(e[12]=[b("取消")]))),_:1}),f(G,{type:"primary",onClick:V},{default:u((()=>e[13]||(e[13]=[b(" 确定 ")]))),_:1})])])),default:u((()=>[d("div",yt,[d("div",xt,[d("div",null,[(a(!0),c(p,null,v(k.value,(t=>(a(),c("button",{key:t,class:m([{active:t===h(z)},"color-button"]),onClick:()=>z.value=t},[d("div",{style:g({background:t})},null,4)],10,bt)))),128))]),d("div",_t,[f(n,{size:20,style:{"margin-right":"5px"}},{default:u((()=>[f(s)])),_:1}),f(S,{modelValue:h(T),"onUpdate:modelValue":e[0]||(e[0]=t=>l(T)?T.value=t:null),w:"full",min:1,max:10},null,8,["modelValue"]),d("div",wt,x(h(T).toFixed(1)),1)]),d("div",Pt,[d("button",{class:"tool-button",disabled:!h(A),onClick:e[1]||(e[1]=t=>h(C)())},[f(n,{size:20},{default:u((()=>[f(r)])),_:1})],8,St),d("button",{class:"tool-button",disabled:!h(F),onClick:e[2]||(e[2]=t=>h(I)())},[f(n,{size:20},{default:u((()=>[f(_)])),_:1})],8,Et),d("button",{class:"tool-button",onClick:e[3]||(e[3]=t=>h(N)())},[f(n,{size:20},{default:u((()=>[f(M)])),_:1})])])]),d("div",Mt,[d("div",kt,[d("button",{class:m([{active:"draw"===h($).mode},"tool-button"]),onClick:e[4]||(e[4]=t=>j.value="draw")},[f(n,{size:20,color:"#000"},{default:u((()=>[f(D)])),_:1})],2),d("button",{class:m([{active:"line"===h($).mode&&!h($).arrowEnd},"tool-button"]),onClick:e[5]||(e[5]=t=>j.value="line")},[f(n,{size:20,color:"#696969"},{default:u((()=>[f(R)])),_:1})],2),d("button",{class:m([{active:"rectangle"===h($).mode},"tool-button"]),onClick:e[6]||(e[6]=t=>j.value="rectangle")},e[10]||(e[10]=[d("div",{class:"f-icon"},null,-1)]),2),d("button",{class:m([{active:"ellipse"===h($).mode},"tool-button"]),onClick:e[7]||(e[7]=t=>j.value="ellipse")},e[11]||(e[11]=[d("div",{class:"y-icon"},null,-1)]),2)]),(a(),c("svg",{ref_key:"target",ref:L,id:"svgRef",class:"canvas-right"},null,512))])])])),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-0a75a5a8"]]);export{Ct as default};
