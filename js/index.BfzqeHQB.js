import{d as e,r as l,S as t,o as a,ap as i,bl as o,g as s,f as r,C as n,m as u,w as p,$ as d,i as m,a0 as c,W as f,e as _,h as b,F as y,an as v,P as g,Q as h,aU as j,aC as w}from"./index.2pJuwT2I.js";import{v as k}from"./loading.BQ6DUTxY.js";import{E as V,a as x}from"./descriptions-item.CzrXDFrB.js";import{E as C}from"./dialog.D-_AcmqU.js";import"./overlay.BPxTjZGS.js";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang.TRzuzh5e.js";import{E as S,a as T}from"./radio-group.6pBE_0pU.js";/* empty css              */import{_ as E}from"./index.vue_vue_type_script_setup_true_lang.C1geLEBs.js";import{E as z}from"./card.B04xyjFJ.js";import{_ as N}from"./index.BozDuXJl.js";import{a as F,E as I}from"./table-column.C5SY66lE.js";import"./checkbox.zLZmuVb6.js";/* empty css                */import"./popper.BGBpWCzo.js";import"./scrollbar.Dhi4jk7C.js";/* empty css            */import{_ as P}from"./DictLabel.vue_vue_type_script_setup_true_lang.DfpqgIK6.js";import{E as q,a as O}from"./form-item.CjjjooFN.js";import{E as B}from"./button.BNbP2tWD.js";import{E as D,a as L}from"./select.BiGfcu34.js";import{E as R}from"./input.B2OO5Mqz.js";import{N as A}from"./notice.api.Ci1AhCam.js";import{E as M}from"./message-box.DTdoi8IV.js";import{E as H}from"./index.D2vZEoqh.js";import"./vnode.BX3yTu9Q.js";import"./use-form-common-props.D29gSMrk.js";import"./index.aA9dvPvs.js";import"./refs.x1Hwq_qJ.js";import"./index.B10m4Dli.js";import"./event.BwRzfsZt.js";import"./error.D_Dr4eZ1.js";import"./scroll.DLs6OHol.js";import"./isUndefined.DgmxjSXK.js";import"./file.api.iMHgji8v.js";import"./index.DhsF0caO.js";import"./_arrayPush.B3SSnwHj.js";import"./pagination.CfYgyzbG.js";import"./isEqual.BpLWMaHT.js";import"./_Uint8Array.BAz41YYn.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";import"./_initCloneObject.AdcQFJme.js";import"./_baseIteratee.CLEVGq9d.js";import"./debounce.BJMtmguk.js";import"./index.DwFzoLCE.js";import"./castArray.C93Im9Sd.js";import"./index.BTKOuuO-.js";import"./token.DWNpOE8r.js";import"./strings.QOiT_3Y0.js";import"./index.Bqp7DTQo.js";import"./index.mU3M88aD.js";const Q={class:"app-container"},W={class:"search-bar"},$={class:"flex-x-start"},K={key:0,class:"flex-x-start"},X={key:1,class:"flex-x-start"},Y={class:"dialog-footer"},Z={class:"flex-x-between"},G={class:"dialog-toolbar"},J=["innerHTML"],ee=e({name:"Notice",inheritAttrs:!1,__name:"index",setup(e){const ee=l(),le=l(),te=l(!1),ae=l([]),ie=l(0),oe=t({pageNum:1,pageSize:10}),se=l([]),re=l([]),ne=t({title:"",visible:!1}),ue=t({level:"L",targetType:1}),pe=t({title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur",validator:(e,l,t)=>{l.replace(/<[^>]+>/g,"").trim()?t():t(new Error("请输入通知内容"))}}],type:[{required:!0,message:"请选择通知类型",trigger:"change"}]}),de=t({visible:!1}),me=l({});function ce(){te.value=!0,A.getPage(oe).then((e=>{re.value=e.list,ie.value=e.total})).finally((()=>{te.value=!1}))}function fe(){ee.value.resetFields(),oe.pageNum=1,ce()}function _e(e){ae.value=e.map((e=>e.id))}function be(e){j.getOptions().then((e=>{se.value=e})),ne.visible=!0,e?(ne.title="修改公告",A.getFormData(e).then((e=>{Object.assign(ue,e)}))):(Object.assign(ue,{level:0,targetType:0}),ne.title="新增公告")}function ye(){ne.visible=!1,le.value.resetFields(),le.value.clearValidate(),ue.id=void 0,ue.targetType=1}function ve(e){const l=[e||ae.value].join(",");l?M.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{te.value=!0,A.deleteByIds(l).then((()=>{w.success("删除成功"),fe()})).finally((()=>te.value=!1))}),(()=>{w.info("已取消删除")})):w.warning("请勾选删除项")}const ge=()=>{de.visible=!1};return a((()=>{ce()})),(e,l)=>{const t=R,a=q,j=L,M=D,he=B,je=O,we=I,ke=P,Ve=H,xe=F,Ce=N,Ue=z,Se=E,Te=T,Ee=S,ze=U,Ne=C,Fe=i("Close"),Ie=x,Pe=V,qe=o("hasPerm"),Oe=k;return r(),s("div",Q,[n("div",W,[u(je,{ref_key:"queryFormRef",ref:ee,model:m(oe),inline:!0,"label-suffix":":"},{default:p((()=>[u(a,{label:"标题",prop:"title"},{default:p((()=>[u(t,{modelValue:m(oe).title,"onUpdate:modelValue":l[0]||(l[0]=e=>m(oe).title=e),placeholder:"标题",clearable:"",onKeyup:l[1]||(l[1]=d((e=>ce()),["enter"]))},null,8,["modelValue"])])),_:1}),u(a,{label:"发布状态",prop:"publishStatus"},{default:p((()=>[u(M,{modelValue:m(oe).publishStatus,"onUpdate:modelValue":l[2]||(l[2]=e=>m(oe).publishStatus=e),class:"!w-[100px]",clearable:"",placeholder:"全部"},{default:p((()=>[u(j,{value:0,label:"未发布"}),u(j,{value:1,label:"已发布"}),u(j,{value:-1,label:"已撤回"})])),_:1},8,["modelValue"])])),_:1}),u(a,null,{default:p((()=>[u(he,{type:"primary",icon:"search",onClick:l[3]||(l[3]=e=>ce())},{default:p((()=>l[21]||(l[21]=[c("搜索")]))),_:1}),u(he,{icon:"refresh",onClick:l[4]||(l[4]=e=>fe())},{default:p((()=>l[22]||(l[22]=[c("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),u(Ue,{shadow:"never",class:"table-wrapper"},{header:p((()=>[f((r(),_(he,{type:"success",icon:"plus",onClick:l[5]||(l[5]=e=>be())},{default:p((()=>l[23]||(l[23]=[c(" 新增通知 ")]))),_:1})),[[qe,["sys:notice:add"]]]),f((r(),_(he,{type:"danger",disabled:0===m(ae).length,icon:"delete",onClick:l[6]||(l[6]=e=>ve())},{default:p((()=>l[24]||(l[24]=[c(" 删除 ")]))),_:1},8,["disabled"])),[[qe,["sys:notice:delete"]]])])),default:p((()=>[f((r(),_(xe,{ref:"dataTableRef",data:m(re),"highlight-current-row":"",onSelectionChange:_e},{default:p((()=>[u(we,{type:"selection",width:"55",align:"center"}),u(we,{type:"index",label:"序号",width:"60"}),u(we,{label:"通知标题",prop:"title","min-width":"200"}),u(we,{align:"center",label:"通知类型",width:"150"},{default:p((e=>[u(ke,{modelValue:e.row.type,"onUpdate:modelValue":l=>e.row.type=l,code:"notice_type"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),u(we,{align:"center",label:"发布人",prop:"publisherName",width:"150"}),u(we,{align:"center",label:"通知等级",width:"100"},{default:p((e=>[u(ke,{modelValue:e.row.level,"onUpdate:modelValue":l=>e.row.level=l,code:"notice_level"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),u(we,{align:"center",label:"通告目标类型",prop:"targetType","min-width":"100"},{default:p((e=>[1==e.row.targetType?(r(),_(Ve,{key:0,type:"warning"},{default:p((()=>l[25]||(l[25]=[c("全体")]))),_:1})):b("",!0),2==e.row.targetType?(r(),_(Ve,{key:1,type:"success"},{default:p((()=>l[26]||(l[26]=[c("指定")]))),_:1})):b("",!0)])),_:1}),u(we,{align:"center",label:"发布状态","min-width":"100"},{default:p((e=>[0==e.row.publishStatus?(r(),_(Ve,{key:0,type:"info"},{default:p((()=>l[27]||(l[27]=[c("未发布")]))),_:1})):b("",!0),1==e.row.publishStatus?(r(),_(Ve,{key:1,type:"success"},{default:p((()=>l[28]||(l[28]=[c("已发布")]))),_:1})):b("",!0),-1==e.row.publishStatus?(r(),_(Ve,{key:2,type:"warning"},{default:p((()=>l[29]||(l[29]=[c("已撤回")]))),_:1})):b("",!0)])),_:1}),u(we,{label:"操作时间",width:"250"},{default:p((e=>[n("div",$,[l[30]||(l[30]=n("span",null,"创建时间：",-1)),n("span",null,y(e.row.createTime||"-"),1)]),1===e.row.publishStatus?(r(),s("div",K,[l[31]||(l[31]=n("span",null,"发布时间：",-1)),n("span",null,y(e.row.publishTime||"-"),1)])):-1===e.row.publishStatus?(r(),s("div",X,[l[32]||(l[32]=n("span",null,"撤回时间：",-1)),n("span",null,y(e.row.revokeTime||"-"),1)])):b("",!0)])),_:1}),u(we,{align:"center",fixed:"right",label:"操作",width:"150"},{default:p((e=>[u(he,{type:"primary",size:"small",link:"",onClick:l=>(async e=>{const l=await A.getDetail(e);me.value=l,de.visible=!0})(e.row.id)},{default:p((()=>l[33]||(l[33]=[c(" 查看 ")]))),_:2},1032,["onClick"]),1!=e.row.publishStatus?f((r(),_(he,{key:0,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void A.publish(t).then((()=>{w.success("发布成功"),ce()}));var t}},{default:p((()=>l[34]||(l[34]=[c(" 发布 ")]))),_:2},1032,["onClick"])),[[qe,["sys:notice:publish"]]]):b("",!0),1==e.row.publishStatus?f((r(),_(he,{key:1,type:"primary",size:"small",link:"",onClick:l=>{return t=e.row.id,void A.revoke(t).then((()=>{w.success("撤回成功"),ce()}));var t}},{default:p((()=>l[35]||(l[35]=[c(" 撤回 ")]))),_:2},1032,["onClick"])),[[qe,["sys:notice:revoke"]]]):b("",!0),1!=e.row.publishStatus?f((r(),_(he,{key:2,type:"primary",size:"small",link:"",onClick:l=>be(e.row.id)},{default:p((()=>l[36]||(l[36]=[c(" 编辑 ")]))),_:2},1032,["onClick"])),[[qe,["sys:notice:edit"]]]):b("",!0),1!=e.row.publishStatus?f((r(),_(he,{key:3,type:"danger",size:"small",link:"",onClick:l=>ve(e.row.id)},{default:p((()=>l[37]||(l[37]=[c(" 删除 ")]))),_:2},1032,["onClick"])),[[qe,["sys:notice:delete"]]]):b("",!0)])),_:1})])),_:1},8,["data"])),[[Oe,m(te)]]),m(ie)>0?(r(),_(Ce,{key:0,total:m(ie),"onUpdate:total":l[7]||(l[7]=e=>v(ie)?ie.value=e:null),page:m(oe).pageNum,"onUpdate:page":l[8]||(l[8]=e=>m(oe).pageNum=e),limit:m(oe).pageSize,"onUpdate:limit":l[9]||(l[9]=e=>m(oe).pageSize=e),onPagination:l[10]||(l[10]=e=>ce())},null,8,["total","page","limit"])):b("",!0)])),_:1}),u(Ne,{modelValue:m(ne).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>m(ne).visible=e),title:m(ne).title,top:"3vh",width:"80%",onClose:ye},{footer:p((()=>[n("div",Y,[u(he,{type:"primary",onClick:l[17]||(l[17]=e=>{le.value.validate((e=>{if(e){te.value=!0;const e=ue.id;e?A.update(e,ue).then((()=>{w.success("修改成功"),ye(),fe()})).finally((()=>te.value=!1)):A.create(ue).then((()=>{w.success("新增成功"),ye(),fe()})).finally((()=>te.value=!1))}}))})},{default:p((()=>l[40]||(l[40]=[c("确定")]))),_:1}),u(he,{onClick:l[18]||(l[18]=e=>ye())},{default:p((()=>l[41]||(l[41]=[c("取消")]))),_:1})])])),default:p((()=>[u(je,{ref_key:"dataFormRef",ref:le,model:m(ue),rules:m(pe),"label-width":"100px"},{default:p((()=>[u(a,{label:"通知标题",prop:"title"},{default:p((()=>[u(t,{modelValue:m(ue).title,"onUpdate:modelValue":l[11]||(l[11]=e=>m(ue).title=e),placeholder:"通知标题",clearable:""},null,8,["modelValue"])])),_:1}),u(a,{label:"通知类型",prop:"type"},{default:p((()=>[u(Se,{modelValue:m(ue).type,"onUpdate:modelValue":l[12]||(l[12]=e=>m(ue).type=e),code:"notice_type"},null,8,["modelValue"])])),_:1}),u(a,{label:"通知等级",prop:"level"},{default:p((()=>[u(Se,{modelValue:m(ue).level,"onUpdate:modelValue":l[13]||(l[13]=e=>m(ue).level=e),code:"notice_level"},null,8,["modelValue"])])),_:1}),u(a,{label:"目标类型",prop:"targetType"},{default:p((()=>[u(Ee,{modelValue:m(ue).targetType,"onUpdate:modelValue":l[14]||(l[14]=e=>m(ue).targetType=e)},{default:p((()=>[u(Te,{value:1},{default:p((()=>l[38]||(l[38]=[c("全体")]))),_:1}),u(Te,{value:2},{default:p((()=>l[39]||(l[39]=[c("指定")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),2==m(ue).targetType?(r(),_(a,{key:0,label:"指定用户",prop:"targetUserIds"},{default:p((()=>[u(M,{modelValue:m(ue).targetUserIds,"onUpdate:modelValue":l[15]||(l[15]=e=>m(ue).targetUserIds=e),multiple:"",search:"",placeholder:"请选择指定用户"},{default:p((()=>[(r(!0),s(g,null,h(m(se),(e=>(r(),_(j,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):b("",!0),u(a,{label:"通知内容",prop:"content"},{default:p((()=>[u(ze,{modelValue:m(ue).content,"onUpdate:modelValue":l[16]||(l[16]=e=>m(ue).content=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),u(Ne,{modelValue:m(de).visible,"onUpdate:modelValue":l[20]||(l[20]=e=>m(de).visible=e),"show-close":!1,width:"50%","append-to-body":"",onClose:ge},{header:p((()=>[n("div",Z,[l[42]||(l[42]=n("span",null,"通知公告详情",-1)),n("div",G,[u(he,{circle:"",onClick:ge},{icon:p((()=>[u(Fe)])),_:1})])])])),default:p((()=>[u(Pe,{column:1},{default:p((()=>[u(Ie,{label:"标题："},{default:p((()=>[c(y(m(me).title),1)])),_:1}),u(Ie,{label:"发布状态："},{default:p((()=>[0==m(me).publishStatus?(r(),_(Ve,{key:0,type:"info"},{default:p((()=>l[43]||(l[43]=[c("未发布")]))),_:1})):1==m(me).publishStatus?(r(),_(Ve,{key:1,type:"success"},{default:p((()=>l[44]||(l[44]=[c("已发布")]))),_:1})):-1==m(me).publishStatus?(r(),_(Ve,{key:2,type:"warning"},{default:p((()=>l[45]||(l[45]=[c("已撤回")]))),_:1})):b("",!0)])),_:1}),u(Ie,{label:"发布人："},{default:p((()=>[c(y(m(me).publisherName),1)])),_:1}),u(Ie,{label:"发布时间："},{default:p((()=>[c(y(m(me).publishTime),1)])),_:1}),u(Ie,{label:"公告内容："},{default:p((()=>[n("div",{class:"notice-content",innerHTML:m(me).content},null,8,J)])),_:1})])),_:1})])),_:1},8,["modelValue"])])}}});export{ee as default};
