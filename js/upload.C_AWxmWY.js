import{d as e,bo as l,ai as t,r as a,I as s,ap as i,g as u,f as n,m as r,k as o,i as p,an as d,w as m,a0 as c,F as f,C as y,E as v,j as g,aC as _,by as h,e as j,h as b,o as x,P as w}from"./index.C4XHQ947.js";import{E as C,a as F}from"./form-item.ClXYt8Tp.js";import{E as V,a as k}from"./progress.Dur-EOd2.js";import{E as S}from"./button.D2DEk6fY.js";import{F as z}from"./file.api.DOIFelXO.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{E,a as I}from"./image-viewer.Dt7V2vpK.js";import{E as O}from"./link.DEE5p-Ah.js";import"./use-form-common-props.g5CCADeT.js";import"./castArray.BlrEgLSE.js";import"./error.D_Dr4eZ1.js";import"./_Uint8Array.DWUdcecF.js";import"./_arrayPush.81Ix0M9y.js";import"./_initCloneObject.DCnv6bQV.js";import"./isEqual.DRNAkb0Y.js";import"./index.DLtoAZtP.js";import"./index.BZB15hwD.js";import"./debounce.B-wgC4Nx.js";import"./position.LvrVnTyJ.js";import"./index.BbvO-npD.js";import"./scroll.Tblv70v8.js";const U={class:"el-upload-list__item-info"},N=["onClick"],W={class:"el-upload-list__item-file-name"},q=["onClick"],L=M(e({__name:"FileUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},limit:{type:Number,default:10},maxFileSize:{type:Number,default:10},accept:{type:String,default:"*"},uploadBtnText:{type:String,default:"上传文件"},style:{type:Object,default:()=>({width:"300px"})}},{modelValue:{type:[Array],required:!0,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=e,h=t(e,"modelValue"),j=a([]),b=a(!1),x=a(0);function w(e){return!(e.size>1024*l.maxFileSize*1024)||(_.warning("上传文件不能大于"+l.maxFileSize+"M"),!1)}function C(e){return new Promise(((t,a)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach((e=>{i.append(e,l.data[e])})),z.upload(i).then((e=>{t(e)})).catch((e=>{a(e)}))}))}s(h,(e=>{j.value=e.map((e=>{var l;return{name:e.name?e.name:null==(l=e.url)?void 0:l.substring(e.url.lastIndexOf("/")+1),url:e.url,status:"success",uid:Date.now()<<13|Math.floor(8192*Math.random())}}))}),{immediate:!0});const F=e=>{x.value=e.percent},M=(e,l,t)=>{if(_.success("上传成功"),t.every((e=>"success"===e.status||"fail"===e.status))){let e=[];t.map((l=>{if("success"===l.status){let t=l.response;t&&e.push({name:t.name,url:t.url})}else j.value.splice(j.value.findIndex((e=>e.uid===l.uid)),1)})),e.length>0&&(h.value=[...h.value,...e])}},E=e=>{_.error("上传失败")};return(e,t)=>{const a=S,s=i("Document"),_=v,I=i("Close"),O=V,L=k;return n(),u("div",null,[r(O,{"file-list":p(j),"onUpdate:fileList":t[0]||(t[0]=e=>d(j)?j.value=e:null),style:o(l.style),"before-upload":w,"http-request":C,"on-progress":F,"on-success":M,"on-error":E,accept:l.accept,limit:l.limit,multiple:""},{file:m((({file:e})=>[y("div",U,[y("a",{class:"el-upload-list__item-name",onClick:l=>function(e){const{url:l,name:t}=e;l&&z.download(l,t)}(e)},[r(_,null,{default:m((()=>[r(s)])),_:1}),y("span",W,f(e.name),1),y("span",{class:"el-icon--close",onClick:g((l=>{return t=e.url,void z.delete(t).then((()=>{h.value=h.value.filter((e=>e.url!==t))}));var t}),["stop"])},[r(_,null,{default:m((()=>[r(I)])),_:1})],8,q)],8,N)])])),default:m((()=>[r(a,{type:"primary",disabled:p(j).length>=l.limit},{default:m((()=>[c(f(l.uploadBtnText),1)])),_:1},8,["disabled"])])),_:1},8,["file-list","style","accept","limit"]),r(L,{style:o({display:p(b)?"inline-flex":"none",width:"100%"}),percentage:p(x)},null,8,["style","percentage"])])}}}),[["__scopeId","data-v-517f8aaf"]]),P=M(e({__name:"SingleImageUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},maxFileSize:{type:Number,default:10},accept:{type:String,default:"image/*"},style:{type:Object,default:()=>({width:"150px",height:"150px"})}},{modelValue:{type:String,default:()=>""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){h((e=>({abad9e34:l.style.width,fda41bf2:l.style.height})));const l=e,a=t(e,"modelValue");function s(e){return l.accept.split(",").map((e=>e.trim())).some((l=>"image/*"===l?e.type.startsWith("image/"):l.startsWith(".")?e.name.toLowerCase().endsWith(l):e.type===l))?!(e.size>1024*l.maxFileSize*1024)||(_.warning("上传图片不能大于"+l.maxFileSize+"M"),!1):(_.warning(`上传文件的格式不正确，仅支持：${l.accept}`),!1)}function u(e){return new Promise(((t,a)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach((e=>{i.append(e,l.data[e])})),z.upload(i).then((e=>{t(e)})).catch((e=>{a(e)}))}))}function o(){a.value=""}const p=e=>{_.success("上传成功"),a.value=e.url},d=e=>{_.error("上传失败: "+e.message)};return(e,t)=>{const c=E,f=i("CircleCloseFilled"),y=v,_=i("Plus"),h=V;return n(),j(h,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),class:"single-upload","list-type":"picture-card","show-file-list":!1,accept:l.accept,"before-upload":s,"http-request":u,"on-success":p,"on-error":d},{default:m((()=>[a.value?(n(),j(c,{key:0,src:a.value},null,8,["src"])):b("",!0),a.value?(n(),j(y,{key:1,class:"single-upload__delete-btn",onClick:g(o,["stop"])},{default:m((()=>[r(f)])),_:1})):(n(),j(y,{key:2,class:"single-upload__add-btn"},{default:m((()=>[r(_)])),_:1}))])),_:1},8,["modelValue","accept"])}}}),[["__scopeId","data-v-6ddedf97"]]),D={style:{width:"100%"}},A=["src"],H={class:"el-upload-list__item-actions"},B=["onClick"],K=["onClick"],Q=e({__name:"MultiImageUpload",props:l({data:{type:Object,default:()=>({})},name:{type:String,default:"file"},limit:{type:Number,default:10},maxFileSize:{type:Number,default:10},accept:{type:String,default:"image/*"}},{modelValue:{type:[Array],default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const l=e,s=a(!1),o=a(0),c=t(e,"modelValue"),f=a([]);function g(e){return l.accept.split(",").map((e=>e.trim())).some((l=>"image/*"===l?e.type.startsWith("image/"):l.startsWith(".")?e.name.toLowerCase().endsWith(l):e.type===l))?!(e.size>1024*l.maxFileSize*1024)||(_.warning("上传图片不能大于"+l.maxFileSize+"M"),!1):(_.warning(`上传文件的格式不正确，仅支持：${l.accept}`),!1)}function h(e){return new Promise(((t,a)=>{const s=e.file,i=new FormData;i.append(l.name,s),Object.keys(l.data).forEach((e=>{i.append(e,l.data[e])})),z.upload(i).then((e=>{t(e)})).catch((e=>{a(e)}))}))}function C(){_.warning("最多只能上传"+l.limit+"张图片")}const F=(e,l)=>{_.success("上传成功");const t=f.value.findIndex((e=>e.uid===l.uid));-1!==t&&(f.value[t].url=e.url,f.value[t].status="success",c.value[t]=e.url)},k=e=>{_.error("上传失败: "+e.message)},S=()=>{s.value=!1};return x((()=>{f.value=c.value.map((e=>({url:e})))})),(e,t)=>{const a=i("Plus"),_=v,x=i("zoom-in"),M=i("Delete"),E=V,O=I;return n(),u(w,null,[r(E,{"file-list":p(f),"onUpdate:fileList":t[0]||(t[0]=e=>d(f)?f.value=e:null),"list-type":"picture-card","before-upload":g,"http-request":h,"on-success":F,"on-error":k,"on-exceed":C,accept:l.accept,limit:l.limit,multiple:""},{file:m((({file:e})=>[y("div",D,[y("img",{class:"el-upload-list__item-thumbnail",src:e.url},null,8,A),y("span",H,[y("span",{onClick:l=>{return t=e.url,o.value=c.value.findIndex((e=>e===t)),void(s.value=!0);var t}},[r(_,null,{default:m((()=>[r(x)])),_:1})],8,B),y("span",{onClick:l=>{return t=e.url,void z.delete(t).then((()=>{const e=c.value.indexOf(t);-1!==e&&(c.value.splice(e,1),f.value.splice(e,1))}));var t}},[r(_,null,{default:m((()=>[r(M)])),_:1})],8,K)])])])),default:m((()=>[r(_,null,{default:m((()=>[r(a)])),_:1})])),_:1},8,["file-list","accept","limit"]),p(s)?(n(),j(O,{key:0,"zoom-rate":1.2,"initial-index":p(o),"url-list":c.value,onClose:S},null,8,["initial-index","url-list"])):b("",!0)],64)}}}),Z={class:"app-container"},$=e({__name:"upload",setup(e){const l=a("https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"),t=a(["https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"]),s=a([{name:"照片1.jpg",url:"https://s2.loli.net/2023/05/24/yNsxFC8rLHMZQcK.jpg"},{name:"照片2.jpg",url:"https://s2.loli.net/2023/05/24/RuHFMwW4rG5lIqs.jpg"}]);return(e,a)=>{const i=O,o=P,f=C,y=L,v=F;return n(),u("div",Z,[r(i,{href:"https://gitee.com/youlaiorg/vue3-element-admin/blob/master/src/views/demo/upload.vue",type:"primary",target:"_blank",class:"mb-10"},{default:m((()=>a[3]||(a[3]=[c(" 示例源码 请点击>>>> ")]))),_:1}),r(v,null,{default:m((()=>[r(f,{label:"单图上传"},{default:m((()=>[r(o,{modelValue:p(l),"onUpdate:modelValue":a[0]||(a[0]=e=>d(l)?l.value=e:null)},null,8,["modelValue"])])),_:1}),r(f,{label:"多图上传"},{default:m((()=>[r(Q,{modelValue:p(t),"onUpdate:modelValue":a[1]||(a[1]=e=>d(t)?t.value=e:null),limit:2},null,8,["modelValue"])])),_:1}),r(f,{label:"文件上传"},{default:m((()=>[r(y,{modelValue:p(s),"onUpdate:modelValue":a[2]||(a[2]=e=>d(s)?s.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1})])}}});export{$ as default};
