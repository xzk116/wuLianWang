import{d as e,s as t,r as s,S as n,o as r,df as o,ar as i,g as a,f as l,m as c,w as u,C as d,F as h,i as p,e as f,h as m,E as g,a0 as v,P as y,Q as w,n as _,W as b,ap as A,bi as x,j as S,aD as C,aX as I}from"./index-D_4mb3Vt.js";import{E as k}from"./drawer-DC7ZSK5m.js";import"./overlay-BxRxSiXw.js";import{E as R}from"./dialog-Dr69udxU.js";import{E as $}from"./card-DGDXLX3Y.js";/* empty css            */import{E as O,a as E}from"./select-UjV5mHDL.js";import"./scrollbar-BpSSelpP.js";import"./popper-DC4-MAEs.js";import{E as j}from"./button-CWW6AGHt.js";import P from"./messageComp-Cp5rkJaC.js";import{E as T}from"./message-box-Dywoq7Bx.js";import"./input-DJ1hrWmu.js";import{_ as M}from"./plugin-vueexport-helper-BCo6x5W8.js";import"./index-DpryeAo3.js";import"./use-dialog-BisRRgDQ.js";import"./event-BwRzfsZt.js";import"./use-form-common-props-B1zl3Cbv.js";import"./isUndefined-DgmxjSXK.js";import"./index-ClDlwkbu.js";import"./vnode-Bk8efZVY.js";import"./error-D_Dr4eZ1.js";import"./scroll-Cs2n0-YO.js";import"./refs-ZES57MJJ.js";import"./index-B3emz3nT.js";import"./token-DWNpOE8r.js";import"./strings-MakwBtL-.js";import"./castArray-DGB-sf6V.js";import"./isEqual-CZPneuGK.js";import"./Uint8Array-DXl9uVUv.js";import"./arrayPush-BFgcotFS.js";import"./index-DQC5d6in.js";import"./debounce-juRro3Mb.js";import"./baseIteratee-BBe1UpIx.js";import"./index-CQCx7j08.js";import"./index-kacKUQQx.js";import"./validator-OPGJP1Ru.js";import"./index-DPxcB5Ii.js";const N=""+new URL("db-C5HENFx3.png",import.meta.url).href;function B(e,t,s,n,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}function L(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let D=function(){const{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return D=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(+e^s()&15>>+e/4).toString(16)))};function U(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const q=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class W extends Error{}class F extends W{constructor(e,t,s,n){super(`${F.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=null==n?void 0:n.get("x-request-id"),this.error=t;const r=t;this.code=null==r?void 0:r.code,this.param=null==r?void 0:r.param,this.type=null==r?void 0:r.type}static makeMessage(e,t,s){const n=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new H({message:s,cause:q(t)});const r=null==t?void 0:t.error;return 400===e?new J(e,r,s,n):401===e?new V(e,r,s,n):403===e?new z(e,r,s,n):404===e?new Q(e,r,s,n):409===e?new Y(e,r,s,n):422===e?new G(e,r,s,n):429===e?new Z(e,r,s,n):e>=500?new ee(e,r,s,n):new F(e,r,s,n)}}class X extends F{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class H extends F{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class K extends H{constructor({message:e}={}){super({message:e??"Request timed out."})}}class J extends F{}class V extends F{}class z extends F{}class Q extends F{}class Y extends F{}class G extends F{}class Z extends F{}class ee extends F{}class te extends W{constructor(){super("Could not parse response content as the length limit was reached")}}class se extends W{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}const ne=/^[a-z][a-z0-9+.-]*:/i;function re(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}const oe=e=>new Promise((t=>setTimeout(t,e))),ie={off:0,error:200,warn:300,info:400,debug:500},ae=(e,t,s)=>{var n,r;if(e)return n=ie,r=e,Object.prototype.hasOwnProperty.call(n,r)?e:void he(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ie))}`)};function le(){}function ce(e,t,s){return!t||ie[e]>ie[s]?le:t[e].bind(t)}const ue={error:le,warn:le,info:le,debug:le};let de=new WeakMap;function he(e){const t=e.logger,s=e.logLevel??"off";if(!t)return ue;const n=de.get(t);if(n&&n[0]===s)return n[1];const r={error:ce("error",t,s),warn:ce("warn",t,s),info:ce("info",t,s),debug:ce("debug",t,s)};return de.set(t,[s,r]),r}const pe=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map((([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t])))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e),fe="5.0.2";const me=()=>{var e;const t="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===t)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":ve(Deno.build.os),"X-Stainless-Arch":ge(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:(null==(e=Deno.version)?void 0:e.deno)??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===t)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":ve(globalThis.process.platform??"unknown"),"X-Stainless-Arch":ge(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const s=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fe,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const ge=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ve=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let ye;function we(...e){const t=globalThis.ReadableStream;if(void 0===t)throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function _e(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return we({start(){},async pull(e){const{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){var e;await(null==(e=t.return)?void 0:e.call(t))}})}function be(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Ae=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),xe="RFC3986",Se={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},Ce=Array.isArray,Ie=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),ke=1024;function Re(e,t){if(Ce(e)){const s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}const $e=Object.prototype.hasOwnProperty,Oe={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},Ee=Array.isArray,je=Array.prototype.push,Pe=function(e,t){je.apply(e,Ee(t)?t:[t])},Te=Date.prototype.toISOString,Me={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===s)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let i="";for(let a=0;a<o.length;a+=ke){const e=o.length>=ke?o.slice(a,a+ke):o,t=[];for(let s=0;s<e.length;++s){let n=e.charCodeAt(s);45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)?t[t.length]=e.charAt(s):n<128?t[t.length]=Ie[n]:n<2048?t[t.length]=Ie[192|n>>6]+Ie[128|63&n]:n<55296||n>=57344?t[t.length]=Ie[224|n>>12]+Ie[128|n>>6&63]+Ie[128|63&n]:(s+=1,n=65536+((1023&n)<<10|1023&e.charCodeAt(s)),t[t.length]=Ie[240|n>>18]+Ie[128|n>>12&63]+Ie[128|n>>6&63]+Ie[128|63&n])}i+=t.join("")}return i},encodeValuesOnly:!1,format:xe,formatter:Se[xe],indices:!1,serializeDate:e=>Te.call(e),skipNulls:!1,strictNullHandling:!1};const Ne={};function Be(e,t,s,n,r,o,i,a,l,c,u,d,h,p,f,m,g,v){let y=e,w=v,_=0,b=!1;for(;void 0!==(w=w.get(Ne))&&!b;){const t=w.get(e);if(_+=1,void 0!==t){if(t===_)throw new RangeError("Cyclic object value");b=!0}void 0===w.get(Ne)&&(_=0)}if("function"==typeof c?y=c(t,y):y instanceof Date?y=null==h?void 0:h(y):"comma"===s&&Ee(y)&&(y=Re(y,(function(e){return e instanceof Date?null==h?void 0:h(e):e}))),null===y){if(o)return l&&!m?l(t,Me.encoder,g,"key",p):t;y=""}if("string"==typeof(A=y)||"number"==typeof A||"boolean"==typeof A||"symbol"==typeof A||"bigint"==typeof A||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(y)){if(l){const e=m?t:l(t,Me.encoder,g,"key",p);return[(null==f?void 0:f(e))+"="+(null==f?void 0:f(l(y,Me.encoder,g,"value",p)))]}return[(null==f?void 0:f(t))+"="+(null==f?void 0:f(String(y)))]}var A;const x=[];if(void 0===y)return x;let S;if("comma"===s&&Ee(y))m&&l&&(y=Re(y,l)),S=[{value:y.length>0?y.join(",")||null:void 0}];else if(Ee(c))S=c;else{const e=Object.keys(y);S=u?e.sort(u):e}const C=a?String(t).replace(/\./g,"%2E"):String(t),I=n&&Ee(y)&&1===y.length?C+"[]":C;if(r&&Ee(y)&&0===y.length)return I+"[]";for(let k=0;k<S.length;++k){const t=S[k],w="object"==typeof t&&void 0!==t.value?t.value:y[t];if(i&&null===w)continue;const b=d&&a?t.replace(/\./g,"%2E"):t,A=Ee(y)?"function"==typeof s?s(I,b):I:I+(d?"."+b:"["+b+"]");v.set(e,_);const C=new WeakMap;C.set(Ne,v),Pe(x,Be(w,A,s,n,r,o,i,a,"comma"===s&&m&&Ee(y)?null:l,c,u,d,h,p,f,m,g,C))}return x}function Le(e,t={}){let s=e;const n=function(e=Me){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||Me.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let s=xe;if(void 0!==e.format){if(!$e.call(Se,e.format))throw new TypeError("Unknown format option provided.");s=e.format}const n=Se[s];let r,o=Me.filter;if(("function"==typeof e.filter||Ee(e.filter))&&(o=e.filter),r=e.arrayFormat&&e.arrayFormat in Oe?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":Me.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=void 0===e.allowDots?1==!!e.encodeDotInKeys||Me.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:Me.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:Me.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:Me.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?Me.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:Me.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:Me.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:Me.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:Me.encodeValuesOnly,filter:o,format:s,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:Me.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:Me.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:Me.strictNullHandling}}(t);let r,o;"function"==typeof n.filter?(o=n.filter,s=o("",s)):Ee(n.filter)&&(o=n.filter,r=o);const i=[];if("object"!=typeof s||null===s)return"";const a=Oe[n.arrayFormat],l="comma"===a&&n.commaRoundTrip;r||(r=Object.keys(s)),n.sort&&r.sort(n.sort);const c=new WeakMap;for(let h=0;h<r.length;++h){const e=r[h];n.skipNulls&&null===s[e]||Pe(i,Be(s[e],e,a,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const u=i.join(n.delimiter);let d=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}let De,Ue;function qe(e){let t;return(De??(t=new globalThis.TextEncoder,De=t.encode.bind(t)))(e)}function We(e){let t;return(Ue??(t=new globalThis.TextDecoder,Ue=t.decode.bind(t)))(e)}var Fe,Xe,He,Ke;class Je{constructor(){Fe.set(this,void 0),Xe.set(this,void 0),B(this,Fe,new Uint8Array),B(this,Xe,null)}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?qe(e):e;B(this,Fe,function(e){let t=0;for(const r of e)t+=r.length;const s=new Uint8Array(t);let n=0;for(const r of e)s.set(r,n),n+=r.length;return s}([L(this,Fe,"f"),t]));const s=[];let n;for(;null!=(n=Ve(L(this,Fe,"f"),L(this,Xe,"f")));){if(n.carriage&&null==L(this,Xe,"f")){B(this,Xe,n.index);continue}if(null!=L(this,Xe,"f")&&(n.index!==L(this,Xe,"f")+1||n.carriage)){s.push(We(L(this,Fe,"f").subarray(0,L(this,Xe,"f")-1))),B(this,Fe,L(this,Fe,"f").subarray(L(this,Xe,"f"))),B(this,Xe,null);continue}const e=null!==L(this,Xe,"f")?n.preceding-1:n.preceding,t=We(L(this,Fe,"f").subarray(0,e));s.push(t),B(this,Fe,L(this,Fe,"f").subarray(n.index)),B(this,Xe,null)}return s}flush(){return L(this,Fe,"f").length?this.decode("\n"):[]}}function Ve(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}function ze(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}Fe=new WeakMap,Xe=new WeakMap,Je.NEWLINE_CHARS=new Set(["\n","\r"]),Je.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Qe{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new Qe((async function*(){if(s)throw new W("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const s of async function*(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new W("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new W("Attempted to iterate over a response with no body")}const s=new Ye,n=new Je,r=be(e.body);for await(const o of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?qe(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=ze(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const e of n.decode(o)){const t=s.decode(e);t&&(yield t)}for(const o of n.flush()){const e=s.decode(o);e&&(yield e)}}(e,t))if(!n)if(s.data.startsWith("[DONE]"))n=!0;else if(null===s.event||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let t;try{t=JSON.parse(s.data)}catch(r){throw r}if(t&&t.error)throw new F(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(s.data)}catch(r){throw r}if("error"==s.event)throw new F(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}n=!0}catch(r){if(U(r))return;throw r}finally{n||t.abort()}}),t)}static fromReadableStream(e,t){let s=!1;return new Qe((async function*(){if(s)throw new W("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const t of async function*(){const t=new Je,s=be(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(r){if(U(r))return;throw r}finally{n||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new Qe((()=>n(e)),this.controller),new Qe((()=>n(t)),this.controller)]}toReadableStream(){const e=this;let t;return we({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:s,done:n}=await t.next();if(n)return e.close();const r=qe(JSON.stringify(s)+"\n");e.enqueue(r)}catch(s){e.error(s)}},async cancel(){var e;await(null==(e=t.return)?void 0:e.call(t))}})}}class Ye{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){const s=e.indexOf(t);if(-1!==s)return[e.substring(0,s),t,e.substring(s+t.length)];return[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function Ge(e,t){const{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:o}=t,i=await(async()=>{var n;if(t.options.stream)return he(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(s,t.controller):Qe.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;const r=s.headers.get("content-type"),o=null==(n=null==r?void 0:r.split(";")[0])?void 0:n.trim();if((null==o?void 0:o.includes("application/json"))||(null==o?void 0:o.endsWith("+json"))){return Ze(await s.json(),s)}return await s.text()})();return he(e).debug(`[${n}] response parsed`,pe({retryOfRequestLogID:r,url:s.url,status:s.status,body:i,durationMs:Date.now()-o})),i}function Ze(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class et extends Promise{constructor(e,t,s=Ge){super((e=>{e(null)})),this.responsePromise=t,this.parseResponse=s,He.set(this,void 0),B(this,He,e)}_thenUnwrap(e){return new et(L(this,He,"f"),this.responsePromise,(async(t,s)=>Ze(e(await this.parseResponse(t,s),s),s.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then((e=>this.parseResponse(L(this,He,"f"),e)))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}He=new WeakMap;class tt{constructor(e,t,s,n){Ke.set(this,void 0),B(this,Ke,e),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new W("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await L(this,Ke,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ke=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class st extends et{constructor(e,t,s){super(e,t,(async(e,t)=>new s(e,t.response,await Ge(e,t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}class nt extends tt{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class rt extends tt{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;const t=this.getPaginatedItems(),s=null==(e=t[t.length-1])?void 0:e.id;return s?{...this.options,query:{...(n=this.options.query,"object"!=typeof n?{}:n??{}),after:s}}:null;var n}}const ot=()=>{var e;if("undefined"==typeof File){const{process:t}=globalThis,s="string"==typeof(null==(e=null==t?void 0:t.versions)?void 0:e.node)&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(s?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function it(e,t,s){return ot(),new File(e,t??"unknown_file",s)}function at(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const lt=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],ct=async(e,t)=>({...e,body:await dt(e.body,t)}),ut=new WeakMap;const dt=async(e,t)=>{if(!(await function(e){const t="function"==typeof e?e:e.fetch,s=ut.get(t);if(s)return s;const n=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;return s.toString()!==await new e(s).text()}catch{return!0}})();return ut.set(t,n),n}(t)))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const s=new FormData;return await Promise.all(Object.entries(e||{}).map((([e,t])=>ht(s,e,t)))),s},ht=async(e,t,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,it([await s.blob()],at(s)));else if(lt(s))e.append(t,it([await new Response(_e(s)).blob()],at(s)));else if((e=>e instanceof Blob&&"name"in e)(s))e.append(t,s,at(s));else if(Array.isArray(s))await Promise.all(s.map((s=>ht(e,t+"[]",s))));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map((([s,n])=>ht(e,`${t}[${s}]`,n))))}}},pt=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function ft(e){var t;let s=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)s.push(e);else if(pt(e))s.push(e instanceof Blob?e:await e.arrayBuffer());else{if(!lt(e)){const s=null==(t=null==e?void 0:e.constructor)?void 0:t.name;throw new Error(`Unexpected data type: ${typeof e}${s?`; constructor: ${s}`:""}${function(e){if("object"!=typeof e||null===e)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`)}for await(const t of e)s.push(...await ft(t))}return s}class mt{constructor(e){this._client=e}}function gt(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const vt=((e=gt)=>function(t,...s){if(1===t.length)return t[0];let n=!1;const r=t.reduce(((t,r,o)=>(/[?#]/.test(r)&&(n=!0),t+r+(o===s.length?"":(n?encodeURIComponent:e)(String(s[o]))))),""),o=r.split(/[?#]/,1)[0],i=[],a=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let l;for(;null!==(l=a.exec(o));)i.push({start:l.index,length:l[0].length});if(i.length>0){let e=0;const t=i.reduce(((t,s)=>{const n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r}),"");throw new W(`Path parameters result in path with invalid segments:\n${r}\n${t}`)}return r})(gt);let yt=class extends mt{list(e,t={},s){return this._client.getAPIList(vt`/chat/completions/${e}/messages`,rt,{query:t,...s})}};function wt(e){return"function"==typeof e.parse}const _t=e=>"assistant"===(null==e?void 0:e.role),bt=e=>"tool"===(null==e?void 0:e.role);var At,xt,St,Ct,It,kt,Rt,$t,Ot,Et,jt,Pt,Tt,Mt,Nt,Bt,Lt,Dt,Ut,qt,Wt;class Ft{constructor(){At.add(this),this.controller=new AbortController,xt.set(this,void 0),St.set(this,(()=>{})),Ct.set(this,(()=>{})),It.set(this,void 0),kt.set(this,(()=>{})),Rt.set(this,(()=>{})),$t.set(this,{}),Ot.set(this,!1),Et.set(this,!1),jt.set(this,!1),Pt.set(this,!1),B(this,xt,new Promise(((e,t)=>{B(this,St,e),B(this,Ct,t)}))),B(this,It,new Promise(((e,t)=>{B(this,kt,e),B(this,Rt,t)}))),L(this,xt,"f").catch((()=>{})),L(this,It,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),L(this,At,"m",Tt).bind(this))}),0)}_connected(){this.ended||(L(this,St,"f").call(this),this._emit("connect"))}get ended(){return L(this,Ot,"f")}get errored(){return L(this,Et,"f")}get aborted(){return L(this,jt,"f")}abort(){this.controller.abort()}on(e,t){return(L(this,$t,"f")[e]||(L(this,$t,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=L(this,$t,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(L(this,$t,"f")[e]||(L(this,$t,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{B(this,Pt,!0),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){B(this,Pt,!0),await L(this,It,"f")}_emit(e,...t){if(L(this,Ot,"f"))return;"end"===e&&(B(this,Ot,!0),L(this,kt,"f").call(this));const s=L(this,$t,"f")[e];if(s&&(L(this,$t,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return L(this,Pt,"f")||(null==s?void 0:s.length)||Promise.reject(e),L(this,Ct,"f").call(this,e),L(this,Rt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];L(this,Pt,"f")||(null==s?void 0:s.length)||Promise.reject(e),L(this,Ct,"f").call(this,e),L(this,Rt,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function Xt(e){return"auto-parseable-response-format"===(null==e?void 0:e.$brand)}function Ht(e){return"auto-parseable-tool"===(null==e?void 0:e.$brand)}function Kt(e,t){const s=e.choices.map((e=>{var s;if("length"===e.finish_reason)throw new te;if("content_filter"===e.finish_reason)throw new se;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:(null==(s=e.message.tool_calls)?void 0:s.map((e=>function(e,t){var s;const n=null==(s=e.tools)?void 0:s.find((e=>{var s;return(null==(s=e.function)?void 0:s.name)===t.function.name}));return{...t,function:{...t.function,parsed_arguments:Ht(n)?n.$parseRaw(t.function.arguments):(null==n?void 0:n.function.strict)?JSON.parse(t.function.arguments):null}}}(t,e))))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?Jt(t,e.message.content):null}}}));return{...e,choices:s}}function Jt(e,t){var s,n;if("json_schema"!==(null==(s=e.response_format)?void 0:s.type))return null;if("json_schema"===(null==(n=e.response_format)?void 0:n.type)){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function Vt(e,t){var s;if(!e)return!1;const n=null==(s=e.tools)?void 0:s.find((e=>{var s;return(null==(s=e.function)?void 0:s.name)===t.function.name}));return Ht(n)||(null==n?void 0:n.function.strict)||!1}function zt(e){var t;return!!Xt(e.response_format)||((null==(t=e.tools)?void 0:t.some((e=>Ht(e)||"function"===e.type&&!0===e.function.strict)))??!1)}xt=new WeakMap,St=new WeakMap,Ct=new WeakMap,It=new WeakMap,kt=new WeakMap,Rt=new WeakMap,$t=new WeakMap,Ot=new WeakMap,Et=new WeakMap,jt=new WeakMap,Pt=new WeakMap,At=new WeakSet,Tt=function(e){if(B(this,Et,!0),e instanceof Error&&"AbortError"===e.name&&(e=new X),e instanceof X)return B(this,jt,!0),this._emit("abort",e);if(e instanceof W)return this._emit("error",e);if(e instanceof Error){const t=new W(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new W(String(e)))};const Qt=10;class Yt extends Ft{constructor(){super(...arguments),Mt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var t;this._chatCompletions.push(e),this._emit("chatCompletion",e);const s=null==(t=e.choices[0])?void 0:t.message;return s&&this._addMessage(s),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),bt(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(_t(e)&&e.tool_calls)for(const s of e.tool_calls)"function"===s.type&&this._emit("functionToolCall",s.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new W("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),L(this,Mt,"m",Nt).call(this)}async finalMessage(){return await this.done(),L(this,Mt,"m",Bt).call(this)}async finalFunctionToolCall(){return await this.done(),L(this,Mt,"m",Lt).call(this)}async finalFunctionToolCallResult(){return await this.done(),L(this,Mt,"m",Dt).call(this)}async totalUsage(){return await this.done(),L(this,Mt,"m",Ut).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=L(this,Mt,"m",Bt).call(this);t&&this._emit("finalMessage",t);const s=L(this,Mt,"m",Nt).call(this);s&&this._emit("finalContent",s);const n=L(this,Mt,"m",Lt).call(this);n&&this._emit("finalFunctionToolCall",n);const r=L(this,Mt,"m",Dt).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",L(this,Mt,"m",Ut).call(this))}async _createChatCompletion(e,t,s){const n=null==s?void 0:s.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),L(this,Mt,"m",qt).call(this,t);const r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Kt(r,t))}async _runChatCompletion(e,t,s){for(const n of t.messages)this._addMessage(n,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){var n,r,o;const i="tool",{tool_choice:a="auto",stream:l,...c}=t,u="string"!=typeof a&&(null==(n=null==a?void 0:a.function)?void 0:n.name),{maxChatCompletions:d=Qt}=s||{},h=t.tools.map((e=>{if(Ht(e)){if(!e.$callback)throw new W("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),p={};for(const g of h)"function"===g.type&&(p[g.function.name||g.function.function.name]=g.function);const f="tools"in t?h.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<d;++g){const t=null==(r=(await this._createChatCompletion(e,{...c,tool_choice:a,tools:f,messages:[...this.messages]},s)).choices[0])?void 0:r.message;if(!t)throw new W("missing message in ChatCompletion response");if(!(null==(o=t.tool_calls)?void 0:o.length))return;for(const e of t.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:s,arguments:n}=e.function,r=p[s];if(!r){const e=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${Object.keys(p).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:t,content:e});continue}if(u&&u!==s){const e=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:i,tool_call_id:t,content:e});continue}let o;try{o=wt(r)?await r.parse(n):n}catch(m){const e=m instanceof Error?m.message:String(m);this._addMessage({role:i,tool_call_id:t,content:e});continue}const a=await r.function(o,this),l=L(this,Mt,"m",Wt).call(this,a);if(this._addMessage({role:i,tool_call_id:t,content:l}),u)return}}}}Mt=new WeakSet,Nt=function(){return L(this,Mt,"m",Bt).call(this).content??null},Bt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(_t(t)){return{...t,content:t.content??null,refusal:t.refusal??null}}}throw new W("stream ended without producing a ChatCompletionMessage with role=assistant")},Lt=function(){var e,t;for(let s=this.messages.length-1;s>=0;s--){const n=this.messages[s];if(_t(n)&&(null==(e=null==n?void 0:n.tool_calls)?void 0:e.length))return null==(t=n.tool_calls.at(-1))?void 0:t.function}},Dt=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(bt(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>{var s;return"assistant"===e.role&&(null==(s=e.tool_calls)?void 0:s.some((e=>"function"===e.type&&e.id===t.tool_call_id)))})))return t.content}},Ut=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},qt=function(e){if(null!=e.n&&e.n>1)throw new W("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Wt=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Gt extends Yt{static runTools(e,t,s){const n=new Gt,r={...s,headers:{...null==s?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}_addMessage(e,t=!0){super._addMessage(e,t),_t(e)&&e.content&&this._emit("content",e.content)}}const Zt=1,es=2,ts=4,ss=8,ns=16,rs=32,os=64,is=128,as=256,ls=511;class cs extends Error{}class us extends Error{}const ds=(e,t)=>{const s=e.length;let n=0;const r=e=>{throw new cs(`${e} at position ${n}`)},o=e=>{throw new us(`${e} at position ${n}`)},i=()=>(d(),n>=s&&r("Unexpected end of input"),'"'===e[n]?a():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||ns&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||rs&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||rs&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||is&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,Infinity):"-Infinity"===e.substring(n,n+9)||as&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-Infinity):"NaN"===e.substring(n,n+3)||os&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u()),a=()=>{const i=n;let a=!1;for(n++;n<s&&('"'!==e[n]||a&&"\\"===e[n-1]);)a="\\"===e[n]&&!a,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(i,++n-Number(a)))}catch(l){o(String(l))}else if(Zt&t)try{return JSON.parse(e.substring(i,n-Number(a))+'"')}catch(l){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,d();const o={};try{for(;"}"!==e[n];){if(d(),n>=s&&ss&t)return o;const r=a();d(),n++;try{const e=i();Object.defineProperty(o,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(l){if(ss&t)return o;throw l}d(),","===e[n]&&n++}}catch(l){if(ss&t)return o;r("Expected '}' at end of object")}return n++,o},c=()=>{n++;const s=[];try{for(;"]"!==e[n];)s.push(i()),d(),","===e[n]&&n++}catch(o){if(ts&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&es&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(a){if(es&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(l){}o(String(a))}}const i=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||es&t||r("Unterminated number literal");try{return JSON.parse(e.substring(i,n))}catch(a){"-"===e.substring(i,n)&&es&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(l){o(String(l))}}},d=()=>{for(;n<s&&" \n\r\t".includes(e[n]);)n++};return i()},hs=e=>function(e,t=ls){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return ds(e.trim(),t)}(e,ls^es);var ps,fs,ms,gs,vs,ys,ws,_s,bs,As,xs,Ss;class Cs extends Yt{constructor(e){super(),ps.add(this),fs.set(this,void 0),ms.set(this,void 0),gs.set(this,void 0),B(this,fs,e),B(this,ms,[])}get currentChatCompletionSnapshot(){return L(this,gs,"f")}static fromReadableStream(e){const t=new Cs(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,s){const n=new Cs(t);return n._run((()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...null==s?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}}))),n}async _createChatCompletion(e,t,s){var n;super._createChatCompletion;const r=null==s?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),L(this,ps,"m",vs).call(this);const o=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const i of o)L(this,ps,"m",ws).call(this,i);if(null==(n=o.controller.signal)?void 0:n.aborted)throw new X;return this._addChatCompletion(L(this,ps,"m",As).call(this))}async _fromReadableStream(e,t){var s;const n=null==t?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),L(this,ps,"m",vs).call(this),this._connected();const r=Qe.fromReadableStream(e,this.controller);let o;for await(const i of r)o&&o!==i.id&&this._addChatCompletion(L(this,ps,"m",As).call(this)),L(this,ps,"m",ws).call(this,i),o=i.id;if(null==(s=r.controller.signal)?void 0:s.aborted)throw new X;return this._addChatCompletion(L(this,ps,"m",As).call(this))}[(fs=new WeakMap,ms=new WeakMap,gs=new WeakMap,ps=new WeakSet,vs=function(){this.ended||B(this,gs,void 0)},ys=function(e){let t=L(this,ms,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},L(this,ms,"f")[e.index]=t,t)},ws=function(e){var t,s,n,r,o,i,a,l,c,u,d,h,p,f,m;if(this.ended)return;const g=L(this,ps,"m",Ss).call(this,e);this._emit("chunk",e,g);for(const v of e.choices){const e=g.choices[v.index];null!=v.delta.content&&"assistant"===(null==(t=e.message)?void 0:t.role)&&(null==(s=e.message)?void 0:s.content)&&(this._emit("content",v.delta.content,e.message.content),this._emit("content.delta",{delta:v.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=v.delta.refusal&&"assistant"===(null==(n=e.message)?void 0:n.role)&&(null==(r=e.message)?void 0:r.refusal)&&this._emit("refusal.delta",{delta:v.delta.refusal,snapshot:e.message.refusal}),null!=(null==(o=v.logprobs)?void 0:o.content)&&"assistant"===(null==(i=e.message)?void 0:i.role)&&this._emit("logprobs.content.delta",{content:null==(a=v.logprobs)?void 0:a.content,snapshot:(null==(l=e.logprobs)?void 0:l.content)??[]}),null!=(null==(c=v.logprobs)?void 0:c.refusal)&&"assistant"===(null==(u=e.message)?void 0:u.role)&&this._emit("logprobs.refusal.delta",{refusal:null==(d=v.logprobs)?void 0:d.refusal,snapshot:(null==(h=e.logprobs)?void 0:h.refusal)??[]});const y=L(this,ps,"m",ys).call(this,e);e.finish_reason&&(L(this,ps,"m",bs).call(this,e),null!=y.current_tool_call_index&&L(this,ps,"m",_s).call(this,e,y.current_tool_call_index));for(const t of v.delta.tool_calls??[])y.current_tool_call_index!==t.index&&(L(this,ps,"m",bs).call(this,e),null!=y.current_tool_call_index&&L(this,ps,"m",_s).call(this,e,y.current_tool_call_index)),y.current_tool_call_index=t.index;for(const t of v.delta.tool_calls??[]){const s=null==(p=e.message.tool_calls)?void 0:p[t.index];(null==s?void 0:s.type)&&("function"===(null==s?void 0:s.type)?this._emit("tool_calls.function.arguments.delta",{name:null==(f=s.function)?void 0:f.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:(null==(m=t.function)?void 0:m.arguments)??""}):null==s||s.type)}}},_s=function(e,t){var s,n,r;if(L(this,ps,"m",ys).call(this,e).done_tool_calls.has(t))return;const o=null==(s=e.message.tool_calls)?void 0:s[t];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if("function"===o.type){const e=null==(r=null==(n=L(this,fs,"f"))?void 0:n.tools)?void 0:r.find((e=>"function"===e.type&&e.function.name===o.function.name));this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:t,arguments:o.function.arguments,parsed_arguments:Ht(e)?e.$parseRaw(o.function.arguments):(null==e?void 0:e.function.strict)?JSON.parse(o.function.arguments):null})}else o.type},bs=function(e){var t,s;const n=L(this,ps,"m",ys).call(this,e);if(e.message.content&&!n.content_done){n.content_done=!0;const t=L(this,ps,"m",xs).call(this);this._emit("content.done",{content:e.message.content,parsed:t?t.$parseRaw(e.message.content):null})}e.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),(null==(t=e.logprobs)?void 0:t.content)&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),(null==(s=e.logprobs)?void 0:s.refusal)&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},As=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");const e=L(this,gs,"f");if(!e)throw new W("request ended without sending any chunks");return B(this,gs,void 0),B(this,ms,[]),function(e,t){const{id:s,choices:n,created:r,model:o,system_fingerprint:i,...a}=e,l={...a,id:s,choices:n.map((({message:t,finish_reason:s,index:n,logprobs:r,...o})=>{if(!s)throw new W(`missing finish_reason for choice ${n}`);const{content:i=null,function_call:a,tool_calls:l,...c}=t,u=t.role;if(!u)throw new W(`missing role for choice ${n}`);if(a){const{arguments:e,name:l}=a;if(null==e)throw new W(`missing function_call.arguments for choice ${n}`);if(!l)throw new W(`missing function_call.name for choice ${n}`);return{...o,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...o,index:n,finish_reason:s,logprobs:r,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map(((t,s)=>{const{function:r,type:o,id:i,...a}=t,{arguments:l,name:c,...u}=r||{};if(null==i)throw new W(`missing choices[${n}].tool_calls[${s}].id\n${Is(e)}`);if(null==o)throw new W(`missing choices[${n}].tool_calls[${s}].type\n${Is(e)}`);if(null==c)throw new W(`missing choices[${n}].tool_calls[${s}].function.name\n${Is(e)}`);if(null==l)throw new W(`missing choices[${n}].tool_calls[${s}].function.arguments\n${Is(e)}`);return{...a,id:i,type:o,function:{...u,name:c,arguments:l}}}))}}:{...o,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}})),created:r,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&zt(t)?Kt(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}})))}}(l,t)}(e,L(this,fs,"f"))},xs=function(){var e;const t=null==(e=L(this,fs,"f"))?void 0:e.response_format;return Xt(t)?t:null},Ss=function(e){var t,s,n,r;let o=L(this,gs,"f");const{choices:i,...a}=e;o?Object.assign(o,a):o=B(this,gs,{...a,choices:[]});for(const{delta:l,finish_reason:c,index:u,logprobs:d=null,...h}of e.choices){let e=o.choices[u];if(e||(e=o.choices[u]={finish_reason:c,index:u,message:{},logprobs:d,...h}),d)if(e.logprobs){const{content:n,refusal:r,...o}=d;Object.assign(e.logprobs,o),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},d);if(c&&(e.finish_reason=c,L(this,fs,"f")&&zt(L(this,fs,"f")))){if("length"===c)throw new te;if("content_filter"===c)throw new se}if(Object.assign(e,h),!l)continue;const{content:i,refusal:a,function_call:p,role:f,tool_calls:m,...g}=l;if(Object.assign(e.message,g),a&&(e.message.refusal=(e.message.refusal||"")+a),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),i&&(e.message.content=(e.message.content||"")+i,!e.message.refusal&&L(this,ps,"m",xs).call(this)&&(e.message.parsed=hs(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:s,type:n,function:o,...i}of m){const a=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(a,i),s&&(a.id=s),n&&(a.type=n),o&&(a.function??(a.function={name:o.name??"",arguments:""})),(null==o?void 0:o.name)&&(a.function.name=o.name),(null==o?void 0:o.arguments)&&(a.function.arguments+=o.arguments,Vt(L(this,fs,"f"),a)&&(a.function.parsed_arguments=hs(a.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Qe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Is(e){return JSON.stringify(e)}class ks extends Cs{static fromReadableStream(e){const t=new ks(null);return t._run((()=>t._fromReadableStream(e))),t}static runTools(e,t,s){const n=new ks(t),r={...s,headers:{...null==s?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}}let Rs=class extends mt{constructor(){super(...arguments),this.messages=new yt(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(vt`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(vt`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",rt,{query:e,...t})}delete(e,t){return this._client.delete(vt`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new W(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new W(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...null==t?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap((t=>Kt(t,e)))}runTools(e,t){return e.stream?ks.runTools(this._client,e,t):Gt.runTools(this._client,e,t)}stream(e,t){return Cs.createChatCompletion(this._client,e,t)}};Rs.Messages=yt;class $s extends mt{constructor(){super(...arguments),this.completions=new Rs(this._client)}}$s.Completions=Rs;const Os=Symbol("brand.privateNullableHeaders"),Es=Array.isArray;function*js(e){if(!e)return;if(Os in e){const{values:t,nulls:s}=e;yield*t.entries();for(const e of s)yield[e,null];return}let t,s=!1;e instanceof Headers?t=e.entries():Es(e)?t=e:(s=!0,t=Object.entries(e??{}));for(let n of t){const e=n[0];if("string"!=typeof e)throw new TypeError("expected header name to be a string");const t=Es(n[1])?n[1]:[n[1]];let r=!1;for(const n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}const Ps=e=>{const t=new Headers,s=new Set;for(const n of e){const e=new Set;for(const[r,o]of js(n)){const n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===o?(t.delete(r),s.add(n)):(t.append(r,o),s.delete(n))}}return{[Os]:!0,values:t,nulls:s}};class Ts extends mt{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:Ps([{Accept:"application/octet-stream"},null==t?void 0:t.headers]),__binaryResponse:!0})}}class Ms extends mt{create(e,t){return this._client.post("/audio/transcriptions",ct({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class Ns extends mt{create(e,t){return this._client.post("/audio/translations",ct({body:e,...t,__metadata:{model:e.model}},this._client))}}class Bs extends mt{constructor(){super(...arguments),this.transcriptions=new Ms(this._client),this.translations=new Ns(this._client),this.speech=new Ts(this._client)}}Bs.Transcriptions=Ms,Bs.Translations=Ns,Bs.Speech=Ts;class Ls extends mt{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(vt`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",rt,{query:e,...t})}cancel(e,t){return this._client.post(vt`/batches/${e}/cancel`,t)}}class Ds extends mt{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}retrieve(e,t){return this._client.get(vt`/assistants/${e}`,{...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}update(e,t,s){return this._client.post(vt`/assistants/${e}`,{body:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}list(e={},t){return this._client.getAPIList("/assistants",rt,{query:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}delete(e,t){return this._client.delete(vt`/assistants/${e}`,{...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}}class Us extends mt{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}}class qs extends mt{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}}class Ws extends mt{constructor(){super(...arguments),this.sessions=new Us(this._client),this.transcriptionSessions=new qs(this._client)}}Ws.Sessions=Us,Ws.TranscriptionSessions=qs;class Fs extends mt{create(e,t,s){return this._client.post(vt`/threads/${e}/messages`,{body:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}retrieve(e,t,s){const{thread_id:n}=t;return this._client.get(vt`/threads/${n}/messages/${e}`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}update(e,t,s){const{thread_id:n,...r}=t;return this._client.post(vt`/threads/${n}/messages/${e}`,{body:r,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(vt`/threads/${e}/messages`,rt,{query:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}delete(e,t,s){const{thread_id:n}=t;return this._client.delete(vt`/threads/${n}/messages/${e}`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}}class Xs extends mt{retrieve(e,t,s){const{thread_id:n,run_id:r,...o}=t;return this._client.get(vt`/threads/${n}/runs/${r}/steps/${e}`,{query:o,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}list(e,t,s){const{thread_id:n,...r}=t;return this._client.getAPIList(vt`/threads/${n}/runs/${e}/steps`,rt,{query:r,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}}var Hs={};const Ks=e=>{var t,s,n,r;return void 0!==globalThis.process?(null==(t=null==Hs?void 0:Hs[e])?void 0:t.trim())??void 0:void 0!==globalThis.Deno?null==(r=null==(n=null==(s=globalThis.Deno.env)?void 0:s.get)?void 0:n.call(s,e))?void 0:r.trim():void 0};var Js,Vs,zs,Qs,Ys,Gs,Zs,en,tn,sn,nn,rn,on,an,ln,cn,un,dn,hn,pn,fn,mn,gn;class vn extends Ft{constructor(){super(...arguments),Js.add(this),zs.set(this,[]),Qs.set(this,{}),Ys.set(this,{}),Gs.set(this,void 0),Zs.set(this,void 0),en.set(this,void 0),tn.set(this,void 0),sn.set(this,void 0),nn.set(this,void 0),rn.set(this,void 0),on.set(this,void 0),an.set(this,void 0)}[(zs=new WeakMap,Qs=new WeakMap,Ys=new WeakMap,Gs=new WeakMap,Zs=new WeakMap,en=new WeakMap,tn=new WeakMap,sn=new WeakMap,nn=new WeakMap,rn=new WeakMap,on=new WeakMap,an=new WeakMap,Js=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Vs;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){var s;const n=null==t?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=Qe.fromReadableStream(e,this.controller);for await(const o of r)L(this,Js,"m",ln).call(this,o);if(null==(s=r.controller.signal)?void 0:s.aborted)throw new X;return this._addRun(L(this,Js,"m",cn).call(this))}toReadableStream(){return new Qe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){const r=new Vs;return r._run((()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}}))),r}async _createToolAssistantStream(e,t,s,n){var r;const o=null==n?void 0:n.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});this._connected();for await(const l of a)L(this,Js,"m",ln).call(this,l);if(null==(r=a.controller.signal)?void 0:r.aborted)throw new X;return this._addRun(L(this,Js,"m",cn).call(this))}static createThreadAssistantStream(e,t,s){const n=new Vs;return n._run((()=>n._threadAssistantStream(e,t,{...s,headers:{...null==s?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}}))),n}static createAssistantStream(e,t,s,n){const r=new Vs;return r._run((()=>r._runAssistantStream(e,t,s,{...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}}))),r}currentEvent(){return L(this,rn,"f")}currentRun(){return L(this,on,"f")}currentMessageSnapshot(){return L(this,Gs,"f")}currentRunStepSnapshot(){return L(this,an,"f")}async finalRunSteps(){return await this.done(),Object.values(L(this,Qs,"f"))}async finalMessages(){return await this.done(),Object.values(L(this,Ys,"f"))}async finalRun(){if(await this.done(),!L(this,Zs,"f"))throw Error("Final run was not received.");return L(this,Zs,"f")}async _createThreadAssistantStream(e,t,s){var n;const r=null==s?void 0:s.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const o={...t,stream:!0},i=await e.createAndRun(o,{...s,signal:this.controller.signal});this._connected();for await(const a of i)L(this,Js,"m",ln).call(this,a);if(null==(n=i.controller.signal)?void 0:n.aborted)throw new X;return this._addRun(L(this,Js,"m",cn).call(this))}async _createAssistantStream(e,t,s,n){var r;const o=null==n?void 0:n.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});this._connected();for await(const l of a)L(this,Js,"m",ln).call(this,l);if(null==(r=a.controller.signal)?void 0:r.aborted)throw new X;return this._addRun(L(this,Js,"m",cn).call(this))}static accumulateDelta(e,t){for(const[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null!=t)if("index"!==s&&"type"!==s){if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else{if(!re(t)||!re(n)){if(Array.isArray(t)&&Array.isArray(n)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...n);continue}for(const e of n){if(!re(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const s=e.index;if(null==s)throw new Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);const n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`)}t=this.accumulateDelta(t,n)}e[s]=t}else e[s]=n;else e[s]=n}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}Vs=vn,ln=function(e){if(!this.ended)switch(B(this,rn,e),L(this,Js,"m",hn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":L(this,Js,"m",gn).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":L(this,Js,"m",dn).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":L(this,Js,"m",un).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},cn=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");if(!L(this,Zs,"f"))throw Error("Final run has not been received");return L(this,Zs,"f")},un=function(e){const[t,s]=L(this,Js,"m",fn).call(this,e,L(this,Gs,"f"));B(this,Gs,t),L(this,Ys,"f")[t.id]=t;for(const n of s){const e=t.content[n.index];"text"==(null==e?void 0:e.type)&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(!n||"text"!=n.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,n.text)}if(s.index!=L(this,en,"f")){if(L(this,tn,"f"))switch(L(this,tn,"f").type){case"text":this._emit("textDone",L(this,tn,"f").text,L(this,Gs,"f"));break;case"image_file":this._emit("imageFileDone",L(this,tn,"f").image_file,L(this,Gs,"f"))}B(this,en,s.index)}B(this,tn,t.content[s.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==L(this,en,"f")){const t=e.data.content[L(this,en,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,L(this,Gs,"f"));break;case"text":this._emit("textDone",t.text,L(this,Gs,"f"))}}L(this,Gs,"f")&&this._emit("messageDone",e.data),B(this,Gs,void 0)}},dn=function(e){const t=L(this,Js,"m",pn).call(this,e);switch(B(this,an,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of s.step_details.tool_calls)e.index==L(this,sn,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(L(this,nn,"f")&&this._emit("toolCallDone",L(this,nn,"f")),B(this,sn,e.index),B(this,nn,t.step_details.tool_calls[e.index]),L(this,nn,"f")&&this._emit("toolCallCreated",L(this,nn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":B(this,an,void 0);"tool_calls"==e.data.step_details.type&&L(this,nn,"f")&&(this._emit("toolCallDone",L(this,nn,"f")),B(this,nn,void 0)),this._emit("runStepDone",e.data,t)}},hn=function(e){L(this,zs,"f").push(e),this._emit("event",e)},pn=function(e){switch(e.event){case"thread.run.step.created":return L(this,Qs,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=L(this,Qs,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const n=Vs.accumulateDelta(t,s.delta);L(this,Qs,"f")[e.data.id]=n}return L(this,Qs,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":L(this,Qs,"f")[e.data.id]=e.data}if(L(this,Qs,"f")[e.data.id])return L(this,Qs,"f")[e.data.id];throw new Error("No snapshot available")},fn=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(const e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=L(this,Js,"m",mn).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},mn=function(e,t){return Vs.accumulateDelta(t,e)},gn=function(e){switch(B(this,on,e.data),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":B(this,Zs,e.data),L(this,nn,"f")&&(this._emit("toolCallDone",L(this,nn,"f")),B(this,nn,void 0))}};let yn=class extends mt{constructor(){super(...arguments),this.steps=new Xs(this._client)}create(e,t,s){const{include:n,...r}=t;return this._client.post(vt`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers]),stream:t.stream??!1})}retrieve(e,t,s){const{thread_id:n}=t;return this._client.get(vt`/threads/${n}/runs/${e}`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}update(e,t,s){const{thread_id:n,...r}=t;return this._client.post(vt`/threads/${n}/runs/${e}`,{body:r,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(vt`/threads/${e}/runs`,rt,{query:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}cancel(e,t,s){const{thread_id:n}=t;return this._client.post(vt`/threads/${n}/runs/${e}/cancel`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return vn.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){var n;const r=Ps([null==s?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":(null==(n=null==s?void 0:s.pollIntervalMs)?void 0:n.toString())??void 0}]);for(;;){const{data:n,response:o}=await this.retrieve(e,t,{...s,headers:{...null==s?void 0:s.headers,...r}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(null==s?void 0:s.pollIntervalMs)e=s.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await oe(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,s){return vn.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){const{thread_id:n,...r}=t;return this._client.post(vt`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){const n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return vn.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}};yn.Steps=Xs;class wn extends mt{constructor(){super(...arguments),this.runs=new yn(this._client),this.messages=new Fs(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}retrieve(e,t){return this._client.get(vt`/threads/${e}`,{...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}update(e,t,s){return this._client.post(vt`/threads/${e}`,{body:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}delete(e,t){return this._client.delete(vt`/threads/${e}`,{...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return vn.createThreadAssistantStream(e,this._client.beta.threads,t)}}wn.Runs=yn,wn.Messages=Fs;class _n extends mt{constructor(){super(...arguments),this.realtime=new Ws(this._client),this.assistants=new Ds(this._client),this.threads=new wn(this._client)}}_n.Realtime=Ws,_n.Assistants=Ds,_n.Threads=wn;class bn extends mt{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class An extends mt{retrieve(e,t,s){const{container_id:n}=t;return this._client.get(vt`/containers/${n}/files/${e}/content`,{...s,headers:Ps([{Accept:"application/binary"},null==s?void 0:s.headers]),__binaryResponse:!0})}}let xn=class extends mt{constructor(){super(...arguments),this.content=new An(this._client)}create(e,t,s){return this._client.post(vt`/containers/${e}/files`,ct({body:t,...s},this._client))}retrieve(e,t,s){const{container_id:n}=t;return this._client.get(vt`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(vt`/containers/${e}/files`,rt,{query:t,...s})}delete(e,t,s){const{container_id:n}=t;return this._client.delete(vt`/containers/${n}/files/${e}`,{...s,headers:Ps([{Accept:"*/*"},null==s?void 0:s.headers])})}};xn.Content=An;class Sn extends mt{constructor(){super(...arguments),this.files=new xn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(vt`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",rt,{query:e,...t})}delete(e,t){return this._client.delete(vt`/containers/${e}`,{...t,headers:Ps([{Accept:"*/*"},null==t?void 0:t.headers])})}}Sn.Files=xn;class Cn extends mt{create(e,t){const s=!!e.encoding_format;let n=s?e.encoding_format:"base64";s&&he(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(he(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap((e=>(e&&e.data&&e.data.forEach((e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}})(t)})),e))))}}class In extends mt{retrieve(e,t,s){const{eval_id:n,run_id:r}=t;return this._client.get(vt`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){const{eval_id:n,...r}=t;return this._client.getAPIList(vt`/evals/${n}/runs/${e}/output_items`,rt,{query:r,...s})}}class kn extends mt{constructor(){super(...arguments),this.outputItems=new In(this._client)}create(e,t,s){return this._client.post(vt`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){const{eval_id:n}=t;return this._client.get(vt`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(vt`/evals/${e}/runs`,rt,{query:t,...s})}delete(e,t,s){const{eval_id:n}=t;return this._client.delete(vt`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){const{eval_id:n}=t;return this._client.post(vt`/evals/${n}/runs/${e}`,s)}}kn.OutputItems=In;class Rn extends mt{constructor(){super(...arguments),this.runs=new kn(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(vt`/evals/${e}`,t)}update(e,t,s){return this._client.post(vt`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",rt,{query:e,...t})}delete(e,t){return this._client.delete(vt`/evals/${e}`,t)}}Rn.Runs=kn;let $n=class extends mt{create(e,t){return this._client.post("/files",ct({body:e,...t},this._client))}retrieve(e,t){return this._client.get(vt`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",rt,{query:e,...t})}delete(e,t){return this._client.delete(vt`/files/${e}`,t)}content(e,t){return this._client.get(vt`/files/${e}/content`,{...t,headers:Ps([{Accept:"application/binary"},null==t?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){const n=new Set(["processed","error","deleted"]),r=Date.now();let o=await this.retrieve(e);for(;!o.status||!n.has(o.status);)if(await oe(t),o=await this.retrieve(e),Date.now()-r>s)throw new K({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return o}};class On extends mt{}let En=class extends mt{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class jn extends mt{constructor(){super(...arguments),this.graders=new En(this._client)}}jn.Graders=En;class Pn extends mt{create(e,t,s){return this._client.getAPIList(vt`/fine_tuning/checkpoints/${e}/permissions`,nt,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(vt`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){const{fine_tuned_model_checkpoint:n}=t;return this._client.delete(vt`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}let Tn=class extends mt{constructor(){super(...arguments),this.permissions=new Pn(this._client)}};Tn.Permissions=Pn;class Mn extends mt{list(e,t={},s){return this._client.getAPIList(vt`/fine_tuning/jobs/${e}/checkpoints`,rt,{query:t,...s})}}class Nn extends mt{constructor(){super(...arguments),this.checkpoints=new Mn(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(vt`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",rt,{query:e,...t})}cancel(e,t){return this._client.post(vt`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(vt`/fine_tuning/jobs/${e}/events`,rt,{query:t,...s})}pause(e,t){return this._client.post(vt`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(vt`/fine_tuning/jobs/${e}/resume`,t)}}Nn.Checkpoints=Mn;class Bn extends mt{constructor(){super(...arguments),this.methods=new On(this._client),this.jobs=new Nn(this._client),this.checkpoints=new Tn(this._client),this.alpha=new jn(this._client)}}Bn.Methods=On,Bn.Jobs=Nn,Bn.Checkpoints=Tn,Bn.Alpha=jn;class Ln extends mt{}class Dn extends mt{constructor(){super(...arguments),this.graderModels=new Ln(this._client)}}Dn.GraderModels=Ln;class Un extends mt{createVariation(e,t){return this._client.post("/images/variations",ct({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",ct({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class qn extends mt{retrieve(e,t){return this._client.get(vt`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",nt,e)}delete(e,t){return this._client.delete(vt`/models/${e}`,t)}}class Wn extends mt{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function Fn(e,t){return t&&function(e){var t;if(Xt(null==(t=e.text)?void 0:t.format))return!0;return!1}(t)?Xn(e,t):{...e,output_parsed:null,output:e.output.map((e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map((e=>({...e,parsed:null})))}:e))}}function Xn(e,t){const s=e.output.map((e=>{if("function_call"===e.type)return{...e,parsed_arguments:Kn(t,e)};if("message"===e.type){const s=e.content.map((e=>"output_text"===e.type?{...e,parsed:Hn(t,e.text)}:e));return{...e,content:s}}return e})),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||Jn(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const e of n.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),n}function Hn(e,t){var s,n,r,o;if("json_schema"!==(null==(n=null==(s=e.text)?void 0:s.format)?void 0:n.type))return null;if("$parseRaw"in(null==(r=e.text)?void 0:r.format)){return(null==(o=e.text)?void 0:o.format).$parseRaw(t)}return JSON.parse(t)}function Kn(e,t){const s=(n=e.tools??[],r=t.name,n.find((e=>"function"===e.type&&e.name===r)));var n,r,o;return{...t,...t,parsed_arguments:(o=s,"auto-parseable-tool"===(null==o?void 0:o.$brand)?s.$parseRaw(t.arguments):(null==s?void 0:s.strict)?JSON.parse(t.arguments):null)}}function Jn(e){const t=[];for(const s of e.output)if("message"===s.type)for(const e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}var Vn,zn,Qn,Yn,Gn,Zn,er,tr;class sr extends Ft{constructor(e){super(),Vn.add(this),zn.set(this,void 0),Qn.set(this,void 0),Yn.set(this,void 0),B(this,zn,e)}static createResponse(e,t,s){const n=new sr(t);return n._run((()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...null==s?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}}))),n}async _createOrRetrieveResponse(e,t,s){var n;const r=null==s?void 0:s.signal;let o;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),L(this,Vn,"m",Gn).call(this);let i=null;"response_id"in t?(o=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):o=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const a of o)L(this,Vn,"m",Zn).call(this,a,i);if(null==(n=o.controller.signal)?void 0:n.aborted)throw new X;return L(this,Vn,"m",er).call(this)}[(zn=new WeakMap,Qn=new WeakMap,Yn=new WeakMap,Vn=new WeakSet,Gn=function(){this.ended||B(this,Qn,void 0)},Zn=function(e,t){if(this.ended)return;const s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=L(this,Vn,"m",tr).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{const t=n.output[e.output_index];if(!t)throw new W(`missing output at index ${e.output_index}`);if("message"===t.type){const n=t.content[e.content_index];if(!n)throw new W(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new W(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{const t=n.output[e.output_index];if(!t)throw new W(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},er=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");const e=L(this,Qn,"f");if(!e)throw new W("request ended without sending any events");B(this,Qn,void 0);const t=function(e,t){return Fn(e,t)}(e,L(this,zn,"f"));return B(this,Yn,t),t},tr=function(e){let t=L(this,Qn,"f");if(!t){if("response.created"!==e.type)throw new W(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=B(this,Qn,e.response),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const s=t.output[e.output_index];if(!s)throw new W(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{const s=t.output[e.output_index];if(!s)throw new W(`missing output at index ${e.output_index}`);if("message"===s.type){const t=s.content[e.content_index];if(!t)throw new W(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new W(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const s=t.output[e.output_index];if(!s)throw new W(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":B(this,Qn,e.response)}return t},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>{if(!e.length)return s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=L(this,Yn,"f");if(!e)throw new W("stream ended without producing a ChatCompletion");return e}}class nr extends mt{list(e,t={},s){return this._client.getAPIList(vt`/responses/${e}/input_items`,rt,{query:t,...s})}}class rr extends mt{constructor(){super(...arguments),this.inputItems=new nr(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap((e=>("object"in e&&"response"===e.object&&Jn(e),e)))}retrieve(e,t={},s){return this._client.get(vt`/responses/${e}`,{query:t,...s,stream:(null==t?void 0:t.stream)??!1})}delete(e,t){return this._client.delete(vt`/responses/${e}`,{...t,headers:Ps([{Accept:"*/*"},null==t?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap((t=>Xn(t,e)))}stream(e,t){return sr.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(vt`/responses/${e}/cancel`,t)}}rr.InputItems=nr;class or extends mt{create(e,t,s){return this._client.post(vt`/uploads/${e}/parts`,ct({body:t,...s},this._client))}}class ir extends mt{constructor(){super(...arguments),this.parts=new or(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(vt`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(vt`/uploads/${e}/complete`,{body:t,...s})}}ir.Parts=or;class ar extends mt{create(e,t,s){return this._client.post(vt`/vector_stores/${e}/file_batches`,{body:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}retrieve(e,t,s){const{vector_store_id:n}=t;return this._client.get(vt`/vector_stores/${n}/file_batches/${e}`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}cancel(e,t,s){const{vector_store_id:n}=t;return this._client.post(vt`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}async createAndPoll(e,t,s){const n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){const{vector_store_id:n,...r}=t;return this._client.getAPIList(vt`/vector_stores/${n}/file_batches/${e}/files`,rt,{query:r,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}async poll(e,t,s){var n;const r=Ps([null==s?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":(null==(n=null==s?void 0:s.pollIntervalMs)?void 0:n.toString())??void 0}]);for(;;){const{data:n,response:o}=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();switch(n.status){case"in_progress":let e=5e3;if(null==s?void 0:s.pollIntervalMs)e=s.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await oe(e);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=(null==n?void 0:n.maxConcurrency)??5,o=Math.min(r,t.length),i=this._client,a=t.values(),l=[...s];const c=Array(o).fill(a).map((async function(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},n);l.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),s=t.filter((e=>"rejected"===e.status));if(s.length){for(const e of s);throw new Error(`${s.length} promise(s) failed - see the above errors`)}const n=[];for(const r of t)"fulfilled"===r.status&&n.push(r.value);return n})(c),await this.createAndPoll(e,{file_ids:l})}}class lr extends mt{create(e,t,s){return this._client.post(vt`/vector_stores/${e}/files`,{body:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}retrieve(e,t,s){const{vector_store_id:n}=t;return this._client.get(vt`/vector_stores/${n}/files/${e}`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}update(e,t,s){const{vector_store_id:n,...r}=t;return this._client.post(vt`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}list(e,t={},s){return this._client.getAPIList(vt`/vector_stores/${e}/files`,rt,{query:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}delete(e,t,s){const{vector_store_id:n}=t;return this._client.delete(vt`/vector_stores/${n}/files/${e}`,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){var n;const r=Ps([null==s?void 0:s.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":(null==(n=null==s?void 0:s.pollIntervalMs)?void 0:n.toString())??void 0}]);for(;;){const n=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse(),o=n.data;switch(o.status){case"in_progress":let e=5e3;if(null==s?void 0:s.pollIntervalMs)e=s.pollIntervalMs;else{const t=n.response.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await oe(e);break;case"failed":case"completed":return o}}}async upload(e,t,s){const n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){const n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){const{vector_store_id:n}=t;return this._client.getAPIList(vt`/vector_stores/${n}/files/${e}/content`,nt,{...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}}class cr extends mt{constructor(){super(...arguments),this.files=new lr(this._client),this.fileBatches=new ar(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}retrieve(e,t){return this._client.get(vt`/vector_stores/${e}`,{...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}update(e,t,s){return this._client.post(vt`/vector_stores/${e}`,{body:t,...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",rt,{query:e,...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}delete(e,t){return this._client.delete(vt`/vector_stores/${e}`,{...t,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==t?void 0:t.headers])})}search(e,t,s){return this._client.getAPIList(vt`/vector_stores/${e}/search`,nt,{body:t,method:"post",...s,headers:Ps([{"OpenAI-Beta":"assistants=v2"},null==s?void 0:s.headers])})}}var ur,dr;cr.Files=lr,cr.FileBatches=ar;class hr{constructor({baseURL:e=Ks("OPENAI_BASE_URL"),apiKey:t=Ks("OPENAI_API_KEY"),organization:s=Ks("OPENAI_ORG_ID")??null,project:n=Ks("OPENAI_PROJECT_ID")??null,...r}={}){if(dr.set(this,void 0),this.completions=new bn(this),this.chat=new $s(this),this.embeddings=new Cn(this),this.files=new $n(this),this.images=new Un(this),this.audio=new Bs(this),this.moderations=new Wn(this),this.models=new qn(this),this.fineTuning=new Bn(this),this.graders=new Dn(this),this.vectorStores=new cr(this),this.beta=new _n(this),this.batches=new Ls(this),this.uploads=new ir(this),this.responses=new rr(this),this.evals=new Rn(this),this.containers=new Sn(this),void 0===t)throw new W("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:s,project:n,...r,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new W("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=o.baseURL,this.timeout=o.timeout??ur.DEFAULT_TIMEOUT,this.logger=o.logger??console;const i="warn";this.logLevel=i,this.logLevel=ae(o.logLevel,"ClientOptions.logLevel",this)??ae(Ks("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??i,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),B(this,dr,Ae),this._options=o,this.apiKey=t,this.organization=s,this.project=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return Ps([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Le(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${fe}`}defaultIdempotencyKey(){return`stainless-node-retry-${D()}`}makeStatusError(e,t,s,n){return F.generate(e,t,s,n)}buildURL(e,t){const s=(e=>ne.test(e))(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return function(e){if(!e)return!0;for(const t in e)return!1;return!0}(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then((s=>({method:e,path:t,...s}))))}request(e,t=null){return new et(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var n,r;const o=await e,i=o.maxRetries??this.maxRetries;null==t&&(t=i),await this.prepareOptions(o);const{req:a,url:l,timeout:c}=this.buildRequest(o,{retryCount:i-t});await this.prepareRequest(a,{url:l,options:o});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(he(this).debug(`[${u}] sending request`,pe({retryOfRequestLogID:s,method:o.method,url:l,options:o,headers:a.headers})),null==(n=o.signal)?void 0:n.aborted)throw new X;const p=new AbortController,f=await this.fetchWithTimeout(l,a,c,p).catch(q),m=Date.now();if(f instanceof Error){const e=`retrying, ${t} attempts remaining`;if(null==(r=o.signal)?void 0:r.aborted)throw new X;const n=U(f)||/timed? ?out/i.test(String(f)+("cause"in f?String(f.cause):""));if(t)return he(this).info(`[${u}] connection ${n?"timed out":"failed"} - ${e}`),he(this).debug(`[${u}] connection ${n?"timed out":"failed"} (${e})`,pe({retryOfRequestLogID:s,url:l,durationMs:m-h,message:f.message})),this.retryRequest(o,t,s??u);if(he(this).info(`[${u}] connection ${n?"timed out":"failed"} - error; no more retries left`),he(this).debug(`[${u}] connection ${n?"timed out":"failed"} (error; no more retries left)`,pe({retryOfRequestLogID:s,url:l,durationMs:m-h,message:f.message})),n)throw new K;throw new H({cause:f})}const g=`[${u}${d}${[...f.headers.entries()].filter((([e])=>"x-request-id"===e)).map((([e,t])=>", "+e+": "+JSON.stringify(t))).join("")}] ${a.method} ${l} ${f.ok?"succeeded":"failed"} with status ${f.status} in ${m-h}ms`;if(!f.ok){const e=this.shouldRetry(f);if(t&&e){const e=`retrying, ${t} attempts remaining`;return await async function(e){var t,s;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void(await(null==(s=(t=e[Symbol.asyncIterator]()).return)?void 0:s.call(t)));const n=e.getReader(),r=n.cancel();n.releaseLock(),await r}(f.body),he(this).info(`${g} - ${e}`),he(this).debug(`[${u}] response error (${e})`,pe({retryOfRequestLogID:s,url:f.url,status:f.status,headers:f.headers,durationMs:m-h})),this.retryRequest(o,t,s??u,f.headers)}const n=e?"error; no more retries left":"error; not retryable";he(this).info(`${g} - ${n}`);const r=await f.text().catch((e=>q(e).message)),i=(e=>{try{return JSON.parse(e)}catch(t){return}})(r),a=i?void 0:r;he(this).debug(`[${u}] response error (${n})`,pe({retryOfRequestLogID:s,url:f.url,status:f.status,headers:f.headers,message:a,durationMs:Date.now()-h}));throw this.makeStatusError(f.status,i,a,f.headers)}return he(this).info(g),he(this).debug(`[${u}] response start`,pe({retryOfRequestLogID:s,url:f.url,status:f.status,headers:f.headers,durationMs:m-h})),{response:f,options:o,controller:p,requestLogID:u,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new st(this,s,e)}async fetchWithTimeout(e,t,s,n){const{signal:r,method:o,...i}=t||{};r&&r.addEventListener("abort",(()=>n.abort()));const a=setTimeout((()=>n.abort()),s),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...i};o&&(c.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(a)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,s,n){let r;const o=null==n?void 0:n.get("retry-after-ms");if(o){const e=parseFloat(o);Number.isNaN(e)||(r=e)}const i=null==n?void 0:n.get("retry-after");if(i&&!r){const e=parseFloat(i);r=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){const s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await oe(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:n,path:r,query:o}=s,i=this.buildURL(r,o);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new W(`${e} must be an integer`);if(t<0)throw new W(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:a,body:l}=this.buildBody({options:s});return{req:{method:n,headers:this.buildHeaders({options:e,method:n,bodyHeaders:a,retryCount:t}),...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...s.fetchOptions??{}},url:i,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const o=Ps([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ye??(ye=me()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=Ps([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:_e(e)}:L(this,dr,"f").call(this,{body:e,headers:s})}}ur=hr,dr=new WeakMap,hr.OpenAI=ur,hr.DEFAULT_TIMEOUT=6e5,hr.OpenAIError=W,hr.APIError=F,hr.APIConnectionError=H,hr.APIConnectionTimeoutError=K,hr.APIUserAbortError=X,hr.NotFoundError=Q,hr.ConflictError=Y,hr.RateLimitError=Z,hr.BadRequestError=J,hr.AuthenticationError=V,hr.InternalServerError=ee,hr.PermissionDeniedError=z,hr.UnprocessableEntityError=G,hr.toFile=async function(e,t,s){if(ot(),(e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&pt(e))(e=await e))return e instanceof File?e:it([await e.arrayBuffer()],e.name);if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),it(await ft(n),t,s)}const n=await ft(e);if(t||(t=at(e)),!(null==s?void 0:s.type)){const e=n.find((e=>"object"==typeof e&&"type"in e&&e.type));"string"==typeof e&&(s={...s,type:e})}return it(n,t,s)},hr.Completions=bn,hr.Chat=$s,hr.Embeddings=Cn,hr.Files=$n,hr.Images=Un,hr.Audio=Bs,hr.Moderations=Wn,hr.Models=qn,hr.FineTuning=Bn,hr.Graders=Dn,hr.VectorStores=cr,hr.Beta=_n,hr.Batches=Ls,hr.Uploads=ir,hr.Responses=rr,hr.Evals=Rn,hr.Containers=Sn;const pr={class:"app-container"},fr={class:"title"},mr={class:"title-right"},gr={class:"content"},vr={class:"iptbox"},yr={class:"selectbox"},wr={class:"box-ipt"},_r=["onClick"],br={class:"item-l"},Ar=["src"],xr={class:"item-r"},Sr={class:"dialog-footer"},Cr={class:"drawer-box"},Ir={class:"box"},kr=["onClick"],Rr={class:"btn-box"},$r={class:"btn-text"},Or=M(e({__name:"index",setup(e){const M=t("dddd YYYY-MM-DD HH:mm:ss"),B=t("zh-CN");let L=s([]);const D=s(!1);let U="",q=s("sk-030aa5f041284a7b90da5649ae2b82d2"),W=s("https://api.deepseek.com"),F=n({messages:[],model:"deepseek-chat",stream:!0}),X=s(""),H=s(!1),K=s([]),J=s(0),V=s(null),z=s("deepSeek"),Q=s(0),Y=s(!1),G=s(0),Z=n([{name:"deepSeek",img:"data:image/svg+xml,%3csvg%20viewBox='0%200%2030%2030'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cpath%20id='path'%20d='M27.501%208.46875C27.249%208.3457%2027.1406%208.58008%2026.9932%208.69922C26.9434%208.73828%2026.9004%208.78906%2026.8584%208.83398C26.4902%209.22852%2026.0605%209.48633%2025.5%209.45508C24.6787%209.41016%2023.9785%209.66797%2023.3594%2010.2969C23.2275%209.52148%2022.79%209.05859%2022.125%208.76172C21.7764%208.60742%2021.4238%208.45312%2021.1807%208.11719C21.0098%207.87891%2020.9639%207.61328%2020.8779%207.35156C20.8242%207.19336%2020.7695%207.03125%2020.5879%207.00391C20.3906%206.97266%2020.3135%207.13867%2020.2363%207.27734C19.9258%207.84375%2019.8066%208.46875%2019.8174%209.10156C19.8447%2010.5234%2020.4453%2011.6562%2021.6367%2012.4629C21.7725%2012.5547%2021.8076%2012.6484%2021.7646%2012.7832C21.6836%2013.0605%2021.5869%2013.3301%2021.501%2013.6074C21.4473%2013.7852%2021.3662%2013.8242%2021.1768%2013.7461C20.5225%2013.4727%2019.957%2013.0684%2019.458%2012.5781C18.6104%2011.7578%2017.8438%2010.8516%2016.8877%2010.1426C16.6631%209.97656%2016.4395%209.82227%2016.207%209.67578C15.2314%208.72656%2016.335%207.94727%2016.5898%207.85547C16.8574%207.75977%2016.6826%207.42773%2015.8193%207.43164C14.957%207.43555%2014.167%207.72461%2013.1611%208.10938C13.0137%208.16797%2012.8594%208.21094%2012.7002%208.24414C11.7871%208.07227%2010.8389%208.0332%209.84766%208.14453C7.98242%208.35352%206.49219%209.23633%205.39648%2010.7441C4.08105%2012.5547%203.77148%2014.6133%204.15039%2016.7617C4.54883%2019.0234%205.70215%2020.8984%207.47559%2022.3633C9.31348%2023.8809%2011.4307%2024.625%2013.8457%2024.4824C15.3125%2024.3984%2016.9463%2024.2012%2018.7881%2022.6406C19.2529%2022.8711%2019.7402%2022.9629%2020.5498%2023.0332C21.1729%2023.0918%2021.7725%2023.002%2022.2373%2022.9062C22.9648%2022.752%2022.9141%2022.0781%2022.6514%2021.9531C20.5186%2020.959%2020.9863%2021.3633%2020.5605%2021.0371C21.6445%2019.752%2023.2783%2018.418%2023.917%2014.0977C23.9668%2013.7539%2023.9238%2013.5391%2023.917%2013.2598C23.9131%2013.0918%2023.9512%2013.0254%2024.1445%2013.0059C24.6787%2012.9453%2025.1973%2012.7988%2025.6738%2012.5352C27.0557%2011.7793%2027.6123%2010.5391%2027.7441%209.05078C27.7637%208.82422%2027.7402%208.58789%2027.501%208.46875ZM15.46%2021.8613C13.3926%2020.2344%2012.3906%2019.6992%2011.9766%2019.7227C11.5898%2019.7441%2011.6592%2020.1875%2011.7441%2020.4766C11.833%2020.7617%2011.9492%2020.959%2012.1123%2021.209C12.2246%2021.375%2012.3018%2021.623%2012%2021.8066C11.334%2022.2207%2010.1768%2021.668%2010.1221%2021.6406C8.77539%2020.8477%207.64941%2019.7988%206.85547%2018.3652C6.08984%2016.9844%205.64453%2015.5039%205.57129%2013.9238C5.55176%2013.541%205.66406%2013.4062%206.04297%2013.3379C6.54199%2013.2461%207.05762%2013.2266%207.55664%2013.2988C9.66602%2013.6074%2011.4619%2014.5527%2012.9668%2016.0469C13.8262%2016.9004%2014.4766%2017.918%2015.1465%2018.9121C15.8584%2019.9688%2016.625%2020.9746%2017.6006%2021.7988C17.9443%2022.0879%2018.2197%2022.3086%2018.4824%2022.4707C17.6895%2022.5586%2016.3652%2022.5781%2015.46%2021.8613ZM16.4502%2015.4805C16.4502%2015.3105%2016.5859%2015.1758%2016.7568%2015.1758C16.7949%2015.1758%2016.8301%2015.1836%2016.8613%2015.1953C16.9033%2015.2109%2016.9424%2015.2344%2016.9727%2015.2695C17.0273%2015.3223%2017.0586%2015.4004%2017.0586%2015.4805C17.0586%2015.6504%2016.9229%2015.7852%2016.7529%2015.7852C16.582%2015.7852%2016.4502%2015.6504%2016.4502%2015.4805ZM19.5273%2017.0625C19.3301%2017.1426%2019.1328%2017.2129%2018.9434%2017.2207C18.6494%2017.2344%2018.3281%2017.1152%2018.1533%2016.9688C17.8828%2016.7422%2017.6895%2016.6152%2017.6074%2016.2168C17.5732%2016.0469%2017.5928%2015.7852%2017.623%2015.6348C17.6934%2015.3105%2017.6152%2015.1035%2017.3877%2014.9141C17.2012%2014.7598%2016.9658%2014.7188%2016.7061%2014.7188C16.6094%2014.7188%2016.5205%2014.6758%2016.4541%2014.6406C16.3457%2014.5859%2016.2568%2014.4512%2016.3418%2014.2852C16.3691%2014.2324%2016.501%2014.1016%2016.5322%2014.0781C16.8838%2013.877%2017.29%2013.9434%2017.666%2014.0938C18.0146%2014.2363%2018.2773%2014.498%2018.6562%2014.8672C19.0439%2015.3145%2019.1133%2015.4395%2019.334%2015.7734C19.5078%2016.0371%2019.667%2016.3066%2019.7754%2016.6152C19.8408%2016.8066%2019.7559%2016.9648%2019.5273%2017.0625Z'%20fill-rule='nonzero'%20fill='%234D6BFE'%3e%3c/path%3e%3c/svg%3e",apiKey:"sk-030aa5f041284a7b90da5649ae2b82d2",model:"deepseek-chat",baseURL:"https://api.deepseek.com"},{name:"豆包",img:N,apiKey:"1281df1a-2664-4062-9419-437bc336f661",model:"doubao-1.5-lite-32k-250115",baseURL:"https://ark.cn-beijing.volces.com/api/v3"},{name:"KIMI+",img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABhCAYAAAApxKSdAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAUUSURBVHgB7Z29bhtHFIWPHQN2J7lKqnhYpYvpIukCbJEAKQJEegLReYFIT0DrCSI9QEDqCSIDaQIEIOukiJwyza5SJWlId3FFz+HuGmuSSw6p+dlZ3g84luhdUeI9M3fmziyXgBCUe/DHYY0Wj/tgWmjV42zFcWe4MIBBPNJ6qqW0uvAbXFvQgKzQK62bQhkaCIPc10q1Zi3XH1o/IG9cwUm0RogrgDY1KmLgHYX9DvyiBvDYI77XmiD+oLlQHw7hIDoCMBOt1U9w0BsU9mOAtaUUFk3oQoIfzAQFCf5dNMEdTFCQ4NtQih1NSIGgf3ibxOJt5UrAB1gNK72vIdjiI61HWr+YnNxDXK0rJiULsV65GJeiIescLSTTeobKSutiCuojX8kU3MBx4I3WeNVBBRl4fWiCyoB8v2JAAkk9PmDwT8sH1TEghRjgC27scCx41wO43KAg+ILxTvhNaUACwTc04Z0B30LwzTzm5Rjw3sgseIG1wGMawMBPIOQcqvzrNIMHOg9Q5KK953O90/rFC+BhJRH8PQZ+fu7SjC7HAIV95yu99vjlxfvBJx8nwHd6IfNJAkccOjHg6OgIs9lsra6vr2GTNE03/k7q8HAhyJ/2gM9O65/4kT7/mwEcoZwYsPQiV3BwcABb9Ho9KKU2njccDjGdLlxx+InBBPBAAR86ydRPaIC9SASi3+8bnXd+fr78nw8NJ39uDJjXAVFPP7dp/VmWLR9g6w6Huo/IOTk5MTpvZesn/93AiP/dXCwd9SyILT9Jko3n1bZ+8s8rGPGvoVHbEXcPMM39V1dX9Qd/19PPNxta959D4HUGF0RrAFs/8/8mxuPxXLUwtfx2WX+cxdivZ3DFA0SKldZPuPTAKrikbOlMOX+9zFu/Q2iAQoSY5H7mfeb/tXCT8MdneU9wNNCuQUXZA0ynnrUznyqOcrspUY4BJunHqPU3gOgMsNr6G0B0BpgUXrG0fhKVAaaF1/HxMWIhKgNMcj9Tz82Nk6rVGdav/tJ5eraJ0Wi01XPq1r/xOS8uLkJc6XYnRTMNXdf62eIvLy+jyftVghnQ7Xahe8FW59fBTRYOzosDNI1hJdz0lBQkBflkMBjMU5iL13pXRb8fYAJrB/a2db0oFHthAOEUliaYFHE+aaUBdZsvvFhApyM0idYZwOCvW4JmIWdSzPmidQaYrAGZ7iX4oFUGnJ2dGdUCTRqMozeANQCLsE6nA10JG/0Mx4KmDMbBCjEWR2yxu8LAM98vXelmCA2ovVLCI8EMYODWbpbvCXtTBzQVMSAwYkBgxIDAtNKAXWdGIRADAiMpKDA0IIMQikx6QGDEgMCIAYGRMSAsMgaEhgbcQgjFa+kBYZnIGBCWWzEgLPNBOJ6Fk/aR8Y5ZCvktKwX/PJZ7xoVjfs+4chYU11tK2sE85qUBLyH4Zh5z6QHhGPOf6r2j+TEbcgdFP2RaHX5TrYQlDflj5RXE5Q1cG/lWnhYpReUGKdUewGnRmhvnCJbgmxey8sHiZ8iwF3AsUBBckKHI/SWLq6HsBc8huML4DiK80D6WnBqLzN68UFCmopheYJOVYgcU5FOVbAVfYUcUZGoaLPglCtITdg2+tZUFBTFh2+ArWEYh/7z0WIIQSiM43lt5AWAmWhLHylN4QmkNEXfAbGqEQKsHSfHLYwiSq8AnaAAKeaW3D8VbijwNW5nh3IN9FPI/jnpaPKZi2/SfFuJu4W3x9RqWL+N5C+7ruKpBAgLkAAAAAElFTkSuQmCC",apiKey:"sk-s9Xn6GwAZgNcCbnyLPnYwUnDTv5h8A4mXg5Lp9oXx8sEkNjF",model:"moonshot-v1-8k",baseURL:"https://api.moonshot.cn/v1"}]),ee=s(!1);r((()=>{ne(0),re(0)}));let te=e=>{D.value=1===e},se=()=>{Y.value=!0},ne=e=>{0==e?o.get("https://api.deepseek.com/user/balance",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+q.value}}).then((e=>{Q.value=e.data.balance_infos[0].total_balance})).catch((e=>{})):1==e?Q.value=999:2==e&&o.get("https://api.moonshot.cn/v1/users/me/balance",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+q.value}}).then((e=>{Q.value=e.data.data.available_balance})).catch((e=>{}))},re=e=>{0==e?o.get("https://api.deepseek.com/models",{headers:{"Content-Type":"application/json",Authorization:"Bearer "+q.value}}).then((e=>{L.value=e.data.data.map((e=>({label:e.id,value:e.id})))})).catch((e=>{})):1==e?L.value=[{label:"doubao-1.5-lite-32k-250115",value:"doubao-1.5-lite-32k-250115"},{label:"doubao-1.5-pro-32k-250115",value:"doubao-1.5-pro-32k-250115"},{label:"doubao-1.5-pro-256k-250115",value:"doubao-1.5-pro-256k-250115"}]:2==e&&(L.value=[])},oe=async e=>0==e||H.value?C.warning("加载中，请稍后"):""==X.value?C.warning("请输入内容"):(U||ae(),0==K.value.length&&await de(),void ie()),ie=async()=>{F.messages.push({role:"user",content:X.value}),X.value="",H.value=!0,V.value.scrollBottom();try{const e=await U.chat.completions.create(F);F.messages.push({role:"assistant",content:""});for await(const t of e)F.messages[F.messages.length-1].content+=t.choices[0].delta.content,V.value.scrollBottom();K.value[J.value].messages=F.messages,e&&(H.value=!1)}catch(e){H.value=!1,F.messages.push({role:"assistant",content:"加载失败,请稍后重试!"})}},ae=()=>{U=new hr({baseURL:W.value,apiKey:q.value,dangerouslyAllowBrowser:!0})},le=e=>{G.value=e},ce=()=>{Y.value=!1,F.messages=[],K.value=[],J.value=0;let e=Z[G.value];q.value=e.apiKey,W.value=e.baseURL,F.model=e.model,z.value=e.name,ne(G.value),re(G.value),ae()},ue=()=>{ee.value=!0},de=()=>{if(H.value)return void C.warning("请当前问题查询完成后重试！");let e=I(new Date,M,{locales:B});K.value.push({title:`对话${K.value.length+1}`,crtTime:e.value,messages:[]}),F.messages=[],J.value=K.value.length-1},he=e=>{var t;H.value?C.warning("请当前问题查询完成后重试！"):(J.value=e,F.messages=(null==(t=K.value[J.value])?void 0:t.messages)||[])},pe=e=>{T.confirm("您确定要删除当前对话吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{K.value.splice(e,1),e==J.value?J.value=K.value[e]?e:--e:e<J.value&&(J.value=--J.value),F.messages=J.value>-1?K.value[J.value].messages:[],he(J.value)})).catch((e=>{}))};return(e,t)=>{const s=i("Loading"),n=g,r=j,o=E,C=O,I=$,T=R,M=i("DeleteFilled"),N=k;return l(),a("div",pr,[c(I,{shadow:"never",class:"aui-card--fill"},{default:u((()=>[d("div",fr,[t[8]||(t[8]=d("div",{class:"title-left"},null,-1)),d("div",mr,"（"+h(p(z))+"）余额："+h(p(Q))+"元",1)]),d("div",gr,[c(P,{ref_key:"messageRef",ref:V,message:p(F).messages},null,8,["message"]),p(H)?(l(),f(n,{key:0,class:"is-loading loadding",size:"20"},{default:u((()=>[c(s)])),_:1})):m("",!0)]),d("div",vr,[d("div",yr,[c(r,{type:"primary",size:"large",onClick:p(ue)},{default:u((()=>t[9]||(t[9]=[v("新建对话")]))),_:1},8,["onClick"]),c(r,{type:"primary",size:"large",onClick:p(se),style:{"margin-right":"10px"}},{default:u((()=>t[10]||(t[10]=[v("切换AI")]))),_:1},8,["onClick"]),c(C,{modelValue:p(F).model,"onUpdate:modelValue":t[0]||(t[0]=e=>p(F).model=e),placeholder:"请选择对应模型",size:"large",style:{width:"240px"}},{default:u((()=>[(l(!0),a(y,null,w(p(L),(e=>(l(),f(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),d("div",{class:_(["box",D.value?"box-focus":""])},[b(d("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>A(X)?X.value=e:X=e),placeholder:"请输入文本",rows:"4",class:"ipt",onFocus:t[2]||(t[2]=e=>p(te)(1)),onBlur:t[3]||(t[3]=e=>p(te)(2))},null,544),[[x,p(X)]]),d("div",{class:"fs-box",onClick:t[4]||(t[4]=e=>p(oe)(1))},t[11]||(t[11]=[d("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAcFJREFUSEvVlL2PT0EUhp8nNrFsUFAjUe1Ho1CqfBY+C7tZhYRI0EgErfgDkCgkJEg0ohAJxVYoqHZFuSsKETqlZItdzbEjc2Xc3Lvu/vy2MN2dmfM+57znzJVVXq6yPv8HICI2AkeAE8BOdWvlTM8V1ET3A4NZ9KW6rydAFj2cMz1QiJatvKze6gyIiA1F+U2ikcUqN0bUD8sCOohW8d+Bt8ChvPFF3V6W87sHWbQq/2BL+WXs+6WP68ATYCgf3FUv/AGIiNT5k0AX0RSbLLkDXMvZjxaCR9UXdcBEBiR/1/7l4SVLzqpPI+IhcLq4vwhsUefbLKpmeRxIY1eHJUsm1E8RcQp4VEvmlbq3nmDjO4iITcXkJNh9II3fYkQMA+8K3yvNK+rNToDyUkQMqgu/zI9YD0wDYw1WjqpzKwbUYA+AMw3iX9VtTf3r/KuIiHXANyA9vPq6p57/J0C26DZwsUHomPq8H4AdwEdgTSH2A9hcH8/qvLNFVUBEPAOOF4DX6p6299MLYDfwphC8qt7oGyD3YgbYlUXH1Nl+AyaBx0sj2zqePfcgVzAAfAam1HNt2af9FfegaPalNFHq1HKAn0L+iBniujLlAAAAAElFTkSuQmCC",alt:""},null,-1)]))],2)])])),_:1}),c(T,{modelValue:p(Y),"onUpdate:modelValue":t[6]||(t[6]=e=>A(Y)?Y.value=e:Y=e),title:"AI切换",width:"600px"},{footer:u((()=>[d("div",Sr,[c(r,{onClick:t[5]||(t[5]=e=>A(Y)?Y.value=!1:Y=!1)},{default:u((()=>t[12]||(t[12]=[v("关闭")]))),_:1}),c(r,{type:"primary",onClick:p(ce)},{default:u((()=>t[13]||(t[13]=[v("确定")]))),_:1},8,["onClick"])])])),default:u((()=>[d("div",wr,[(l(!0),a(y,null,w(p(Z),((e,t)=>(l(),a("div",{class:_(["item",t==p(G)?"act":""]),key:t,onClick:e=>p(le)(t)},[d("div",br,[d("img",{src:e.img,mode:"",class:"img"},null,8,Ar)]),d("div",xr,h(e.name),1)],10,_r)))),128))])])),_:1},8,["modelValue"]),c(N,{modelValue:p(ee),"onUpdate:modelValue":t[7]||(t[7]=e=>A(ee)?ee.value=e:ee=e),title:"新建对话",size:"350px","with-header":!1},{default:u((()=>[d("div",Cr,[c(r,{type:"primary",size:"large",style:{width:"100%",height:"50px"},onClick:p(de)},{default:u((()=>t[14]||(t[14]=[v("新建对话")]))),_:1},8,["onClick"]),d("div",Ir,[(l(!0),a(y,null,w(p(K),((e,t)=>(l(),a("div",{class:_(["item",p(J)==t?"act":""]),key:t,onClick:e=>p(he)(t)},[d("div",null,h(e.title)+"/"+h(e.crtTime),1),d("div",Rr,[d("div",$r,h(e.messages[0]?e.messages[0].content:"空"),1),t==p(J)?(l(),f(n,{key:0,class:"icon",color:"#F56C6C",onClick:S((e=>p(pe)(t)),["stop"])},{default:u((()=>[c(M)])),_:2},1032,["onClick"])):m("",!0)])],10,kr)))),128))])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-133dc5e6"]]);export{Or as default};
