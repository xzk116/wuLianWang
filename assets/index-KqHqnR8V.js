import{d as e,al as a,r as l,S as t,c as o,aJ as i,I as s,o as r,ar as n,g as d,f as u,C as m,m as p,w as c,$ as f,i as v,a0 as b,W as g,e as j,h,ap as y,F as _,E as k,aD as x}from"./index-B60e1Ob1.js";import{v as V}from"./loading-BscGRGL5.js";import{E as w}from"./drawer-m1chOXZt.js";import"./overlay-DYY93Q8s.js";import{E as C}from"./tree-BpTIscvM.js";import{E}from"./checkbox-ButTqhkT.js";import"./text-CXiZVvjx.js";/* empty css                */import{E as U}from"./popper-Cr74CpMj.js";import{E as S}from"./dialog-LvtrGeqH.js";import{E as z}from"./input-BjkV2ehM.js";import{E as F}from"./input-number-BnhDa9yN.js";import{E as R,a as q}from"./radio-group-B8rHYepJ.js";/* empty css              *//* empty css            */import{E as N,a as O}from"./select-CalhPuOH.js";import"./scrollbar-By3TrZN3.js";import{E as I}from"./card-hmDVneDu.js";import{_ as M}from"./index-DDxekQGD.js";import{a as P,E as T}from"./table-column-BttKEJfO.js";import{E as B,a as A}from"./form-item-CpNjKhI7.js";import{E as D}from"./button-BQFE7Hxd.js";import{R as K}from"./role.api-DyjpHlyz.js";import{M as J}from"./menu.api-PVGamfut.js";import{E as $}from"./message-box-DFuevA1w.js";import{E as G}from"./index-DsI0BNxW.js";import"./index-DnpUs-gR.js";import"./index-Y9kMV7A1.js";import"./vnode-G4-cE-sq.js";import"./event-BwRzfsZt.js";import"./error-D_Dr4eZ1.js";import"./scroll-xk3SnB2i.js";import"./use-form-common-props-DzatJoKf.js";import"./isUndefined-DgmxjSXK.js";import"./token-DWNpOE8r.js";import"./index-d2b16wZ0.js";import"./index-DQUN-yv0.js";import"./arrayPush-BunhweDl.js";import"./isEqual-Jbd1hhxH.js";import"./Uint8Array-BxLyAKQm.js";import"./refs-CZysbovM.js";import"./index-D-5y8sGu.js";import"./index-cSPsX4IU.js";import"./index-D3IMbe6X.js";import"./strings-xUv4NhEU.js";import"./castArray-DIYUzhyo.js";import"./debounce-CXzB0TPp.js";import"./baseIteratee-B8XCz45W.js";import"./index-BC3Znw7U.js";import"./pagination-DDB3-WuL.js";import"./plugin-vueexport-helper-BCo6x5W8.js";import"./initCloneObject-DFzMR-ez.js";import"./index-BTKOuuO-.js";const H={class:"app-container"},Q={class:"search-container"},W={class:"data-table__toolbar"},X={class:"data-table__toolbar--actions"},L={class:"dialog-footer"},Y={class:"flex-x-between"},Z={class:"flex-center ml-5"},ee={class:"dialog-footer"},ae=e({name:"Role",inheritAttrs:!1,__name:"index",setup(e){const ae=a(),le=l(),te=l(),oe=l(),ie=l(!1),se=l([]),re=l(0),ne=t({pageNum:1,pageSize:10}),de=l(),ue=l([]),me=t({title:"",visible:!1}),pe=o((()=>ae.device===i.DESKTOP?"600px":"90%")),ce=t({sort:1,status:1}),fe=t({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]}),ve=l({}),be=l(!1),ge=l(""),je=l(!0),he=l(!0);function ye(){ie.value=!0,K.getPage(ne).then((e=>{de.value=e.list,re.value=e.total})).finally((()=>{ie.value=!1}))}function _e(){ne.pageNum=1,ye()}function ke(){le.value.resetFields(),ne.pageNum=1,ye()}function xe(e){se.value=e.map((e=>e.id))}function Ve(e){me.visible=!0,e?(me.title="修改角色",K.getFormData(e).then((e=>{Object.assign(ce,e)}))):me.title="新增角色"}function we(){te.value.validate((e=>{if(e){ie.value=!0;const e=ce.id;e?K.update(e,ce).then((()=>{x.success("修改成功"),Ce(),ke()})).finally((()=>ie.value=!1)):K.create(ce).then((()=>{x.success("新增成功"),Ce(),ke()})).finally((()=>ie.value=!1))}}))}function Ce(){me.visible=!1,te.value.resetFields(),te.value.clearValidate(),ce.id=void 0,ce.sort=1,ce.status=1}function Ee(e){const a=[e||se.value].join(",");a?$.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{ie.value=!0,K.deleteByIds(a).then((()=>{x.success("删除成功"),ke()})).finally((()=>ie.value=!1))}),(()=>{x.info("已取消删除")})):x.warning("请勾选删除项")}function Ue(){const e=ve.value.id;if(e){const a=oe.value.getCheckedNodes(!1,!0).map((e=>e.value));ie.value=!0,K.updateRoleMenus(e,a).then((()=>{x.success("分配权限成功"),be.value=!1,ke()})).finally((()=>{ie.value=!1}))}}function Se(){je.value=!je.value,oe.value&&Object.values(oe.value.store.nodesMap).forEach((e=>{je.value?e.expand():e.collapse()}))}function ze(e,a){return!e||a.label.includes(e)}function Fe(e){he.value=e}return s(ge,(e=>{oe.value.filter(e)})),r((()=>{_e()})),(e,a)=>{const l=z,t=B,o=D,i=A,s=T,r=G,x=P,$=M,ae=I,Re=O,qe=N,Ne=q,Oe=R,Ie=F,Me=S,Pe=n("Search"),Te=n("Switch"),Be=E,Ae=n("QuestionFilled"),De=k,Ke=U,Je=C,$e=w,Ge=V;return u(),d("div",H,[m("div",Q,[p(i,{ref_key:"queryFormRef",ref:le,model:v(ne),inline:!0,"label-width":"auto"},{default:c((()=>[p(t,{prop:"keywords",label:"关键字"},{default:c((()=>[p(l,{modelValue:v(ne).keywords,"onUpdate:modelValue":a[0]||(a[0]=e=>v(ne).keywords=e),placeholder:"角色名称",clearable:"",onKeyup:f(_e,["enter"])},null,8,["modelValue"])])),_:1}),p(t,{class:"search-buttons"},{default:c((()=>[p(o,{type:"primary",icon:"search",onClick:_e},{default:c((()=>a[16]||(a[16]=[b("搜索")]))),_:1}),p(o,{icon:"refresh",onClick:ke},{default:c((()=>a[17]||(a[17]=[b("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),p(ae,{shadow:"hover",class:"data-table"},{default:c((()=>[m("div",W,[m("div",X,[p(o,{type:"success",icon:"plus",onClick:a[1]||(a[1]=e=>Ve())},{default:c((()=>a[18]||(a[18]=[b("新增")]))),_:1}),p(o,{type:"danger",disabled:0===v(se).length,icon:"delete",onClick:a[2]||(a[2]=e=>Ee())},{default:c((()=>a[19]||(a[19]=[b(" 删除 ")]))),_:1},8,["disabled"])])]),g((u(),j(x,{ref:"dataTableRef",data:v(de),"highlight-current-row":"",border:"",class:"data-table__content",onSelectionChange:xe},{default:c((()=>[p(s,{type:"selection",width:"55",align:"center"}),p(s,{label:"角色名称",prop:"name","min-width":"100"}),p(s,{label:"角色编码",prop:"code",width:"150"}),p(s,{label:"状态",align:"center",width:"100"},{default:c((e=>[1===e.row.status?(u(),j(r,{key:0,type:"success"},{default:c((()=>a[20]||(a[20]=[b("正常")]))),_:1})):(u(),j(r,{key:1,type:"info"},{default:c((()=>a[21]||(a[21]=[b("禁用")]))),_:1}))])),_:1}),p(s,{label:"排序",align:"center",width:"80",prop:"sort"}),p(s,{fixed:"right",label:"操作",width:"220"},{default:c((e=>[p(o,{type:"primary",size:"small",link:"",icon:"position",onClick:a=>async function(e){const a=e.id;a&&(be.value=!0,ie.value=!0,ve.value.id=a,ve.value.name=e.name,ue.value=await J.getOptions(),K.getRoleMenuIds(a).then((e=>{e.forEach((e=>oe.value.setChecked(e,!0,!1)))})).finally((()=>{ie.value=!1})))}(e.row)},{default:c((()=>a[22]||(a[22]=[b(" 分配权限 ")]))),_:2},1032,["onClick"]),p(o,{type:"primary",size:"small",link:"",icon:"edit",onClick:a=>Ve(e.row.id)},{default:c((()=>a[23]||(a[23]=[b(" 编辑 ")]))),_:2},1032,["onClick"]),p(o,{type:"danger",size:"small",link:"",icon:"delete",onClick:a=>Ee(e.row.id)},{default:c((()=>a[24]||(a[24]=[b(" 删除 ")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[Ge,v(ie)]]),v(re)>0?(u(),j($,{key:0,total:v(re),"onUpdate:total":a[3]||(a[3]=e=>y(re)?re.value=e:null),page:v(ne).pageNum,"onUpdate:page":a[4]||(a[4]=e=>v(ne).pageNum=e),limit:v(ne).pageSize,"onUpdate:limit":a[5]||(a[5]=e=>v(ne).pageSize=e),onPagination:ye},null,8,["total","page","limit"])):h("",!0)])),_:1}),p(Me,{modelValue:v(me).visible,"onUpdate:modelValue":a[11]||(a[11]=e=>v(me).visible=e),title:v(me).title,width:"500px",onClose:Ce},{footer:c((()=>[m("div",L,[p(o,{type:"primary",onClick:we},{default:c((()=>a[27]||(a[27]=[b("确 定")]))),_:1}),p(o,{onClick:Ce},{default:c((()=>a[28]||(a[28]=[b("取 消")]))),_:1})])])),default:c((()=>[p(i,{ref_key:"roleFormRef",ref:te,model:v(ce),rules:v(fe),"label-width":"100px"},{default:c((()=>[p(t,{label:"角色名称",prop:"name"},{default:c((()=>[p(l,{modelValue:v(ce).name,"onUpdate:modelValue":a[6]||(a[6]=e=>v(ce).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),p(t,{label:"角色编码",prop:"code"},{default:c((()=>[p(l,{modelValue:v(ce).code,"onUpdate:modelValue":a[7]||(a[7]=e=>v(ce).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),p(t,{label:"数据权限",prop:"dataScope"},{default:c((()=>[p(qe,{modelValue:v(ce).dataScope,"onUpdate:modelValue":a[8]||(a[8]=e=>v(ce).dataScope=e)},{default:c((()=>[(u(),j(Re,{key:1,label:"全部数据",value:1})),(u(),j(Re,{key:2,label:"部门及子部门数据",value:2})),(u(),j(Re,{key:3,label:"本部门数据",value:3})),(u(),j(Re,{key:4,label:"本人数据",value:4}))])),_:1},8,["modelValue"])])),_:1}),p(t,{label:"状态",prop:"status"},{default:c((()=>[p(Oe,{modelValue:v(ce).status,"onUpdate:modelValue":a[9]||(a[9]=e=>v(ce).status=e)},{default:c((()=>[p(Ne,{value:1},{default:c((()=>a[25]||(a[25]=[b("正常")]))),_:1}),p(Ne,{value:0},{default:c((()=>a[26]||(a[26]=[b("停用")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),p(t,{label:"排序",prop:"sort"},{default:c((()=>[p(Ie,{modelValue:v(ce).sort,"onUpdate:modelValue":a[10]||(a[10]=e=>v(ce).sort=e),"controls-position":"right",min:0,style:{width:"100px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),p($e,{modelValue:v(be),"onUpdate:modelValue":a[15]||(a[15]=e=>y(be)?be.value=e:null),title:"【"+v(ve).name+"】权限分配",size:v(pe)},{footer:c((()=>[m("div",ee,[p(o,{type:"primary",onClick:Ue},{default:c((()=>a[31]||(a[31]=[b("确 定")]))),_:1}),p(o,{onClick:a[14]||(a[14]=e=>be.value=!1)},{default:c((()=>a[32]||(a[32]=[b("取 消")]))),_:1})])])),default:c((()=>[m("div",Y,[p(l,{modelValue:v(ge),"onUpdate:modelValue":a[12]||(a[12]=e=>y(ge)?ge.value=e:null),clearable:"",class:"w-[150px]",placeholder:"菜单权限名称"},{prefix:c((()=>[p(Pe)])),_:1},8,["modelValue"]),m("div",Z,[p(o,{type:"primary",size:"small",plain:"",onClick:Se},{icon:c((()=>[p(Te)])),default:c((()=>[b(" "+_(v(je)?"收缩":"展开"),1)])),_:1}),p(Be,{modelValue:v(he),"onUpdate:modelValue":a[13]||(a[13]=e=>y(he)?he.value=e:null),class:"ml-5",onChange:Fe},{default:c((()=>a[29]||(a[29]=[b(" 父子联动 ")]))),_:1},8,["modelValue"]),p(Ke,{placement:"bottom"},{content:c((()=>a[30]||(a[30]=[b(" 如果只需勾选菜单权限，不需要勾选子菜单或者按钮权限，请关闭父子联动 ")]))),default:c((()=>[p(De,{class:"ml-1 color-[--el-color-primary] inline-block cursor-pointer"},{default:c((()=>[p(Ae)])),_:1})])),_:1})])]),p(Je,{ref_key:"permTreeRef",ref:oe,"node-key":"value","show-checkbox":"",data:v(ue),"filter-node-method":ze,"default-expand-all":!0,"check-strictly":!v(he),class:"mt-5"},{default:c((({data:e})=>[b(_(e.label),1)])),_:1},8,["data","check-strictly"])])),_:1},8,["modelValue","title","size"])])}}});export{ae as default};
