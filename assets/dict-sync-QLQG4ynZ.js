import{bw as e,r as a,d as t,c as l,o as s,aW as o,g as i,f as r,m as d,w as n,a0 as c,C as u,e as m,i as p,ap as f,P as v,Q as y,F as b,aX as j,U as _,aD as g}from"./index-zthBmEkK.js";import{E as h}from"./row-BAxo4YP8.js";import{E as w,a as x}from"./radio-group-CH7J2xPr.js";/* empty css              */import{E as D}from"./col-Bxgu_58t.js";import{E as k}from"./card-4iCWaG_x.js";import{E}from"./empty-DB7U7I1W.js";import{a as V,E as C}from"./form-item-BMaUxt_Y.js";/* empty css            */import{E as S,a as I}from"./select-DtZ7EYbN.js";import"./scrollbar-DaOv_tXQ.js";import"./popper-B8TzwAGv.js";import{E as W}from"./input-Dc-rm_L9.js";import{E as U}from"./button-BLdkehaO.js";import{E as Y}from"./alert-9XdyMk9x.js";import{D as z}from"./dict.api-B9QaQCgd.js";import{u as M}from"./useStomp-iMMsXZzp.js";import{E as O}from"./index-BpV8vGEh.js";import{_ as T}from"./plugin-vueexport-helper-BCo6x5W8.js";import"./event-BwRzfsZt.js";import"./use-form-common-props-BhFbBPIf.js";import"./index-3UONHUgt.js";import"./index-sDDx6rHS.js";import"./arrayPush-BSJv3pvf.js";import"./error-D_Dr4eZ1.js";import"./castArray-CrR6ThzE.js";import"./index-BTKOuuO-.js";import"./Uint8Array-CciKCZ4D.js";import"./initCloneObject-CgfAM3l4.js";import"./token-DWNpOE8r.js";import"./strings-Dn0paU8A.js";import"./isEqual-Bk3Ev3n-.js";import"./index-DZ037HE8.js";import"./scroll-CUPJOhL3.js";import"./debounce-DxlXJIjP.js";import"./baseIteratee-BWW_bLFf.js";import"./index-Db-FWnln.js";import"./index-CoC2P9bA.js";import"./isUndefined-DgmxjSXK.js";import"./index-DJHOhiPI.js";let A=null;function H(){return A||(A=function(){const t=e(),{isConnected:l,connect:s,subscribe:o,unsubscribe:i,disconnect:r}=M({reconnectDelay:2e4,connectionTimeout:15e3,useExponentialBackoff:!1,maxReconnectAttempts:3}),d=a([]),n=a(new Set),c=a([]),u=e=>{if(e.body)try{const a=JSON.parse(e.body),l=a.dictCode;if(!l)return;t.removeDictItem(l),c.value.forEach((e=>{try{e(a)}catch(t){}}))}catch(a){}};return{isConnected:l,initWebSocket:async()=>{try{return void 0}catch(e){}},closeWebSocket:()=>{d.value.forEach((e=>{i(e)})),d.value=[],n.value.clear(),r()},handleDictEvent:u,onDictMessage:e=>(c.value.push(e),()=>{const a=c.value.indexOf(e);-1!==a&&c.value.splice(a,1)})}}()),A}const F={class:"app-container"},N={class:"card-header"},P={class:"flex justify-between items-center"},J={key:0,class:"dict-form"},Q={class:"flex justify-between items-center"},R={class:"dict-component-demo"},q={class:"mt-4 pt-3 border-top"},B={class:"text-muted mb-2"},K={class:"text-muted"},X={class:"flex justify-between items-center"},$={class:"cache-content"},G={class:"cache-data"},L="gender",Z=T(t({__name:"dict-sync",setup(t){const M=e(),T=a(!1),A=a("-"),Z=a(null),ee=a(""),ae=H(),te=l((()=>ae.isConnected)),le=l((()=>te.value?"已连接":"未连接"));let se=null;const oe=l((()=>M.getDictItems(L).length>0)),ie=async()=>{await M.loadDictItems(L),g.success("字典组件已刷新")},re=async()=>{const e=await z.getDictItemFormData(L,"1");Z.value=e},de=async()=>{if(Z.value){T.value=!0;try{await z.updateDictItem(L,"1",Z.value),A.value=j(new Date,"YYYY-MM-DD HH:mm:ss").value,g.success("保存成功，后端将通过WebSocket通知所有客户端")}catch(e){g.error("保存失败")}finally{T.value=!1}}};return s((async()=>{await re(),await M.loadDictItems(L),ee.value="1",ae.initWebSocket(),se=ae.onDictMessage((e=>{e.dictCode===L&&(A.value=j(new Date,"YYYY-MM-DD HH:mm:ss").value,_((()=>{ie()})))}))})),o((()=>{null==se||se()})),(e,a)=>{const t=O,l=Y,s=U,o=W,j=C,_=I,g=S,z=V,H=E,L=k,ae=D,se=x,ne=w,ce=h;return r(),i("div",F,[d(L,{class:"box-card"},{header:n((()=>[u("div",N,[a[5]||(a[5]=u("span",null,"字典WebSocket实时更新演示",-1)),d(t,{type:p(te)?"success":"danger",size:"small",class:"ml-2"},{default:n((()=>[c(" WebSocket "+b(p(le)),1)])),_:1},8,["type"])])])),default:n((()=>[d(l,{type:"info",closable:!1,class:"mb-4"},{default:n((()=>a[6]||(a[6]=[c(' 本示例展示WebSocket实时更新字典缓存的效果。您可以编辑"男"性别字典项，保存后后端将通过WebSocket通知所有客户端刷新缓存。 ')]))),_:1}),d(ce,{gutter:16},{default:n((()=>[d(ae,{span:8},{default:n((()=>[d(L,{shadow:"hover",class:"dict-card"},{header:n((()=>[u("div",P,[a[8]||(a[8]=u("span",null,"性别字典项 - 男",-1)),d(s,{type:"warning",size:"small",onClick:re},{default:n((()=>a[7]||(a[7]=[c("重新加载")]))),_:1})])])),default:n((()=>[u("div",null,[p(Z)?(r(),i("div",J,[d(z,{model:p(Z),"label-width":"80px"},{default:n((()=>[d(j,{label:"字典编码"},{default:n((()=>[d(o,{modelValue:p(Z).dictCode,"onUpdate:modelValue":a[0]||(a[0]=e=>p(Z).dictCode=e),disabled:""},null,8,["modelValue"])])),_:1}),d(j,{label:"字典标签"},{default:n((()=>[d(o,{modelValue:p(Z).label,"onUpdate:modelValue":a[1]||(a[1]=e=>p(Z).label=e)},null,8,["modelValue"])])),_:1}),d(j,{label:"字典值"},{default:n((()=>[d(o,{modelValue:p(Z).value,"onUpdate:modelValue":a[2]||(a[2]=e=>p(Z).value=e),disabled:""},null,8,["modelValue"])])),_:1}),d(j,{label:"标记颜色"},{default:n((()=>[d(g,{modelValue:p(Z).tagType,"onUpdate:modelValue":a[3]||(a[3]=e=>p(Z).tagType=e),placeholder:"选择标签类型",style:{width:"100%"}},{default:n((()=>[d(_,{value:"success",label:"success"},{default:n((()=>[d(t,{type:"success"},{default:n((()=>a[9]||(a[9]=[c("success")]))),_:1})])),_:1}),d(_,{value:"warning",label:"warning"},{default:n((()=>[d(t,{type:"warning"},{default:n((()=>a[10]||(a[10]=[c("warning")]))),_:1})])),_:1}),d(_,{value:"danger",label:"danger"},{default:n((()=>[d(t,{type:"danger"},{default:n((()=>a[11]||(a[11]=[c("danger")]))),_:1})])),_:1}),d(_,{value:"info",label:"info"},{default:n((()=>[d(t,{type:"info"},{default:n((()=>a[12]||(a[12]=[c("info")]))),_:1})])),_:1}),d(_,{value:"primary",label:"primary"},{default:n((()=>[d(t,{type:"primary"},{default:n((()=>a[13]||(a[13]=[c("primary")]))),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(j,null,{default:n((()=>[d(s,{type:"primary",loading:p(T),onClick:de},{default:n((()=>a[14]||(a[14]=[c("保存")]))),_:1},8,["loading"]),d(s,{onClick:re},{default:n((()=>a[15]||(a[15]=[c("重置")]))),_:1})])),_:1})])),_:1},8,["model"])])):(r(),m(H,{key:1,description:"暂无字典数据"}))])])),_:1})])),_:1}),d(ae,{span:8},{default:n((()=>[d(L,{shadow:"hover",class:"dict-card"},{header:n((()=>[u("div",Q,[a[17]||(a[17]=u("span",null,"字典组件展示",-1)),d(s,{type:"primary",size:"small",onClick:ie},{default:n((()=>a[16]||(a[16]=[c(" 手动刷新 ")]))),_:1})])])),default:n((()=>[u("div",R,[a[18]||(a[18]=u("h4",{class:"mt-4 mb-3"},"性别组件",-1)),d(ne,{modelValue:p(ee),"onUpdate:modelValue":a[4]||(a[4]=e=>f(ee)?ee.value=e:null)},{default:n((()=>[(r(!0),i(v,null,y(p(M).getDictItems("gender"),(e=>(r(),m(se,{key:e.value,value:e.value},{default:n((()=>[c(b(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"]),a[19]||(a[19]=u("h4",{class:"mt-4 mb-3"},"性别标签",-1)),u("div",null,[(r(!0),i(v,null,y(p(M).getDictItems("gender"),(e=>(r(),m(t,{key:e.value,type:e.tagType||void 0,class:"mr-2"},{default:n((()=>[c(b(e.label),1)])),_:2},1032,["type"])))),128))]),u("div",q,[u("div",B,"已选择值: "+b(p(ee)),1),u("div",K,"最后更新: "+b(p(A)),1)])])])),_:1})])),_:1}),d(ae,{span:8},{default:n((()=>[d(L,{shadow:"hover",class:"dict-card"},{header:n((()=>[u("div",X,[a[22]||(a[22]=u("span",null,"字典缓存数据",-1)),u("div",null,[p(oe)?(r(),m(t,{key:0,type:"success",class:"ml-2",size:"small"},{default:n((()=>a[20]||(a[20]=[c(" 已缓存 ")]))),_:1})):(r(),m(t,{key:1,type:"danger",class:"ml-2",size:"small"},{default:n((()=>a[21]||(a[21]=[c("未缓存")]))),_:1}))])])])),default:n((()=>[u("div",$,[u("pre",G,b(JSON.stringify(p(M).getDictItems("gender"),null,2)),1)])])),_:1})])),_:1})])),_:1})])),_:1})])}}}),[["__scopeId","data-v-65ac0a44"]]);export{Z as default};
