import{d as e,al as a,r as l,S as t,c as o,aJ as r,o as s,bs as i,g as d,f as n,m as u,w as p,i as m,C as c,$ as f,a0 as g,W as b,e as j,h as v,F as h,ap as y,P as _,Q as V,db as w,b0 as k,aD as x}from"./index-D7ip52rg.js";import{v as U}from"./loading-DxPw_3Oa.js";import{E as C}from"./drawer-CEFoy5Jv.js";import"./overlay-zJsoxDP-.js";import{E}from"./switch-BO-QxUBF.js";import{_ as I}from"./index.vuevuetypescriptsetuptruelang-DVlHw9sn.js";/* empty css            */import{E as z,a as T}from"./select-DsXUxeIp.js";import"./scrollbar-BkAw2MiZ.js";import"./popper-BESiP4FJ.js";import"./tree-CzFGQOxg.js";import"./checkbox-CjWUz1I7.js";import"./text-idL1SFOL.js";import{E as R}from"./tree-select-D-U65GZr.js";import{E as D}from"./row-DuytwHId.js";import{E as N}from"./card-Bb1B2b71.js";import{_ as O}from"./index-CnOE4X2S.js";import{a as S,E as q}from"./table-column-CvTr7kWI.js";/* empty css                */import{_ as B}from"./DictLabel.vuevuetypescriptsetuptruelang-DBBIg43U.js";import{a as F,E as L}from"./form-item-BlA0YleD.js";import{E as P}from"./button-B7Cpnz14.js";import{E as A}from"./date-picker-DY6DS7lR.js";import{E as Y}from"./input-DKRZ9Ufq.js";import{E as Z}from"./col-DZbnyk1-.js";import{D as K}from"./dept.api-B-jsYzlA.js";import{R as M}from"./role.api-CJ_PG0Cp.js";import{_ as $}from"./DeptTree.vuevuetypescriptsetuptruelang-Xblx8dFH.js";import{_ as J}from"./UserImport.vuevuetypescriptsetuptruelang-Cwv0kBKz.js";import{E as Q}from"./message-box-Cvg2XbwU.js";import{E as W}from"./index-D_wDnIQN.js";import"./index-DTFD3zWA.js";import"./use-dialog-B8tOXKTe.js";import"./event-BwRzfsZt.js";import"./use-form-common-props-DwxMrRCA.js";import"./isUndefined-DgmxjSXK.js";import"./index-BxxfRVFK.js";import"./vnode-DhFYmvEg.js";import"./error-D_Dr4eZ1.js";import"./scroll-BAD_dPbv.js";import"./index-CDP4S9XB.js";import"./arrayPush-BjozOkDH.js";import"./radio-group-DWWmPQiy.js";/* empty css              */import"./token-DWNpOE8r.js";import"./strings-DayrX4yN.js";import"./castArray-CEfX6IyU.js";import"./isEqual-R-_2t1hV.js";import"./Uint8Array-DqRcKjos.js";import"./index-0-wkw8e5.js";import"./debounce-mjMVbbDV.js";import"./baseIteratee-DqyYX5Kq.js";import"./index-7fzrV7VL.js";import"./index-CDOFmm9f.js";import"./pagination-R5u_kM9p.js";import"./plugin-vueexport-helper-BCo6x5W8.js";import"./initCloneObject-C46LucBl.js";import"./index-BTKOuuO-.js";import"./dayjs.min-B355WD75.js";import"./index-Cfrhvgf0.js";import"./index-BJT6BNQs.js";import"./alert-CpmWwg1N.js";import"./dialog-Dicd65VQ.js";import"./refs-Chuf_Vkk.js";import"./progress-BBsa7Ash.js";import"./link-CAsUMmxH.js";const X={class:"app-container"},G={class:"search-container"},H={class:"data-table__toolbar"},ee={class:"data-table__toolbar--actions"},ae={class:"data-table__toolbar--tools"},le={class:"dialog-footer"},te=e({name:"User",inheritAttrs:!1,__name:"index",setup(e){const te=a(),oe=l(),re=l(),se=t({pageNum:1,pageSize:10}),ie=l(),de=l(0),ne=l(!1),ue=t({visible:!1,title:"新增用户"}),pe=o((()=>te.device===r.DESKTOP?"600px":"90%")),me=t({status:1}),ce=t({username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],deptId:[{required:!0,message:"所属部门不能为空",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}],email:[{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],mobile:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),fe=l([]),ge=l(),be=l(),je=l(!1);async function ve(){ne.value=!0;try{const e=await k.getPage(se);ie.value=e.list,de.value=e.total}finally{ne.value=!1}}function he(){se.pageNum=1,ve()}function ye(){oe.value.resetFields(),se.pageNum=1,se.deptId=void 0,se.createTime=void 0,ve()}function _e(e){fe.value=e.map((e=>e.id))}async function Ve(e){ue.visible=!0,be.value=await M.getOptions(),ge.value=await K.getOptions(),e?(ue.title="修改用户",k.getFormData(e).then((e=>{Object.assign(me,{...e})}))):ue.title="新增用户"}function we(){ue.visible=!1,re.value.resetFields(),re.value.clearValidate(),me.id=void 0,me.status=1}const ke=w((()=>{re.value.validate((e=>{if(e){const e=me.id;ne.value=!0,e?k.update(e,me).then((()=>{x.success("修改用户成功"),we(),ye()})).finally((()=>ne.value=!1)):k.create(me).then((()=>{x.success("新增用户成功"),we(),ye()})).finally((()=>ne.value=!1))}}))}),1e3);function xe(e){const a=[e||fe.value].join(",");a?Q.confirm("确认删除用户?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){ne.value=!0,k.deleteByIds(a).then((()=>{x.success("删除成功"),ye()})).finally((()=>ne.value=!1))}),(function(){x.info("已取消删除")})):x.warning("请勾选删除项")}function Ue(){je.value=!0}function Ce(){k.export(se).then((e=>{const a=e.data,l=decodeURI(e.headers["content-disposition"].split(";")[1].split("=")[1]),t=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"}),o=window.URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}))}return s((()=>{he()})),(e,a)=>{const l=Z,t=Y,o=L,r=T,s=z,w=A,K=P,M=F,te=q,Ee=B,Ie=W,ze=S,Te=O,Re=N,De=D,Ne=R,Oe=I,Se=E,qe=C,Be=i("hasPerm"),Fe=U;return n(),d("div",X,[u(De,{gutter:20},{default:p((()=>[u(l,{lg:4,xs:24,class:"mb-[12px]"},{default:p((()=>[u($,{modelValue:m(se).deptId,"onUpdate:modelValue":a[0]||(a[0]=e=>m(se).deptId=e),onNodeClick:he},null,8,["modelValue"])])),_:1}),u(l,{lg:20,xs:24},{default:p((()=>[c("div",G,[u(M,{ref_key:"queryFormRef",ref:oe,model:m(se),inline:!0,"label-width":"auto"},{default:p((()=>[u(o,{label:"关键字",prop:"keywords"},{default:p((()=>[u(t,{modelValue:m(se).keywords,"onUpdate:modelValue":a[1]||(a[1]=e=>m(se).keywords=e),placeholder:"用户名/昵称/手机号",clearable:"",onKeyup:f(he,["enter"])},null,8,["modelValue"])])),_:1}),u(o,{label:"状态",prop:"status"},{default:p((()=>[u(s,{modelValue:m(se).status,"onUpdate:modelValue":a[2]||(a[2]=e=>m(se).status=e),placeholder:"全部",clearable:"",style:{width:"100px"}},{default:p((()=>[u(r,{label:"正常",value:1}),u(r,{label:"禁用",value:0})])),_:1},8,["modelValue"])])),_:1}),u(o,{label:"创建时间"},{default:p((()=>[u(w,{modelValue:m(se).createTime,"onUpdate:modelValue":a[3]||(a[3]=e=>m(se).createTime=e),editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"截止时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),u(o,{class:"search-buttons"},{default:p((()=>[u(K,{type:"primary",icon:"search",onClick:he},{default:p((()=>a[20]||(a[20]=[g("搜索")]))),_:1}),u(K,{icon:"refresh",onClick:ye},{default:p((()=>a[21]||(a[21]=[g("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),u(Re,{shadow:"hover",class:"data-table"},{default:p((()=>[c("div",H,[c("div",ee,[b((n(),j(K,{type:"success",icon:"plus",onClick:a[4]||(a[4]=e=>Ve())},{default:p((()=>a[22]||(a[22]=[g(" 新增 ")]))),_:1})),[[Be,["sys:user:add"]]]),b((n(),j(K,{type:"danger",icon:"delete",disabled:0===m(fe).length,onClick:a[5]||(a[5]=e=>xe())},{default:p((()=>a[23]||(a[23]=[g(" 删除 ")]))),_:1},8,["disabled"])),[[Be,"sys:user:delete"]])]),c("div",ae,[b((n(),j(K,{icon:"upload",onClick:Ue},{default:p((()=>a[24]||(a[24]=[g(" 导入 ")]))),_:1})),[[Be,"sys:user:import"]]),b((n(),j(K,{icon:"download",onClick:Ce},{default:p((()=>a[25]||(a[25]=[g(" 导出 ")]))),_:1})),[[Be,"sys:user:export"]])])]),b((n(),j(ze,{data:m(ie),border:"",stripe:"","highlight-current-row":"",class:"data-table__content",onSelectionChange:_e},{default:p((()=>[u(te,{type:"selection",width:"50",align:"center"}),u(te,{label:"用户名",prop:"username"}),u(te,{label:"昵称",width:"150",align:"center",prop:"nickname"}),u(te,{label:"性别",width:"100",align:"center"},{default:p((e=>[u(Ee,{modelValue:e.row.gender,"onUpdate:modelValue":a=>e.row.gender=a,code:"gender"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),u(te,{label:"部门",width:"120",align:"center",prop:"deptName"}),u(te,{label:"手机号码",align:"center",prop:"mobile",width:"120"}),u(te,{label:"邮箱",align:"center",prop:"email",width:"160"}),u(te,{label:"状态",align:"center",prop:"status",width:"80"},{default:p((e=>[u(Ie,{type:1==e.row.status?"success":"info"},{default:p((()=>[g(h(1==e.row.status?"正常":"禁用"),1)])),_:2},1032,["type"])])),_:1}),u(te,{label:"创建时间",align:"center",prop:"createTime",width:"150"}),u(te,{label:"操作",fixed:"right",width:"220"},{default:p((e=>[b((n(),j(K,{type:"primary",icon:"RefreshLeft",size:"small",link:"",onClick:a=>{return l=e.row,void Q.prompt("请输入用户【"+l.username+"】的新密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:e})=>{if(!e||e.length<6)return x.warning("密码至少需要6位字符，请重新输入"),!1;k.resetPassword(l.id,e).then((()=>{x.success("密码重置成功，新密码是："+e)}))}),(()=>{x.info("已取消重置密码")}));var l}},{default:p((()=>a[26]||(a[26]=[g(" 重置密码 ")]))),_:2},1032,["onClick"])),[[Be,"sys:user:reset-password"]]),b((n(),j(K,{type:"primary",icon:"edit",link:"",size:"small",onClick:a=>Ve(e.row.id)},{default:p((()=>a[27]||(a[27]=[g(" 编辑 ")]))),_:2},1032,["onClick"])),[[Be,"sys:user:edit"]]),b((n(),j(K,{type:"danger",icon:"delete",link:"",size:"small",onClick:a=>xe(e.row.id)},{default:p((()=>a[28]||(a[28]=[g(" 删除 ")]))),_:2},1032,["onClick"])),[[Be,"sys:user:delete"]])])),_:1})])),_:1},8,["data"])),[[Fe,m(ne)]]),m(de)>0?(n(),j(Te,{key:0,total:m(de),"onUpdate:total":a[6]||(a[6]=e=>y(de)?de.value=e:null),page:m(se).pageNum,"onUpdate:page":a[7]||(a[7]=e=>m(se).pageNum=e),limit:m(se).pageSize,"onUpdate:limit":a[8]||(a[8]=e=>m(se).pageSize=e),onPagination:ve},null,8,["total","page","limit"])):v("",!0)])),_:1})])),_:1})])),_:1}),u(qe,{modelValue:m(ue).visible,"onUpdate:modelValue":a[17]||(a[17]=e=>m(ue).visible=e),title:m(ue).title,"append-to-body":"",size:m(pe),onClose:we},{footer:p((()=>[c("div",le,[u(K,{type:"primary",onClick:m(ke)},{default:p((()=>a[29]||(a[29]=[g("确 定")]))),_:1},8,["onClick"]),u(K,{onClick:we},{default:p((()=>a[30]||(a[30]=[g("取 消")]))),_:1})])])),default:p((()=>[u(M,{ref_key:"userFormRef",ref:re,model:m(me),rules:m(ce),"label-width":"80px"},{default:p((()=>[u(o,{label:"用户名",prop:"username"},{default:p((()=>[u(t,{modelValue:m(me).username,"onUpdate:modelValue":a[9]||(a[9]=e=>m(me).username=e),readonly:!!m(me).id,placeholder:"请输入用户名"},null,8,["modelValue","readonly"])])),_:1}),u(o,{label:"用户昵称",prop:"nickname"},{default:p((()=>[u(t,{modelValue:m(me).nickname,"onUpdate:modelValue":a[10]||(a[10]=e=>m(me).nickname=e),placeholder:"请输入用户昵称"},null,8,["modelValue"])])),_:1}),u(o,{label:"所属部门",prop:"deptId"},{default:p((()=>[u(Ne,{modelValue:m(me).deptId,"onUpdate:modelValue":a[11]||(a[11]=e=>m(me).deptId=e),placeholder:"请选择所属部门",data:m(ge),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])])),_:1}),u(o,{label:"性别",prop:"gender"},{default:p((()=>[u(Oe,{modelValue:m(me).gender,"onUpdate:modelValue":a[12]||(a[12]=e=>m(me).gender=e),code:"gender"},null,8,["modelValue"])])),_:1}),u(o,{label:"角色",prop:"roleIds"},{default:p((()=>[u(s,{modelValue:m(me).roleIds,"onUpdate:modelValue":a[13]||(a[13]=e=>m(me).roleIds=e),multiple:"",placeholder:"请选择"},{default:p((()=>[(n(!0),d(_,null,V(m(be),(e=>(n(),j(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(o,{label:"手机号码",prop:"mobile"},{default:p((()=>[u(t,{modelValue:m(me).mobile,"onUpdate:modelValue":a[14]||(a[14]=e=>m(me).mobile=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])])),_:1}),u(o,{label:"邮箱",prop:"email"},{default:p((()=>[u(t,{modelValue:m(me).email,"onUpdate:modelValue":a[15]||(a[15]=e=>m(me).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])])),_:1}),u(o,{label:"状态",prop:"status"},{default:p((()=>[u(Se,{modelValue:m(me).status,"onUpdate:modelValue":a[16]||(a[16]=e=>m(me).status=e),"inline-prompt":"","active-text":"正常","inactive-text":"禁用","active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","size"]),u(J,{modelValue:m(je),"onUpdate:modelValue":a[18]||(a[18]=e=>y(je)?je.value=e:null),onImportSuccess:a[19]||(a[19]=e=>he())},null,8,["modelValue"])])}}});export{te as default};
