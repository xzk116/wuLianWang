import{d as e,al as l,r as a,S as t,c as o,aJ as r,o as s,ar as i,bs as d,g as u,f as n,C as p,m,w as c,$ as f,i as y,a0 as v,W as h,e as _,h as b,E as k,D as g,n as V,F as j,j as w,aR as U,P as x,Q as E,aD as C}from"./index-BZPYVMdZ.js";import{v as N}from"./loading-DDTeakbj.js";import{E as T}from"./drawer-nLbTBAPa.js";import"./overlay-CegApiS5.js";import{_ as A}from"./index-BF4Bl84c.js";import{E as O}from"./input-Dq8FX6aO.js";import{E as M}from"./input-number-CDnOP_Qt.js";/* empty css                */import{E as L}from"./popper-DnITBtI2.js";import{E as I,a as P}from"./radio-group-DAkQUi7t.js";/* empty css              *//* empty css            */import"./select-DteJ4fce.js";import"./scrollbar-BZ5VyE9B.js";import"./tree-BsqpmvEw.js";import"./checkbox-BFOScdKr.js";import"./text-Ar_Dxy_6.js";import{E as B}from"./tree-select-CfI1iZzI.js";import{E as q}from"./card-CIEdBoeN.js";import{a as F,E as G}from"./table-column-klqMZtCt.js";import{E as S,a as K}from"./form-item-nIdgBnWJ.js";import{E as R}from"./button-EMBpTpaQ.js";import{M as z}from"./menu.api-DBOdzjTF.js";import{E as D}from"./message-box-BvL9BEpk.js";import{E as X}from"./index-BwFsIJJc.js";import"./index-BolRj6AN.js";import"./index-BHcVCRRw.js";import"./vnode-CSO68wsp.js";import"./event-BwRzfsZt.js";import"./error-D_Dr4eZ1.js";import"./scroll-BtmfBwaJ.js";import"./use-form-common-props-CfY8xk-s.js";import"./isUndefined-DgmxjSXK.js";import"./popover-DzrsDmdL.js";import"./dropdown-DD0sSXuI.js";import"./tab-pane-C7Av_78P.js";import"./strings-CybwIUsL.js";import"./index-nfVhjnC1.js";import"./plugin-vueexport-helper-BCo6x5W8.js";import"./index-s92VVdjK.js";import"./arrayPush-BDpBx9Er.js";import"./index-Bcc3ZbSe.js";import"./index-DXj9Gj_Y.js";import"./index-CV6iJPzL.js";import"./token-DWNpOE8r.js";import"./castArray-Dhq8PbBm.js";import"./isEqual-bCEMee8h.js";import"./Uint8Array-COfKfiL_.js";import"./debounce-CW9Kma0L.js";import"./baseIteratee-_SOm5p9R.js";import"./index-Bau-4qLp.js";import"./index-BFIOGkf8.js";import"./initCloneObject-TgRpAVf4.js";import"./index-BTKOuuO-.js";var Q=(e=>(e[e.CATALOG=2]="CATALOG",e[e.MENU=1]="MENU",e[e.BUTTON=4]="BUTTON",e[e.EXTLINK=3]="EXTLINK",e))(Q||{});const W={class:"app-container"},$={class:"search-container"},H={class:"data-table__toolbar"},J={class:"data-table__toolbar--actions"},Y={class:"flex-y-center"},Z={class:"flex-y-center"},ee={class:"flex-y-center"},le={class:"flex-y-center"},ae={key:0},te={key:1},oe={class:"flex-y-center"},re={class:"dialog-footer"},se=e({name:"SysMenu",inheritAttrs:!1,__name:"index",setup(e){const se=l(),ie=a(),de=a(),ue=a(!1),ne=t({title:"新增菜单",visible:!1}),pe=o((()=>se.device===r.DESKTOP?"600px":"90%")),me=t({}),ce=a([]),fe=a([]),ye=a({id:void 0,parentId:"0",visible:1,sort:1,type:Q.MENU,alwaysShow:0,keepAlive:1,params:[]}),ve=a({...ye.value}),he=t({parentId:[{required:!0,message:"请选择父级菜单",trigger:"blur"}],name:[{required:!0,message:"请输入菜单名称",trigger:"blur"}],type:[{required:!0,message:"请选择菜单类型",trigger:"blur"}],routeName:[{required:!0,message:"请输入路由名称",trigger:"blur"}],routePath:[{required:!0,message:"请输入路由路径",trigger:"blur"}],component:[{required:!0,message:"请输入组件路径",trigger:"blur"}],visible:[{required:!0,message:"请选择显示状态",trigger:"change"}]}),_e=a();function be(){ue.value=!0,z.getList(me).then((e=>{ce.value=e})).finally((()=>{ue.value=!1}))}function ke(){ie.value.resetFields(),be()}function ge(e){_e.value=e.id}function Ve(e,l){z.getOptions(!0).then((e=>{fe.value=[{value:"0",label:"顶级菜单",children:e}]})).then((()=>{ne.visible=!0,l?(ne.title="编辑菜单",z.getFormData(l).then((e=>{ye.value={...e},ve.value=e}))):(ne.title="新增菜单",ve.value.parentId=null==e?void 0:e.toString())}))}function je(){ve.value.type!==ye.value.type&&ve.value.type===Q.MENU&&(ye.value.type===Q.CATALOG?ve.value.component="":(ve.value.routePath=ye.value.routePath,ve.value.component=ye.value.component))}function we(){de.value.validate((e=>{if(e){const e=ve.value.id;if(e){if(ve.value.parentId==e)return void C.error("父级菜单不能为当前菜单");z.update(e,ve.value).then((()=>{C.success("修改成功"),Ue(),be()}))}else z.create(ve.value).then((()=>{C.success("新增成功"),Ue(),be()}))}}))}function Ue(){ne.visible=!1,de.value.resetFields(),de.value.clearValidate(),ve.value={id:void 0,parentId:"0",visible:1,sort:1,type:Q.MENU,alwaysShow:0,keepAlive:1,params:[]}}return s((()=>{be()})),(e,l)=>{const a=O,t=S,o=R,r=K,s=k,se=G,ye=X,_e=F,xe=q,Ee=B,Ce=P,Ne=I,Te=i("QuestionFilled"),Ae=L,Oe=i("CirclePlusFilled"),Me=i("DeleteFilled"),Le=M,Ie=A,Pe=T,Be=d("hasPerm"),qe=N;return n(),u("div",W,[p("div",$,[m(r,{ref_key:"queryFormRef",ref:ie,model:y(me),inline:!0,"label-width":"auto"},{default:c((()=>[m(t,{label:"关键字",prop:"keywords"},{default:c((()=>[m(a,{modelValue:y(me).keywords,"onUpdate:modelValue":l[0]||(l[0]=e=>y(me).keywords=e),placeholder:"菜单名称",clearable:"",onKeyup:f(be,["enter"])},null,8,["modelValue"])])),_:1}),m(t,{class:"search-buttons"},{default:c((()=>[m(o,{type:"primary",icon:"search",onClick:be},{default:c((()=>l[20]||(l[20]=[v("搜索")]))),_:1}),m(o,{icon:"refresh",onClick:ke},{default:c((()=>l[21]||(l[21]=[v("重置")]))),_:1})])),_:1})])),_:1},8,["model"])]),m(xe,{shadow:"hover",class:"data-table"},{default:c((()=>[p("div",H,[p("div",J,[h((n(),_(o,{type:"success",icon:"plus",onClick:l[1]||(l[1]=e=>Ve("0"))},{default:c((()=>l[22]||(l[22]=[v(" 新增 ")]))),_:1})),[[Be,["sys:menu:add"]]])])]),h((n(),_(_e,{ref:"dataTableRef","row-key":"id",data:y(ce),"tree-props":{children:"children",hasChildren:"hasChildren"},class:"data-table__content",onRowClick:ge},{default:c((()=>[m(se,{label:"菜单名称","min-width":"200"},{default:c((e=>[e.row.icon&&e.row.icon.startsWith("el-icon")?(n(),_(s,{key:0,style:{"vertical-align":"-0.15em"}},{default:c((()=>[(n(),_(g(e.row.icon.replace("el-icon-",""))))])),_:2},1024)):e.row.icon?(n(),u("div",{key:1,class:V(`i-svg:${e.row.icon}`)},null,2)):b("",!0),v(" "+j(e.row.name),1)])),_:1}),m(se,{label:"类型",align:"center",width:"80"},{default:c((e=>[e.row.type===y(Q).CATALOG?(n(),_(ye,{key:0,type:"warning"},{default:c((()=>l[23]||(l[23]=[v("目录")]))),_:1})):b("",!0),e.row.type===y(Q).MENU?(n(),_(ye,{key:1,type:"success"},{default:c((()=>l[24]||(l[24]=[v("菜单")]))),_:1})):b("",!0),e.row.type===y(Q).BUTTON?(n(),_(ye,{key:2,type:"danger"},{default:c((()=>l[25]||(l[25]=[v("按钮")]))),_:1})):b("",!0),e.row.type===y(Q).EXTLINK?(n(),_(ye,{key:3,type:"info"},{default:c((()=>l[26]||(l[26]=[v("外链")]))),_:1})):b("",!0)])),_:1}),m(se,{label:"路由名称",align:"left",width:"150",prop:"routeName"}),m(se,{label:"路由路径",align:"left",width:"150",prop:"routePath"}),m(se,{label:"组件路径",align:"left",width:"250",prop:"component"}),m(se,{label:"权限标识",align:"center",width:"200",prop:"perm"}),m(se,{label:"状态",align:"center",width:"80"},{default:c((e=>[1===e.row.visible?(n(),_(ye,{key:0,type:"success"},{default:c((()=>l[27]||(l[27]=[v("显示")]))),_:1})):(n(),_(ye,{key:1,type:"info"},{default:c((()=>l[28]||(l[28]=[v("隐藏")]))),_:1}))])),_:1}),m(se,{label:"排序",align:"center",width:"80",prop:"sort"}),m(se,{fixed:"right",align:"center",label:"操作",width:"220"},{default:c((e=>[e.row.type==y(Q).CATALOG||e.row.type==y(Q).MENU?h((n(),_(o,{key:0,type:"primary",link:"",size:"small",icon:"plus",onClick:w((l=>Ve(e.row.id)),["stop"])},{default:c((()=>l[29]||(l[29]=[v(" 新增 ")]))),_:2},1032,["onClick"])),[[Be,["sys:menu:add"]]]):b("",!0),h((n(),_(o,{type:"primary",link:"",size:"small",icon:"edit",onClick:w((l=>Ve(void 0,e.row.id)),["stop"])},{default:c((()=>l[30]||(l[30]=[v(" 编辑 ")]))),_:2},1032,["onClick"])),[[Be,["sys:menu:edit"]]]),h((n(),_(o,{type:"danger",link:"",size:"small",icon:"delete",onClick:w((l=>function(e){if(!e)return C.warning("请勾选删除项"),!1;D.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{ue.value=!0,z.deleteById(e).then((()=>{C.success("删除成功"),be()})).finally((()=>{ue.value=!1}))}),(()=>{C.info("已取消删除")}))}(e.row.id)),["stop"])},{default:c((()=>l[31]||(l[31]=[v(" 删除 ")]))),_:2},1032,["onClick"])),[[Be,["sys:menu:delete"]]])])),_:1})])),_:1},8,["data"])),[[qe,y(ue)]])])),_:1}),m(Pe,{modelValue:y(ne).visible,"onUpdate:modelValue":l[19]||(l[19]=e=>y(ne).visible=e),title:y(ne).title,size:y(pe),onClose:Ue},{footer:c((()=>[p("div",re,[m(o,{type:"primary",onClick:we},{default:c((()=>l[56]||(l[56]=[v("确 定")]))),_:1}),m(o,{onClick:Ue},{default:c((()=>l[57]||(l[57]=[v("取 消")]))),_:1})])])),default:c((()=>[m(r,{ref_key:"menuFormRef",ref:de,model:y(ve),rules:y(he),"label-width":"100px"},{default:c((()=>[m(t,{label:"父级菜单",prop:"parentId"},{default:c((()=>[m(Ee,{modelValue:y(ve).parentId,"onUpdate:modelValue":l[2]||(l[2]=e=>y(ve).parentId=e),placeholder:"选择上级菜单",data:y(fe),filterable:"","check-strictly":"","render-after-expand":!1},null,8,["modelValue","data"])])),_:1}),m(t,{label:"菜单名称",prop:"name"},{default:c((()=>[m(a,{modelValue:y(ve).name,"onUpdate:modelValue":l[3]||(l[3]=e=>y(ve).name=e),placeholder:"请输入菜单名称"},null,8,["modelValue"])])),_:1}),m(t,{label:"菜单类型",prop:"type"},{default:c((()=>[m(Ne,{modelValue:y(ve).type,"onUpdate:modelValue":l[4]||(l[4]=e=>y(ve).type=e),onChange:je},{default:c((()=>[m(Ce,{value:y(Q).CATALOG},{default:c((()=>l[32]||(l[32]=[v("目录")]))),_:1},8,["value"]),m(Ce,{value:y(Q).MENU},{default:c((()=>l[33]||(l[33]=[v("菜单")]))),_:1},8,["value"]),m(Ce,{value:y(Q).BUTTON},{default:c((()=>l[34]||(l[34]=[v("按钮")]))),_:1},8,["value"]),m(Ce,{value:y(Q).EXTLINK},{default:c((()=>l[35]||(l[35]=[v("外链")]))),_:1},8,["value"])])),_:1},8,["modelValue"])])),_:1}),y(ve).type==y(Q).EXTLINK?(n(),_(t,{key:0,label:"外链地址",prop:"path"},{default:c((()=>[m(a,{modelValue:y(ve).routePath,"onUpdate:modelValue":l[5]||(l[5]=e=>y(ve).routePath=e),placeholder:"请输入外链完整路径"},null,8,["modelValue"])])),_:1})):b("",!0),y(ve).type==y(Q).MENU?(n(),_(t,{key:1,prop:"routeName"},{label:c((()=>[p("div",Y,[l[37]||(l[37]=v(" 路由名称 ")),m(Ae,{placement:"bottom",effect:"light"},{content:c((()=>l[36]||(l[36]=[v(" 如果需要开启缓存，需保证页面 defineOptions 中的 name 与此处一致，建议使用驼峰。 ")]))),default:c((()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c((()=>[m(Te)])),_:1})])),_:1})])])),default:c((()=>[m(a,{modelValue:y(ve).routeName,"onUpdate:modelValue":l[6]||(l[6]=e=>y(ve).routeName=e),placeholder:"User"},null,8,["modelValue"])])),_:1})):b("",!0),y(ve).type==y(Q).CATALOG||y(ve).type==y(Q).MENU?(n(),_(t,{key:2,prop:"routePath"},{label:c((()=>[p("div",Z,[l[39]||(l[39]=v(" 路由路径 ")),m(Ae,{placement:"bottom",effect:"light"},{content:c((()=>l[38]||(l[38]=[v(" 定义应用中不同页面对应的 URL 路径，目录需以 / 开头，菜单项不用。例如：系统管理目录 /system，系统管理下的用户管理菜单 user。 ")]))),default:c((()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c((()=>[m(Te)])),_:1})])),_:1})])])),default:c((()=>[y(ve).type==y(Q).CATALOG?(n(),_(a,{key:0,modelValue:y(ve).routePath,"onUpdate:modelValue":l[7]||(l[7]=e=>y(ve).routePath=e),placeholder:"system"},null,8,["modelValue"])):(n(),_(a,{key:1,modelValue:y(ve).routePath,"onUpdate:modelValue":l[8]||(l[8]=e=>y(ve).routePath=e),placeholder:"user"},null,8,["modelValue"]))])),_:1})):b("",!0),y(ve).type==y(Q).MENU?(n(),_(t,{key:3,prop:"component"},{label:c((()=>[p("div",ee,[l[41]||(l[41]=v(" 组件路径 ")),m(Ae,{placement:"bottom",effect:"light"},{content:c((()=>l[40]||(l[40]=[v(" 组件页面完整路径，相对于 src/views/，如 system/user/index，缺省后缀 .vue ")]))),default:c((()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c((()=>[m(Te)])),_:1})])),_:1})])])),default:c((()=>[m(a,{modelValue:y(ve).component,"onUpdate:modelValue":l[9]||(l[9]=e=>y(ve).component=e),placeholder:"system/user/index",style:{width:"95%"}},U({_:2},[y(ve).type==y(Q).MENU?{name:"prepend",fn:c((()=>[l[42]||(l[42]=v("src/views/"))])),key:"0"}:void 0,y(ve).type==y(Q).MENU?{name:"append",fn:c((()=>[l[43]||(l[43]=v(".vue"))])),key:"1"}:void 0]),1032,["modelValue"])])),_:1})):b("",!0),y(ve).type==y(Q).MENU?(n(),_(t,{key:4},{label:c((()=>[p("div",le,[l[45]||(l[45]=v(" 路由参数 ")),m(Ae,{placement:"bottom",effect:"light"},{content:c((()=>l[44]||(l[44]=[v(" 组件页面使用 `useRoute().query.参数名` 获取路由参数值。 ")]))),default:c((()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c((()=>[m(Te)])),_:1})])),_:1})])])),default:c((()=>[y(ve).params&&0!==y(ve).params.length?(n(),u("div",te,[(n(!0),u(x,null,E(y(ve).params,((e,t)=>(n(),u("div",{key:t},[m(a,{modelValue:e.key,"onUpdate:modelValue":l=>e.key=l,placeholder:"参数名",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),l[47]||(l[47]=p("span",{class:"mx-1"},"=",-1)),m(a,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:"参数值",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),y(ve).params.indexOf(e)===y(ve).params.length-1?(n(),_(s,{key:0,class:"ml-2 cursor-pointer color-[var(--el-color-success)]",style:{"vertical-align":"-0.15em"},onClick:l[11]||(l[11]=e=>y(ve).params.push({key:"",value:""}))},{default:c((()=>[m(Oe)])),_:1})):b("",!0),m(s,{class:"ml-2 cursor-pointer color-[var(--el-color-danger)]",style:{"vertical-align":"-0.15em"},onClick:l=>y(ve).params.splice(y(ve).params.indexOf(e),1)},{default:c((()=>[m(Me)])),_:2},1032,["onClick"])])))),128))])):(n(),u("div",ae,[m(o,{type:"success",plain:"",onClick:l[10]||(l[10]=e=>y(ve).params=[{key:"",value:""}])},{default:c((()=>l[46]||(l[46]=[v(" 添加路由参数 ")]))),_:1})]))])),_:1})):b("",!0),y(ve).type!==y(Q).BUTTON?(n(),_(t,{key:5,prop:"visible",label:"显示状态"},{default:c((()=>[m(Ne,{modelValue:y(ve).visible,"onUpdate:modelValue":l[12]||(l[12]=e=>y(ve).visible=e)},{default:c((()=>[m(Ce,{value:1},{default:c((()=>l[48]||(l[48]=[v("显示")]))),_:1}),m(Ce,{value:0},{default:c((()=>l[49]||(l[49]=[v("隐藏")]))),_:1})])),_:1},8,["modelValue"])])),_:1})):b("",!0),y(ve).type===y(Q).CATALOG||y(ve).type===y(Q).MENU?(n(),_(t,{key:6},{label:c((()=>[p("div",oe,[l[51]||(l[51]=v(" 始终显示 ")),m(Ae,{placement:"bottom",effect:"light"},{content:c((()=>l[50]||(l[50]=[v(' 选择"是"，即使目录或菜单下只有一个子节点，也会显示父节点。 '),p("br",null,null,-1),v(' 选择"否"，如果目录或菜单下只有一个子节点，则只显示该子节点，隐藏父节点。 '),p("br",null,null,-1),v(' 如果是叶子节点，请选择"否"。 ')]))),default:c((()=>[m(s,{class:"ml-1 cursor-pointer"},{default:c((()=>[m(Te)])),_:1})])),_:1})])])),default:c((()=>[m(Ne,{modelValue:y(ve).alwaysShow,"onUpdate:modelValue":l[13]||(l[13]=e=>y(ve).alwaysShow=e)},{default:c((()=>[m(Ce,{value:1},{default:c((()=>l[52]||(l[52]=[v("是")]))),_:1}),m(Ce,{value:0},{default:c((()=>l[53]||(l[53]=[v("否")]))),_:1})])),_:1},8,["modelValue"])])),_:1})):b("",!0),y(ve).type===y(Q).MENU?(n(),_(t,{key:7,label:"缓存页面"},{default:c((()=>[m(Ne,{modelValue:y(ve).keepAlive,"onUpdate:modelValue":l[14]||(l[14]=e=>y(ve).keepAlive=e)},{default:c((()=>[m(Ce,{value:1},{default:c((()=>l[54]||(l[54]=[v("开启")]))),_:1}),m(Ce,{value:0},{default:c((()=>l[55]||(l[55]=[v("关闭")]))),_:1})])),_:1},8,["modelValue"])])),_:1})):b("",!0),m(t,{label:"排序",prop:"sort"},{default:c((()=>[m(Le,{modelValue:y(ve).sort,"onUpdate:modelValue":l[15]||(l[15]=e=>y(ve).sort=e),style:{width:"100px"},"controls-position":"right",min:0},null,8,["modelValue"])])),_:1}),y(ve).type==y(Q).BUTTON?(n(),_(t,{key:8,label:"权限标识",prop:"perm"},{default:c((()=>[m(a,{modelValue:y(ve).perm,"onUpdate:modelValue":l[16]||(l[16]=e=>y(ve).perm=e),placeholder:"sys:user:add"},null,8,["modelValue"])])),_:1})):b("",!0),y(ve).type!==y(Q).BUTTON?(n(),_(t,{key:9,label:"图标",prop:"icon"},{default:c((()=>[m(Ie,{modelValue:y(ve).icon,"onUpdate:modelValue":l[17]||(l[17]=e=>y(ve).icon=e)},null,8,["modelValue"])])),_:1})):b("",!0),y(ve).type==y(Q).CATALOG?(n(),_(t,{key:10,label:"跳转路由"},{default:c((()=>[m(a,{modelValue:y(ve).redirect,"onUpdate:modelValue":l[18]||(l[18]=e=>y(ve).redirect=e),placeholder:"跳转路由"},null,8,["modelValue"])])),_:1})):b("",!0)])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","size"])])}}});export{se as default};
