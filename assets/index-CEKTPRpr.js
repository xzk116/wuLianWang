import{t as e,z as a,v as l,aU as s,a$ as r,_ as t,d as i,b as o,r as d,c as n,L as u,J as m,I as c,g as p,f,e as v,l as b,k as y,i as g,w,D as _,E as j,n as k,q as h,S as V,o as P,m as C,b0 as x,C as E,b1 as U,F as z,ar as F,a0 as q,h as A,aD as I}from"./index-C_pscggx.js";import{E as S}from"./dialog-DJrpLi5_.js";import"./overlay-9sIzXrAB.js";import{E as $,a as Z}from"./form-item-BUoGiRen.js";import{_ as R}from"./index.vuevuetypescriptsetuptruelang-R0bUYoFS.js";import{E as M}from"./input-CgmVFiXd.js";import{E as N}from"./row-B2YXVaSa.js";import{E as O,a as B}from"./descriptions-item-DLIqhYBZ.js";import{E as D}from"./col-BX-SxACW.js";import{E as T}from"./card-BD6WhDVX.js";import{E as J}from"./divider-EWkBQNuI.js";import{E as L}from"./button-D6WiEuQA.js";import{F as Q}from"./file.api-DrzjFHwT.js";import{_ as W}from"./plugin-vueexport-helper-BCo6x5W8.js";import"./index-37GVKp2t.js";import"./use-dialog-Dtu60b6r.js";import"./event-BwRzfsZt.js";import"./use-form-common-props-k9Y9pot7.js";import"./isUndefined-DgmxjSXK.js";import"./refs-BKA3fZeB.js";import"./index-C9xgaScg.js";import"./vnode-C0RjJ-Dw.js";import"./error-D_Dr4eZ1.js";import"./scroll-BTd0uGpI.js";import"./castArray-CH9hh3R4.js";import"./index-BTKOuuO-.js";import"./Uint8Array-B_DHHueC.js";import"./arrayPush-UAxBxc8B.js";import"./initCloneObject-aDgsBXeP.js";import"./checkbox-CGzZmvcj.js";import"./index-Bg6QofrX.js";import"./isEqual-C59KlRhy.js";import"./radio-group-DkO-SI3Y.js";/* empty css              *//* empty css            */import"./select-BFAQnkba.js";import"./popper-BIB9jUp6.js";import"./scrollbar-BLD92JNj.js";import"./index-Dwsffkj1.js";import"./token-DWNpOE8r.js";import"./strings-Buxz3p9C.js";import"./index-CgGV-G4I.js";import"./debounce-DKgtTNWe.js";import"./baseIteratee-BsyF-gsk.js";import"./index-C39Z87XQ.js";import"./index-BS1T2XoZ.js";const G=e({size:{type:[Number,String],values:r,default:"",validator:e=>s(e)},shape:{type:String,values:["circle","square"],default:"circle"},icon:{type:l},src:{type:String,default:""},alt:String,srcSet:String,fit:{type:a(String),default:"cover"}}),H={error:e=>e instanceof Event},K=i({name:"ElAvatar"});const X=h(t(i({...K,props:G,emits:H,setup(e,{emit:a}){const l=e,r=o("avatar"),t=d(!1),i=n((()=>{const{size:e,icon:a,shape:s}=l,t=[r.b()];return u(e)&&t.push(r.m(e)),a&&t.push(r.m("icon")),s&&t.push(r.m(s)),t})),h=n((()=>{const{size:e}=l;return s(e)?r.cssVarBlock({size:m(e)||""}):void 0})),V=n((()=>({objectFit:l.fit})));function P(e){t.value=!0,a("error",e)}return c((()=>l.src),(()=>t.value=!1)),(e,a)=>(f(),p("span",{class:k(g(i)),style:y(g(h))},[!e.src&&!e.srcSet||t.value?e.icon?(f(),v(g(j),{key:1},{default:w((()=>[(f(),v(_(e.icon)))])),_:1})):b(e.$slots,"default",{key:2}):(f(),p("img",{key:0,src:e.src,alt:e.alt,srcset:e.srcSet,style:y(g(V)),onError:P},null,44,["src","alt","srcset"]))],6))}}),[["__file","avatar.vue"]])),Y={class:"profile-container"},ee={class:"user-info"},ae={class:"avatar-wrapper"},le={class:"user-name"},se={class:"nickname"},re={class:"user-role"},te={class:"security-item"},ie={class:"dialog-footer"},oe=W(i({__name:"index",setup(e){const a=d({}),l=V({visible:!1,title:"",type:""}),s=d(),r=d(),t=d(),i=d(),o=V({}),n=V({}),u=V({}),m=V({}),c=d(0),b=d(),y=d(0),_=d(),k={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"}]},h={mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},W={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"请输入正确的邮箱地址",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},G=e=>{switch(l.type=e,l.visible=!0,e){case"account":l.title="账号资料",o.id=a.value.id,o.nickname=a.value.nickname,o.gender=a.value.gender;break;case"password":l.title="修改密码";break;case"mobile":l.title="绑定手机";break;case"email":l.title="绑定邮箱"}};function H(){if(!u.mobile)return void I.error("请输入手机号");/^1[3-9]\d{9}$/.test(u.mobile)?x.sendMobileCode(u.mobile).then((()=>{I.success("验证码发送成功"),c.value=60,b.value=setInterval((()=>{c.value>0?c.value-=1:clearInterval(b.value)}),1e3)})):I.error("手机号格式不正确")}function K(){if(!m.email)return void I.error("请输入邮箱");/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/.test(m.email)?x.sendEmailCode(m.email).then((()=>{I.success("验证码发送成功"),y.value=60,_.value=setInterval((()=>{y.value>0?y.value-=1:clearInterval(_.value)}),1e3)})):I.error("邮箱格式不正确")}const oe=async()=>{if("account"===l.type)x.updateProfile(o).then((()=>{I.success("账号资料修改成功"),l.visible=!1,ce()}));else if("password"===l.type){if(n.newPassword!==n.confirmPassword)return void I.error("两次输入的密码不一致");x.changePassword(n).then((()=>{I.success("密码修改成功"),l.visible=!1}))}else"mobile"===l.type?x.bindOrChangeMobile(u).then((()=>{I.success("手机号绑定成功"),l.visible=!1,ce()})):"email"===l.type&&x.bindOrChangeEmail(m).then((()=>{I.success("邮箱绑定成功"),l.visible=!1,ce()}))},de=()=>{var e,a,o,d;l.visible=!1,"account"===l.type?null==(e=s.value)||e.resetFields():"password"===l.type?null==(a=r.value)||a.resetFields():"mobile"===l.type?null==(o=t.value)||o.resetFields():"email"===l.type&&(null==(d=i.value)||d.resetFields())},ne=d(null),ue=()=>{var e;null==(e=ne.value)||e.click()},me=async e=>{const l=e.target,s=l.files?l.files[0]:null;if(s)try{const e=await Q.uploadFile(s);a.value.avatar=e.url,await x.updateProfile({avatar:e.url})}catch(r){I.error("头像上传失败")}},ce=async()=>{const e=await x.getProfile();a.value=e};return P((async()=>{b.value&&clearInterval(b.value),_.value&&clearInterval(_.value),await ce()})),(e,d)=>{const b=X,_=L,V=F("Edit"),P=j,x=J,I=T,Q=D,ce=F("Male"),pe=F("Female"),fe=B,ve=O,be=N,ye=M,ge=$,we=R,_e=Z,je=S;return f(),p("div",Y,[C(be,{gutter:20},{default:w((()=>[C(Q,{span:8},{default:w((()=>[C(I,{class:"user-card"},{default:w((()=>[E("div",ee,[E("div",ae,[C(b,{src:g(a).avatar,size:100},null,8,["src"]),C(_,{type:"info",class:"avatar-edit-btn",circle:"",icon:g(U),size:"small",onClick:ue},null,8,["icon"]),E("input",{ref_key:"fileInput",ref:ne,type:"file",style:{display:"none"},onChange:me},null,544)]),E("div",le,[E("span",se,z(g(a).nickname),1),C(P,{class:"edit-icon",onClick:d[0]||(d[0]=e=>G("account"))},{default:w((()=>[C(V)])),_:1})]),E("div",re,z(g(a).roleNames),1)]),C(x),d[16]||(d[16]=E("div",{class:"user-stats"},[E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"待办")]),E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"消息")]),E("div",{class:"stat-item"},[E("div",{class:"stat-value"},"0"),E("div",{class:"stat-label"},"通知")])],-1))])),_:1})])),_:1}),C(Q,{span:16},{default:w((()=>[C(I,{class:"info-card"},{header:w((()=>d[17]||(d[17]=[E("div",{class:"card-header"},[E("span",null,"账号信息")],-1)]))),default:w((()=>[C(ve,{column:1,border:""},{default:w((()=>[C(fe,{label:"用户名"},{default:w((()=>[q(z(g(a).username)+" ",1),1===g(a).gender?(f(),v(P,{key:0,class:"gender-icon male"},{default:w((()=>[C(ce)])),_:1})):(f(),v(P,{key:1,class:"gender-icon female"},{default:w((()=>[C(pe)])),_:1}))])),_:1}),C(fe,{label:"手机号码"},{default:w((()=>[q(z(g(a).mobile||"未绑定")+" ",1),g(a).mobile?(f(),v(_,{key:0,type:"primary",link:"",onClick:d[1]||(d[1]=()=>G("mobile"))},{default:w((()=>d[18]||(d[18]=[q(" 更换 ")]))),_:1})):(f(),v(_,{key:1,type:"primary",link:"",onClick:d[2]||(d[2]=()=>G("mobile"))},{default:w((()=>d[19]||(d[19]=[q(" 绑定 ")]))),_:1}))])),_:1}),C(fe,{label:"邮箱"},{default:w((()=>[q(z(g(a).email||"未绑定")+" ",1),g(a).email?(f(),v(_,{key:0,type:"primary",link:"",onClick:d[3]||(d[3]=()=>G("email"))},{default:w((()=>d[20]||(d[20]=[q(" 更换 ")]))),_:1})):(f(),v(_,{key:1,type:"primary",link:"",onClick:d[4]||(d[4]=()=>G("email"))},{default:w((()=>d[21]||(d[21]=[q(" 绑定 ")]))),_:1}))])),_:1}),C(fe,{label:"部门"},{default:w((()=>[q(z(g(a).deptName),1)])),_:1}),C(fe,{label:"创建时间"},{default:w((()=>[q(z(g(a).createTime),1)])),_:1})])),_:1})])),_:1}),C(I,{class:"security-card"},{header:w((()=>d[22]||(d[22]=[E("div",{class:"card-header"},[E("span",null,"安全设置")],-1)]))),default:w((()=>[E("div",te,[d[24]||(d[24]=E("div",{class:"security-info"},[E("div",{class:"security-title"},"账户密码"),E("div",{class:"security-desc"},"定期修改密码有助于保护账户安全")],-1)),C(_,{type:"primary",link:"",onClick:d[5]||(d[5]=()=>G("password"))},{default:w((()=>d[23]||(d[23]=[q(" 修改 ")]))),_:1})])])),_:1})])),_:1})])),_:1}),C(je,{modelValue:g(l).visible,"onUpdate:modelValue":d[15]||(d[15]=e=>g(l).visible=e),title:g(l).title,width:500},{footer:w((()=>[E("span",ie,[C(_,{onClick:de},{default:w((()=>d[25]||(d[25]=[q("取消")]))),_:1}),C(_,{type:"primary",onClick:oe},{default:w((()=>d[26]||(d[26]=[q("确定")]))),_:1})])])),default:w((()=>["account"===g(l).type?(f(),v(_e,{key:0,ref_key:"userProfileFormRef",ref:s,model:g(o),"label-width":100},{default:w((()=>[C(ge,{label:"昵称"},{default:w((()=>[C(ye,{modelValue:g(o).nickname,"onUpdate:modelValue":d[6]||(d[6]=e=>g(o).nickname=e)},null,8,["modelValue"])])),_:1}),C(ge,{label:"性别"},{default:w((()=>[C(we,{modelValue:g(o).gender,"onUpdate:modelValue":d[7]||(d[7]=e=>g(o).gender=e),code:"gender"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0),"password"===g(l).type?(f(),v(_e,{key:1,ref_key:"passwordChangeFormRef",ref:r,model:g(n),rules:k,"label-width":100},{default:w((()=>[C(ge,{label:"原密码",prop:"oldPassword"},{default:w((()=>[C(ye,{modelValue:g(n).oldPassword,"onUpdate:modelValue":d[8]||(d[8]=e=>g(n).oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),C(ge,{label:"新密码",prop:"newPassword"},{default:w((()=>[C(ye,{modelValue:g(n).newPassword,"onUpdate:modelValue":d[9]||(d[9]=e=>g(n).newPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),C(ge,{label:"确认密码",prop:"confirmPassword"},{default:w((()=>[C(ye,{modelValue:g(n).confirmPassword,"onUpdate:modelValue":d[10]||(d[10]=e=>g(n).confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])):"mobile"===g(l).type?(f(),v(_e,{key:2,ref_key:"mobileBindingFormRef",ref:t,model:g(u),rules:h,"label-width":100},{default:w((()=>[C(ge,{label:"手机号码",prop:"mobile"},{default:w((()=>[C(ye,{modelValue:g(u).mobile,"onUpdate:modelValue":d[11]||(d[11]=e=>g(u).mobile=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),C(ge,{label:"验证码",prop:"code"},{default:w((()=>[C(ye,{modelValue:g(u).code,"onUpdate:modelValue":d[12]||(d[12]=e=>g(u).code=e),style:{width:"250px"}},{append:w((()=>[C(_,{disabled:g(c)>0,onClick:H},{default:w((()=>[q(z(g(c)>0?`${g(c)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):"email"===g(l).type?(f(),v(_e,{key:3,ref_key:"emailBindingFormRef",ref:i,model:g(m),rules:W,"label-width":100},{default:w((()=>[C(ge,{label:"邮箱",prop:"email"},{default:w((()=>[C(ye,{modelValue:g(m).email,"onUpdate:modelValue":d[13]||(d[13]=e=>g(m).email=e),style:{width:"250px"}},null,8,["modelValue"])])),_:1}),C(ge,{label:"验证码",prop:"code"},{default:w((()=>[C(ye,{modelValue:g(m).code,"onUpdate:modelValue":d[14]||(d[14]=e=>g(m).code=e),style:{width:"250px"}},{append:w((()=>[C(_,{disabled:g(y)>0,onClick:K},{default:w((()=>[q(z(g(y)>0?`${g(y)}s后重新发送`:"发送验证码"),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])):A("",!0)])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-7e799d4f"]]);export{oe as default};
